{"version":3,"file":"web-components.js","sources":["../src/common/updatable.ts","../src/common/ui-element.ts","../src/common/events.ts","../src/menus/menu-templates.ts","../src/common/scrim.ts","../src/menus/menu-base.ts","../src/menus/menu-item-element.ts","../src/menus/menu-core.ts","../src/menus/root-menu.ts","../src/menus/context-menu-element.ts","../src/menus/popup-menu-element.ts","../src/menus/submenu-element.ts","../src/web-components.ts"],"sourcesContent":["export interface Updatable {\n  update(): void;\n}\n\nconst gDirtyList = new Set<Updatable>();\nlet gTimer = 0;\n\nexport function dirty(updatable: Updatable): void {\n  gDirtyList.add(updatable);\n\n  // If there's already a pending timer, bail\n  if (gTimer !== 0) return;\n\n  // Request a timer\n  gTimer = requestAnimationFrame(() => {\n    gTimer = 0;\n    const xs = [...gDirtyList.values()];\n    gDirtyList.clear();\n    for (const x of xs) x.update();\n  });\n}\n","import { Json } from './json';\nimport { dirty, Updatable } from './updatable';\n\n/**\n * In general, the 'source of truth' should be a property rather than an\n * attribute.\n *\n * When that's the case, the property definition specifies how the attribute\n * and property should coordinate:\n * - read initial property value from attribute (or not if attribute = false)\n * - observe attribute: update property value when attribute is changed (or not )\n * - reflect property: update attribute value when property value is changed (or not)\n *\n * If the source of truth is an attribute, simply declare a get/set accessor\n * for the property that reads/write to the attribute.\n */\nexport type PropertyDefinition = {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  type: String | Boolean | Number | Function | string[];\n  default: string;\n  /** If a string, reflect property to attribute with specified name\n   * If true, reflect property to attribute named from property name (kebab-case\n   * variant)\n   * If false, don't initialize property with attribute value, attribute\n   * changes will not affect property\n   * Default: true\n   */\n  attribute: boolean | string;\n  /**\n   * When attribute is updated => property is updated\n   * When property is updated:\n   * If true => the attribute is updated\n   * If false => the attribute is *not* updated\n   * Default: false\n   */\n  reflect: boolean;\n};\n\n/**\n * - When the 'source of truth' is an attribute\n * - Adds property getter/setter reflecting the value of the attribute\n * - Use when the attribute is readonly (used for the construction of the element)\n * or rarely changed\n */\n// export type AttributeDefinition = {\n//   // eslint-disable-next-line @typescript-eslint/ban-types\n//   type: String | Boolean | Number | Function | string[];\n//   default: unknown;\n// };\n\n/**\n * @internal\n */\nexport abstract class UIElement extends HTMLElement implements Updatable {\n  // Registry of UIElement classes to support `await ready()` in 'ui.ts'\n  static registry: Record<string, CustomElementConstructor> = {};\n\n  // The properties of this element and how they map to attributes\n  static properties: Readonly<Record<string, PropertyDefinition>> = {};\n\n  // Content of a `<script type='application/json'></script>` in the light DOM\n  private _json?: Json;\n  // Content of a `<style></style>` in the light DOM\n  private _style?: HTMLStyleElement | null;\n\n  constructor(options?: {\n    template: string | HTMLTemplateElement;\n    style: string | HTMLTemplateElement;\n  }) {\n    super();\n\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    if (options?.template instanceof HTMLTemplateElement) {\n      shadowRoot.append(options.template.content.cloneNode(true));\n    } else if (typeof options?.template === 'string') {\n      shadowRoot.innerHTML = options.template;\n    }\n\n    if (options?.style instanceof HTMLTemplateElement) {\n      shadowRoot.append(options.style.content.cloneNode(true));\n    } else if (typeof options?.style === 'string') {\n      const style = document.createElement('style');\n      style.textContent = options.style;\n      shadowRoot.append(style);\n    }\n  }\n\n  static async register(options: {\n    tag: string;\n    className: string;\n    constructor: CustomElementConstructor;\n  }): Promise<void> {\n    UIElement.registry[options.tag] = options.constructor;\n\n    if (!window.customElements?.get(options.tag)) {\n      (window as { [key: string]: any })[options.className] =\n        options.constructor;\n      window.customElements?.define(options.tag, options.constructor);\n    }\n\n    if (window.customElements) {\n      return window.customElements.whenDefined(options.tag);\n    }\n\n    return Promise.reject<void>(new Error('web components not supported'));\n  }\n\n  private static getAttributeNameForProperty(p: string): string | null {\n    if (!this.properties[p]) return null;\n    if (typeof this.properties[p].attribute === 'boolean') {\n      if (this.properties[p].attribute) {\n        return toKebabCase(p);\n      }\n      return null;\n    } else if (typeof this.properties[p].attribute === 'string') {\n      return this.properties[p].attribute as string;\n    }\n    return null;\n  }\n\n  static get observedAttributes(): string[] {\n    const attributes: string[] = [];\n\n    for (const prop of Object.keys(this.properties)) {\n      const attr = UIElement.getAttributeNameForProperty(prop);\n      if (attr) attributes.push(attr);\n    }\n\n    // @todo: add observed attributes from parent class, if any\n\n    return attributes;\n  }\n\n  set dirty(value: boolean) {\n    if (value) dirty(this);\n  }\n\n  /**\n   * Declare that an attribute should be reflected as a property\n   */\n  reflectStringAttribute(attrName: string, propName = attrName): void {\n    // Attributes should be all lower case, kebab-case.\n    console.assert(attrName.toLowerCase() === attrName);\n    Object.defineProperty(this, propName, {\n      enumerable: true,\n      get(): string {\n        return this.getAttribute(attrName);\n      },\n      set(value: string) {\n        this.setAttribute(attrName, value);\n      },\n    });\n  }\n\n  /**\n   * Declare that an attribute should be reflected as a property\n   */\n  reflectBooleanAttribute(attrName: string, propName = attrName): void {\n    // Attributes should be all lower case, kebab-case.\n    console.assert(attrName.toLowerCase() === attrName);\n    Object.defineProperty(this, propName, {\n      enumerable: true,\n      get(): boolean {\n        return this.hasAttribute(attrName);\n      },\n      set(value: boolean) {\n        if (value) {\n          this.setAttribute(attrName, '');\n        } else {\n          this.removeAttribute(attrName);\n        }\n      },\n    });\n  }\n\n  /**\n   * Declare that an attribute should be reflected as a property\n   */\n  reflectEnumAttribute(\n    attrName: string,\n    attrValues: string[],\n    propName = attrName\n  ): void {\n    // Attributes should be all lower case, kebab-case.\n    console.assert(attrName.toLowerCase() === attrName);\n    Object.defineProperty(this, propName, {\n      enumerable: true,\n      get(): string {\n        let value: string | undefined;\n        for (const x of attrValues) {\n          if (this.hasAttribute(x)) {\n            console.assert(\n              value === undefined,\n              `inconsistent ${attrName} attributes on ${this}`\n            );\n            value = x;\n          }\n        }\n        if (value !== undefined) return value;\n        return this.getAttribute(attrName);\n      },\n      set(value: string) {\n        this.setAttribute(attrName, value);\n        this.setAttribute(value, '');\n        for (const x of attrValues) {\n          if (x !== value) {\n            this.removeAttribute(x);\n          }\n        }\n      },\n    });\n  }\n\n  reflectBooleanAttributes(\n    attrNames: (string | [attrName: string, propName: string])[]\n  ): void {\n    for (const x of attrNames) {\n      if (typeof x === 'string') {\n        this.reflectBooleanAttribute(x);\n      } else {\n        this.reflectBooleanAttribute(x[0], x[1]);\n      }\n    }\n  }\n\n  reflectStringAttributes(\n    attrNames: (string | [attrName: string, propName: string])[]\n  ): void {\n    for (const x of attrNames) {\n      if (typeof x === 'string') {\n        this.reflectStringAttribute(x);\n      } else {\n        this.reflectStringAttribute(x[0], x[1]);\n      }\n    }\n  }\n\n  get computedDir(): 'rtl' | 'ltr' {\n    return getComputedDir(this);\n  }\n\n  /**\n   * @internal\n   */\n  connectedCallback(): void {\n    // this.update();\n  }\n\n  /**\n   * @internal\n   */\n  disconnectedCallback(): void {\n    return;\n  }\n\n  /**\n   * @internal\n   */\n  protected get json(): Json {\n    if (this._json !== undefined) return this._json;\n\n    this._json = null;\n    const slot = this.shadowRoot?.querySelector<HTMLSlotElement>('slot');\n    if (!slot) return null;\n    const json: string = slot\n      .assignedElements()\n      .filter(\n        (x) =>\n          x.tagName === 'SCRIPT' &&\n          (x as HTMLScriptElement).type === 'application/json'\n      )\n      .map((x) => x.textContent)\n      .join('');\n\n    if (!json) return null;\n\n    try {\n      this._json = JSON.parse(json);\n    } catch (error) {\n      // @todo: do this if __DEV__ only\n      // There was an error parsing the JSON.\n      // Display a helpful message.\n      const message = error.toString();\n      const m = message.match(/position (\\d+)/);\n      if (m) {\n        const index = Number.parseInt(m[1]);\n        const extract = json.substring(Math.max(index - 40, 0), index);\n        throw new Error(`${message}\\n${extract.trim()}`);\n      } else {\n        throw error;\n      }\n    }\n\n    return this._json!;\n  }\n\n  /**\n   * @internal\n   */\n  protected get importedStyle(): HTMLStyleElement | null {\n    if (this._style !== undefined) return this._style;\n\n    let stylesheet = '';\n    const slot = this.shadowRoot?.querySelector<HTMLSlotElement>('slot');\n    if (slot) {\n      stylesheet = slot\n        .assignedElements()\n        .filter((x) => x.tagName === 'STYLE')\n        .map((x) => x.textContent)\n        .join('')\n        .trim();\n    }\n    if (stylesheet.length === 0) {\n      this._style = null;\n    } else {\n      this._style = document.createElement('style');\n      this._style.textContent = stylesheet;\n    }\n\n    return this._style;\n  }\n\n  /** If there is an embedded <style> tag in the slot\n   *  \"import\" it in the shadow dom\n   */\n  importStyle(): void {\n    if (this.importedStyle) {\n      this.shadowRoot?.append(this.importedStyle.cloneNode(true));\n    }\n  }\n\n  update(): void {\n    if (!this.isConnected) return;\n\n    // Iterate over all the nodes and remove them\n    // (ensures that eventHandlers are removed, unlike innerHTML = '')\n    while (this.shadowRoot?.firstChild) {\n      this.shadowRoot.firstChild.remove();\n    }\n\n    // Add new nodes\n    const child = this.render();\n    if (child) this.shadowRoot?.append(child);\n\n    this.importStyle();\n  }\n\n  /**\n   * Return a `HTMLElement` that will get attached to the root of\n   * this element.\n   * Event handlers should get added as well.\n   */\n  render(): HTMLElement | null {\n    return null;\n  }\n}\n\n/**\n * An element can have multiple 'parts', which function as a kind of\n * parallel classList.\n *\n * Add a part name to the part list of this element.\n */\nexport function addPart(element: HTMLElement, part: string): void {\n  if (!element) return;\n  const current = element.getAttribute('part') ?? '';\n  if (!current.includes(part)) {\n    element.setAttribute('part', `${current} ${part}`);\n  }\n}\n\n/**\n * Remove a part name from the part list of this element.\n */\nexport function removePart(element: HTMLElement, part: string): void {\n  if (!element) return;\n  const current = element.getAttribute('part') ?? '';\n  if (current.includes(part)) {\n    element.setAttribute(\n      'part',\n      current.replace(new RegExp('\\\\bs*' + part + 's*\\\\b', 'g'), '')\n    );\n  }\n}\n\nexport function getComputedDir(element: HTMLElement): 'ltr' | 'rtl' {\n  if (element.dir && element.dir !== 'auto') {\n    return element.dir as 'ltr' | 'rtl';\n  }\n  if (element.parentElement) return getComputedDir(element.parentElement);\n  return 'ltr';\n}\n\nexport function getOppositeEdge(\n  bounds: DOMRectReadOnly,\n  position: 'leading' | 'trailing' | 'left' | 'end',\n  direction: 'ltr' | 'rtl'\n): number {\n  if (\n    position === 'left' ||\n    (position === 'leading' && direction === 'ltr') ||\n    (position === 'trailing' && direction === 'rtl')\n  ) {\n    return bounds.right;\n  }\n\n  return bounds.left;\n}\n\nexport function getEdge(\n  bounds: DOMRectReadOnly,\n  position: 'leading' | 'trailing' | 'left' | 'end',\n  direction: 'ltr' | 'rtl'\n): number {\n  if (\n    position === 'left' ||\n    (position === 'leading' && direction === 'ltr') ||\n    (position === 'trailing' && direction === 'rtl')\n  ) {\n    return bounds.left;\n  }\n\n  return bounds.right;\n}\n\nfunction toKebabCase(s: string): string {\n  return s\n    .match(\n      /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g\n    )!\n    .map((x: string) => x.toLowerCase())\n    .join('-');\n}\n\nexport function toCamelCase(s: string): string {\n  return s.toLowerCase().replace(/[^a-zA-Z\\d]+(.)/g, (m, c) => c.toUpperCase());\n}\n","export type KeyboardModifiers = {\n  alt: boolean;\n  control: boolean;\n  shift: boolean;\n  meta: boolean;\n};\n\n// We use a class to encapsulate the state that needs to be tracked and,\n// more importantly, to avoid memory leaks by using the `handleEvent()` hook\n// to ensure proper disposal of event handlers\nexport class LongPressDetector {\n  static DELAY = 300; // In ms\n\n  private readonly onLongPress: () => void;\n  private readonly startPoint?: [x: number, y: number];\n  private lastPoint?: [x: number, y: number];\n\n  private timer = 0;\n\n  constructor(triggerEvent: Event, onLongPress: () => void) {\n    this.onLongPress = onLongPress;\n    const location = eventLocation(triggerEvent);\n    if (!location) return;\n\n    this.startPoint = location;\n    this.lastPoint = location;\n\n    this.timer = setTimeout(() => {\n      this.dispose();\n      if (distance(this.lastPoint!, this.startPoint!) < 10) {\n        this.onLongPress();\n      }\n    }, LongPressDetector.DELAY);\n    for (const evt of ['pointermove', 'pointerup', 'pointercancel']) {\n      window.addEventListener(evt, this, { passive: true });\n    }\n  }\n\n  dispose(): void {\n    clearTimeout(this.timer);\n    this.timer = 0;\n\n    for (const evt of ['pointermove', 'pointerup', 'pointercancel']) {\n      window.removeEventListener(evt, this);\n    }\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'pointerup') {\n      this.dispose();\n\n      event.stopPropagation();\n    } else if (event.type === 'pointermove') {\n      const location = eventLocation(event);\n      if (location) {\n        this.lastPoint = location;\n        event.stopPropagation();\n      }\n    } else if (event.type === 'pointercancel') {\n      this.dispose();\n      event.stopPropagation();\n    }\n  }\n}\n\nfunction distance(\n  p1: [x: number, y: number],\n  p2: [x: number, y: number]\n): number {\n  const dx = p2[0] - p1[0];\n  const dy = p2[1] - p1[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\nexport function eventLocation(evt: Event): [x: number, y: number] | undefined {\n  if (evt instanceof MouseEvent) {\n    return [evt.clientX, evt.clientY];\n  }\n\n  if (evt instanceof TouchEvent) {\n    const result = [...evt.touches].reduce(\n      (acc, x) => [acc[0] + x.clientX, acc[1] + x.clientY],\n      [0, 0]\n    );\n    const l = evt.touches.length;\n    return [result[0] / l, result[1] / l];\n  }\n\n  return undefined;\n}\n\nexport function eventPointerCount(evt: Event): number {\n  if (evt instanceof MouseEvent) {\n    return 1;\n  }\n\n  if (evt instanceof TouchEvent) {\n    return evt.touches.length;\n  }\n\n  return 0;\n}\n\n/**\n * When the potential start of a long press event (`pointerdown`)\n * event is detected, this function will invoke the `fn` callback if the\n * user performs a long press.\n */\nexport function onLongPress(triggerEvent: Event, fn: () => void): void {\n  new LongPressDetector(triggerEvent, fn);\n}\n\nexport function keyboardModifiersFromEvent(ev: Event): KeyboardModifiers {\n  const result = {\n    alt: false,\n    control: false,\n    shift: false,\n    meta: false,\n  };\n  if (\n    ev instanceof MouseEvent ||\n    ev instanceof TouchEvent ||\n    ev instanceof KeyboardEvent\n  ) {\n    if (ev.altKey) result.alt = true;\n    if (ev.ctrlKey) result.control = true;\n    if (ev.metaKey) result.meta = true;\n    if (ev.shiftKey) result.shift = true;\n  }\n\n  return result;\n}\n\nexport function equalKeyboardModifiers(\n  a?: KeyboardModifiers,\n  b?: KeyboardModifiers\n): boolean {\n  if ((!a && b) || (a && !b)) return false;\n  if (!a && !b) return true;\n  return (\n    a!.alt === b!.alt &&\n    a!.control === b!.control &&\n    a!.shift === b!.shift &&\n    a!.meta === b!.meta\n  );\n}\n\nconst PRINTABLE_KEYCODE = new Set([\n  'Backquote', // Japanese keyboard: hankaku/zenkaku/kanji key, which is non-printable\n  'Digit0',\n  'Digit1',\n  'Digit2',\n  'Digit3',\n  'Digit4',\n  'Digit5',\n  'Digit6',\n  'Digit7',\n  'Digit8',\n  'Digit9',\n  'Minus',\n  'Equal',\n  'IntlYen', // Japanese Keyboard. Russian keyboard: \\/\n\n  'KeyQ', // AZERTY keyboard: labeled 'a'\n  'KeyW', // AZERTY keyboard: labeled 'z'\n  'KeyE',\n  'KeyR',\n  'KeyT',\n  'KeyY', // QWERTZ keyboard: labeled 'z'\n  'KeyU',\n  'KeyI',\n  'KeyO',\n  'KeyP',\n  'BracketLeft',\n  'BracketRight',\n  'Backslash', // May be labeled #~ on UK 102 keyboard\n  'KeyA', // AZERTY keyboard: labeled 'q'\n  'KeyS',\n  'KeyD',\n  'KeyF',\n  'KeyG',\n  'KeyH',\n  'KeyJ',\n  'KeyK',\n  'KeyL',\n  'Semicolon',\n  'Quote',\n  'IntlBackslash', // QWERTZ keyboard '><'\n  'KeyZ', // AZERTY: 'w', QWERTZ: 'y'\n  'KeyX',\n  'KeyC',\n  'KeyV',\n  'KeyB',\n  'KeyN',\n  'KeyM',\n  'Comma',\n  'Period',\n  'Slash',\n  'IntlRo', // Japanse keyboard '\\ã‚'\n\n  'Space',\n\n  'Numpad0',\n  'Numpad1',\n  'Numpad2',\n  'Numpad3',\n  'Numpad4',\n  'Numpad5',\n  'Numpad6',\n  'Numpad7',\n  'Numpad8',\n  'Numpad9',\n  'NumpadAdd',\n  'NumpadComma',\n  'NumpadDecimal',\n  'NumpadDivide',\n  'NumpadEqual',\n  'NumpadHash',\n  'NumpadMultiply',\n  'NumpadParenLeft',\n  'NumpadParenRight',\n  'NumpadStar',\n  'NumpadSubstract',\n]);\n\nexport function mightProducePrintableCharacter(evt: KeyboardEvent): boolean {\n  if (evt.ctrlKey || evt.metaKey) {\n    // ignore ctrl/cmd-combination but not shift/alt-combinations\n    return false;\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\n  if (evt.key === 'Dead') return false;\n\n  // When issued via a composition, the `code` field is empty\n  if (evt.code === '') return true;\n\n  return PRINTABLE_KEYCODE.has(evt.code);\n}\n","export const MENU_TEMPLATE = document.createElement('template');\nMENU_TEMPLATE.innerHTML = `<ul></ul><slot></slot>`;\nexport const MENU_STYLE = document.createElement('template');\nMENU_STYLE.innerHTML = `<style>\n*,\n::before,\n::after {\n    box-sizing: border-box;\n}\n:host {\n    display: none;\n    color-scheme: light dark;\n    -webkit-user-select: none;  /* Important: Safari iOS doesn't respect user-select */\n    user-select: none;\n    cursor: default;\n    -webkit-touch-callout: none;\n    -webkit-tap-highlight-color: rgba(0 0 0 0);\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    pointer-events: none;\n    opacity:  .5;\n}\n:host(:focus), :host(:focus-within) {\n    outline: Highlight auto 1px;    /* For Firefox */\n    outline: -webkit-focus-ring-color auto 1px;\n}\n:host div.scrim {\n    position: fixed;\n    contain: content;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    outline: none;\n    background: transparent;\n}\n:host slot {\n    display: none;\n}\nul.menu-container {\n    position: absolute;\n    width: auto;\n    height: auto;\n    z-index: 10000;\n    border-radius: 8px;\n    background: var(--menu-bg);\n    box-shadow: 0 0 2px rgba(0, 0, 0, .5), 0 0 20px rgba(0, 0, 0, .2);\n\n    list-style: none;\n    padding: 6px 0 6px 0;\n    margin: 0;\n    user-select: none;\n    cursor: default;\n\n    color: var(--label-color);\n    font-weight: normal;\n    font-style: normal;\n    text-shadow: none;\n    text-transform: none;\n    letter-spacing: 0;\n    outline: none;\n    opacity: 1;\n}\nul.menu-container > li {\n    display: flex;\n    flex-flow: row;\n    align-items: center;\n    padding: 1px 7px 1px 7px;\n    margin-top: 0;\n    margin-left: 6px;\n    margin-right: 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n    position: relative;\n    outline: none;\n    fill: currentColor;\n    user-select: none;\n    cursor: default;\n    text-align: left;\n    color: inherit;\n\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n}\nul.menu-container > li > .label {\n    appearance: none;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\n\nul.menu-container > li > .label.indent {\n    margin-left: 12px;\n}\nul.menu-container > li[role=divider] {\n    border-bottom: 1px solid #c7c7c7;\n    border-radius: 0;\n    padding: 0;\n    margin-left: 15px;\n    margin-right: 15px;\n    padding-top: 5px;\n    margin-bottom: 5px;\n    width: calc(100% - 30px);\n}\nul.menu-container > li[aria-disabled=true] {\n    opacity: .5;\n}\n\nul.menu-container > li.active {\n    background: var(--active-bg);\n    background: -apple-system-control-accent;\n    color: var(--active-label-color);\n}\n\nul.menu-container > li.active.is-submenu-open {\n    background: var(--active-bg-dimmed);\n    color: inherit;\n}\n\nul.menu-container > li[aria-haspopup=true]>.label {\n     padding-right: 0;\n}\n\n.right-chevron {\n    margin-left: 24px;\n    width: 10px;\n    height: 10px;\n    margin-bottom: 4px;\n}\n.checkmark {\n    margin-right: -11px;\n    margin-left: -4px;\n    margin-top : 2px;\n    width: 16px;\n    height: 16px;\n}\n\nul.menu-container > li[aria-haspopup=true].active::after {\n    color: white;\n}\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}\n</style>`;\n","import { getComputedDir } from './ui-element';\n\nexport class Scrim {\n  private _element?: HTMLElement;\n\n  private readonly preventOverlayClose: boolean;\n  private readonly onClose?: () => void;\n\n  private savedOverflow?: string;\n  private savedMarginRight?: string;\n\n  private savedActiveElement?: HTMLOrSVGElement | null;\n\n  private state: 'closed' | 'opening' | 'open' | 'closing';\n\n  private readonly translucent: boolean;\n\n  /**\n   * - If `options.preventOverlayClose` is false, the scrim is closed if the\n   * user clicks on the scrim. That's the behavior for menus, for example.\n   * When you need a fully modal situation until the user has made an\n   * explicit choice (validating cookie usage, for example), set\n   * `preventOverlayClose` to true.\n   * - `onClose()` is called when the scrim is being closed\n   * -\n   */\n  constructor(options?: {\n    translucent?: boolean;\n    preventOverlayClose?: boolean;\n    onClose?: () => void;\n  }) {\n    this.preventOverlayClose = options?.preventOverlayClose ?? false;\n    this.translucent = options?.translucent ?? false;\n\n    this.state = 'closed';\n  }\n\n  get element(): HTMLElement {\n    if (this._element) return this._element;\n\n    const element = document.createElement('div');\n    element.setAttribute('role', 'presentation');\n\n    element.style.position = 'fixed';\n    element.style['contain' as any] = 'content';\n    element.style.top = '0';\n    element.style.left = '0';\n    element.style.right = '0';\n    element.style.bottom = '0';\n    element.style.zIndex = '9999';\n    element.style.outline = 'none';\n    if (this.translucent) {\n      element.style.background = 'rgba(255, 255, 255, .2)';\n      element.style['backdropFilter' as any] = 'contrast(40%)';\n    } else {\n      element.style.background = 'transparent';\n    }\n\n    this._element = element;\n    return element;\n  }\n\n  open(options: { root?: Node | null; child?: HTMLElement }): void {\n    if (this.state !== 'closed') return;\n\n    this.state = 'opening';\n\n    // Remember the previously focused element. We'll restore it when we close.\n    this.savedActiveElement = deepActiveElement();\n\n    const { element } = this;\n    (options?.root ?? document.body).appendChild(element);\n\n    element.addEventListener('click', this);\n    document.addEventListener('touchmove', this, false);\n    document.addEventListener('scroll', this, false);\n\n    // Prevent (some) scrolling\n    // (touch scrolling will still happen)\n    const scrollbarWidth =\n      window.innerWidth - document.documentElement.clientWidth;\n    this.savedMarginRight = document.body.style.marginRight;\n    this.savedOverflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n\n    const marginRight = Number.parseFloat(\n      getComputedStyle(document.body).marginRight\n    );\n\n    document.body.style.marginRight = `${marginRight + scrollbarWidth}px`;\n\n    if (options?.child) {\n      element.append(options.child);\n    }\n\n    this.state = 'open';\n  }\n\n  close(): void {\n    if (this.state !== 'open') return;\n    this.state = 'closing';\n\n    if (typeof this.onClose === 'function') this.onClose();\n\n    const { element } = this;\n    element.removeEventListener('click', this);\n    document.removeEventListener('touchmove', this, false);\n    document.removeEventListener('scroll', this, false);\n\n    element.remove();\n\n    // Restore body state\n    document.body.style.overflow = this.savedOverflow ?? '';\n    document.body.style.marginRight = this.savedMarginRight ?? '';\n\n    // Restore the previously focused element\n    this.savedActiveElement?.focus?.();\n\n    // Remove all children\n    element.innerHTML = '';\n    this.state = 'closed';\n  }\n\n  handleEvent(ev: Event): void {\n    if (!this.preventOverlayClose) {\n      if (ev.target === this._element && ev.type === 'click') {\n        this.close();\n        ev.preventDefault();\n        ev.stopPropagation();\n      } else if (\n        ev.target === document &&\n        (ev.type === 'touchmove' || ev.type === 'scroll')\n      ) {\n        // This is an attempt at scrolling on a touch-device\n        this.close();\n        ev.preventDefault();\n        ev.stopPropagation();\n      }\n    }\n  }\n}\n\nfunction deepActiveElement(): HTMLOrSVGElement | null {\n  let a = document.activeElement;\n  while (a?.shadowRoot?.activeElement) {\n    a = a.shadowRoot.activeElement;\n  }\n\n  return (a as unknown) as HTMLOrSVGElement;\n}\n\n/**\n * Calculate the effective position (width or height) given a starting pos,\n * a placement (left, top, middle, etc...) and dir (ltr/rtl).\n */\nfunction getEffectivePos(\n  pos: number,\n  length: number,\n  placement: 'start' | 'end' | 'middle' | 'left' | 'right' | 'top' | 'bottom',\n  dir: 'ltr' | 'rtl'\n): number {\n  if (placement === 'middle') {\n    return pos - length / 2;\n  }\n\n  if (\n    (placement === 'start' && dir === 'ltr') ||\n    (placement === 'end' && dir === 'rtl') ||\n    placement === 'top' ||\n    placement === 'left'\n  ) {\n    return Math.max(0, pos - length);\n  }\n\n  return pos;\n}\n\nexport function getOppositeEffectivePos(\n  pos: number,\n  length: number,\n  placement: 'start' | 'end' | 'middle' | 'left' | 'right' | 'top' | 'bottom',\n  dir: 'ltr' | 'rtl'\n): number {\n  if (placement === 'middle') {\n    return pos - length / 2;\n  }\n\n  if (\n    (placement === 'start' && dir === 'ltr') ||\n    (placement === 'end' && dir === 'rtl') ||\n    placement === 'top' ||\n    placement === 'left'\n  ) {\n    return pos;\n  }\n\n  return pos - length;\n}\n\n/**\n * Set the position of the element so that it fits in the viewport.\n *\n * The element is first positioned at `location`.\n * If it overflows and there is an alternate location, use the alternate\n * location to fit the topright at the alternate location.\n *\n * If the element still overflows, adjust its location moving it up and to the\n * left as necessary until it fits (and adjusting its width/height as a result)\n */\nexport function fitInViewport(\n  element: HTMLElement,\n  options: {\n    location: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    verticalPos: 'bottom' | 'top' | 'middle' | 'start' | 'end';\n    horizontalPos: 'left' | 'right' | 'middle' | 'start' | 'end';\n    width?: number;\n    height?: number;\n    maxWidth?: number;\n    maxHeight?: number;\n  }\n): void {\n  const dir = getComputedDir(element) ?? 'ltr';\n\n  // Reset any location, so we can get the natural width/height\n  element.style.display = 'block';\n  element.style.position = 'absolute';\n  element.style.left = 'auto';\n  element.style.top = 'auto';\n  element.style.right = 'auto';\n  element.style.bottom = 'auto';\n  element.style.height = 'auto';\n  element.style.width = 'auto';\n\n  const elementBounds = element.getBoundingClientRect();\n\n  //\n  // Vertical positioning\n  //\n  const maxHeight = Number.isFinite(options.maxHeight)\n    ? Math.min(options.maxHeight!, window.innerHeight)\n    : window.innerHeight;\n  let height = Math.min(maxHeight, options.height ?? elementBounds.height);\n\n  let top: number | undefined = getEffectivePos(\n    options.location[1],\n    height,\n    options.verticalPos,\n    dir\n  );\n  if (top + height > window.innerHeight - 8) {\n    if (options.alternateLocation) {\n      top = getEffectivePos(\n        options.alternateLocation[1],\n        height,\n        options.verticalPos,\n        dir\n      );\n      if (top + height > window.innerHeight - 8) {\n        top = undefined;\n      }\n    } else {\n      top = undefined;\n    }\n  }\n\n  if (!Number.isFinite(top)) {\n    // Move element as high as possible\n    top = Math.max(8, window.innerHeight - 8 - height);\n    if (8 + height > window.innerHeight - 8) {\n      // Still doesn't fit, we'll clamp it\n      element.style.bottom = '8px';\n    }\n  }\n\n  height = Math.min(top! + height, window.innerHeight - 8) - top!;\n\n  //\n  // Horizontal positioning\n  //\n  const maxWidth = Number.isFinite(options.maxWidth)\n    ? Math.min(options.maxWidth!, window.innerWidth)\n    : window.innerWidth;\n\n  let width = Math.min(maxWidth, options.width ?? elementBounds.width);\n\n  let left: number | undefined = getEffectivePos(\n    options.location[0],\n    width,\n    options.horizontalPos,\n    dir\n  );\n  if (left + width > window.innerWidth - 8) {\n    if (options.alternateLocation) {\n      left = getOppositeEffectivePos(\n        options.alternateLocation[0],\n        width,\n        options.verticalPos,\n        dir\n      );\n      if (left + width > window.innerWidth - 8) {\n        left = undefined;\n      }\n    } else {\n      left = undefined;\n    }\n  }\n\n  if (!Number.isFinite(left)) {\n    // Move element as high as possible\n    left = Math.max(8, window.innerWidth - 8 - width);\n    if (8 + width > window.innerWidth - 8) {\n      // Still doesn't fit, we'll clamp it\n      element.style.right = '8px';\n    }\n  }\n\n  width = Math.min(left! + width, window.innerWidth - 8) - left!;\n\n  element.style.left = `${Math.round(left!).toString()}px`;\n  element.style.top = `${Math.round(top!).toString()}px`;\n  element.style.height = `${Math.round(height).toString()}px`;\n  element.style.width = `${Math.round(width).toString()}px`;\n}\n","import {\n  keyboardModifiersFromEvent,\n  KeyboardModifiers,\n} from '../common/events';\n\n/**\n * Base class to represent a menu item.\n * There are two subclasses:\n * - MenuItemFromTemplate for menu items created from a JSON template\n * - MenuItemFromElement for menu items created for a UIMenuItem\n */\nexport abstract class MenuItem {\n  parentMenu: MenuInterface;\n  submenu?: MenuInterface;\n\n  constructor(parentMenu: MenuInterface) {\n    this.parentMenu = parentMenu;\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'pointerenter') {\n      const ev = event as PointerEvent;\n      this.parentMenu.rootMenu.cancelDelayedOperation();\n      // If there is a submenu open, and the mouse is moving in the\n      // triangle formed from the current mouse location and the two\n      // adjacent corners of the open menu, schedule setting the new\n      // active menuitem to later\n      if (\n        this.parentMenu.isSubmenuOpen &&\n        this.parentMenu.activeMenuItem?.movingTowardSubmenu(ev)\n      ) {\n        this.parentMenu.rootMenu.scheduleOperation(() => {\n          this.parentMenu.activeMenuItem = this;\n          if (this.submenu) {\n            this.openSubmenu(keyboardModifiersFromEvent(ev));\n          }\n        });\n      } else {\n        this.parentMenu.activeMenuItem = this;\n        if (this.submenu) {\n          this.openSubmenu(keyboardModifiersFromEvent(ev), {\n            withDelay: true,\n          });\n        }\n      }\n    } else if (event.type === 'pointerleave') {\n      if (this.parentMenu.rootMenu.activeMenu === this.parentMenu) {\n        this.parentMenu.activeMenuItem = null;\n      }\n    } else if (event.type === 'pointerup') {\n      // When modal, the items are activated on click,\n      // so ignore mouseup\n      if (this.parentMenu.rootMenu.state !== 'modal') {\n        this.select(keyboardModifiersFromEvent(event));\n      }\n\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  }\n\n  /**\n   * Called when a menu item is selected:\n   * - either dismiss the menu and execute the command\n   * - or display the submenu\n   */\n  select(kbd?: KeyboardModifiers): void {\n    this.parentMenu.rootMenu.cancelDelayedOperation();\n\n    if (this.submenu) {\n      this.openSubmenu(kbd);\n      return;\n    }\n\n    // Make the item blink, then execute the command\n    this.active = false;\n    setTimeout(() => {\n      this.active = true;\n      setTimeout(() => {\n        this.active = false;\n        setTimeout(() => {\n          this.parentMenu.rootMenu.hide();\n          setTimeout(() => {\n            this.dispatchSelect(kbd);\n          }, 120);\n        }, 120);\n      }, 120);\n    }, 120);\n  }\n\n  /**\n   * Open the submenu of this menu item, with a delay if options.delay\n   * This delay improves targeting of submenus with the mouse.\n   */\n  openSubmenu(kbd?: KeyboardModifiers, options?: { withDelay: boolean }): void {\n    if (!this.submenu || !this.element) return;\n    if (options?.withDelay ?? false) {\n      this.parentMenu.rootMenu.scheduleOperation(() => {\n        this.openSubmenu(kbd);\n      });\n      return;\n    }\n\n    const bounds = this.element.getBoundingClientRect();\n    this.submenu.show({\n      location: [bounds.right, bounds.top - 4],\n      alternateLocation: [bounds.left, bounds.top - 4],\n      parent: this.parentMenu.rootMenu.element?.parentNode ?? null,\n      keyboardModifiers: kbd,\n    });\n  }\n\n  movingTowardSubmenu(ev: PointerEvent): boolean {\n    if (!this.element) return false;\n    const lastEv = this.parentMenu.rootMenu.lastMoveEvent;\n    if (!lastEv) return false;\n\n    const deltaT = ev.timeStamp - lastEv.timeStamp;\n    if (deltaT > 500) return false;\n\n    const deltaX = ev.clientX - lastEv.clientX;\n\n    // Moving too slow?\n    const s = speed(deltaX, lastEv.clientY - ev.clientY, deltaT);\n    if (s <= 0.2) return false;\n\n    // Moving horizontally towards the submenu?\n    let position: 'left' | 'right' = 'right';\n    if (this.submenu!.element) {\n      const submenuBounds = this.submenu!.element.getBoundingClientRect();\n\n      const bounds = this.element.getBoundingClientRect();\n      if (submenuBounds.left < bounds.left + bounds.width / 2) {\n        position = 'left';\n      }\n    }\n\n    return position === 'right' ? deltaX > 0 : deltaX < 0;\n  }\n  abstract get type(): 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio';\n\n  abstract get active(): boolean;\n  abstract get hidden(): boolean;\n  abstract get disabled(): boolean;\n  abstract get label(): string;\n  abstract set active(value: boolean);\n\n  // Notify the owner that a menu item has been selected\n  abstract dispatchSelect(kbd?: KeyboardModifiers): void;\n\n  abstract get element(): HTMLElement | null;\n}\n\nfunction speed(dx: number, dy: number, dt: number): number {\n  return Math.sqrt(dx * dx + dy * dy) / dt;\n}\n\nexport interface MenuInterface {\n  parentMenu: MenuInterface | null;\n  readonly rootMenu: RootMenuInterface;\n  // Readonly menuHost: Element;\n\n  readonly element: HTMLElement | null;\n  readonly isSubmenuOpen: boolean;\n\n  activeMenuItem: MenuItem | null;\n  readonly firstMenuItem: MenuItem | null;\n  readonly lastMenuItem: MenuItem | null;\n\n  openSubmenu: MenuInterface | null;\n  readonly hasRadio: boolean;\n  readonly hasCheckbox: boolean;\n\n  hide(): void;\n  show(options: {\n    parent: Node | null;\n    location?: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): void;\n  nextMenuItem(dir: number): MenuItem | null;\n  findMenuItem(text: string): MenuItem | null;\n  dispatchEvent(ev: Event): boolean;\n}\n\nexport interface RootMenuInterface extends MenuInterface {\n  lastMoveEvent?: PointerEvent;\n  activeMenu: MenuInterface;\n  state: 'closed' | 'open' | 'modal';\n  readonly scrim: Element;\n\n  cancelDelayedOperation(): void;\n  scheduleOperation(op: () => void): void;\n}\n","import { UIElement } from '../common/ui-element';\nimport { MenuItem } from './menu-base';\n\nconst MENU_ITEM_STYLE = document.createElement('template');\nMENU_ITEM_STYLE.innerHTML = `<style>\n:host {\n    display: inline;\n    color-scheme: light dark;\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n    outline: none;\n    fill: currentColor;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    text-align: left;\n    color: var(--label-color);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    opacity:  .5;\n}\n\n:host([active]) {\n    color: var(--active-label-color);\n}\n\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}</style>`;\nconst MENU_ITEM_TEMPLATE = document.createElement('template');\nMENU_ITEM_TEMPLATE.innerHTML = '<slot></slot>';\n\n/**\n * Each `UIMenuItemElement` is wrapped inside a `<li>` tag.\n * A `UIMenuItemElement` represents the label part of a menu item.\n * Other elements such as the checkmark and the submenu indicator\n * are rendered by the menu container.\n */\nexport class UIMenuItem extends UIElement {\n  // The _menuItem is the 'model' corresponding to this element.\n  private _menuItem?: MenuItem;\n\n  get menuItem(): MenuItem | undefined {\n    return this._menuItem;\n  }\n\n  set menuItem(value: MenuItem | undefined) {\n    this._menuItem = value;\n  }\n\n  constructor() {\n    super({ template: MENU_ITEM_TEMPLATE, style: MENU_ITEM_STYLE });\n    this.reflectBooleanAttributes(['active', 'divider', 'disabled', 'checked']);\n  }\n}\n\nexport default UIMenuItem;\n\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UIMenuItem: typeof UIMenuItem;\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-menu-item',\n  className: 'UIMenuItem',\n  constructor: UIMenuItem,\n});\n","import {\n  KeyboardModifiers,\n  keyboardModifiersFromEvent,\n} from '../common/events';\nimport { fitInViewport } from '../common/scrim';\nimport { addPart, removePart, UIElement } from '../common/ui-element';\nimport { MenuInterface, MenuItem, RootMenuInterface } from './menu-base';\nimport { UIMenuItem } from './menu-item-element';\nimport { UISubmenu } from './submenu-element';\n\nexport type MenuItemTemplate = {\n  onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n  type?: 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio';\n  className?: string;\n  label?:\n    | string\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string);\n  ariaLabel?:\n    | string\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string);\n  ariaDetails?:\n    | string\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string);\n  submenu?: MenuItemTemplate[];\n\n  hidden?:\n    | boolean\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean);\n  disabled?:\n    | boolean\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean);\n  checked?:\n    | boolean\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean);\n\n  /** Caller defined id string. Passed to the `onSelect()` hook. */\n  id?: string;\n\n  /** Caller defined data block. Passed to the `onSelect()` hook. */\n  data?: any;\n};\n\n/**\n * An instance of `Menu` is a model of a collection of menu items, including\n * submenus.\n *\n *\n */\nexport class Menu implements MenuInterface {\n  parentMenu: MenuInterface | null;\n  isSubmenuOpen: boolean; // If true, _activeMenuItem.submenu_ is open\n\n  /**\n   * The Element from which menu items will be used as template (optional)\n   */\n  menuHost?: Element;\n\n  hasCheckbox = false; // If true, has at least one checkbox menu item\n  hasRadio = false; // If true, has at least one radio menu item\n\n  protected _element: HTMLElement | null = null;\n  protected _menuItems: MenuItem[] = [];\n  private _activeMenuItem: MenuItem | null = null;\n\n  /*\n   * The menu items template are preserved so that the actual menu items\n   * can be recalculated, for example if the keyboard modifiers change.\n   * (when isDynamic is true)\n   */\n  private _menuItemsTemplate: MenuItemTemplate[] | undefined;\n\n  /**\n   * Optional, an HTML element to be used as the container for this menu.\n   * Used when this maps to a custom element with a <ul> in its template.\n   */\n  protected _assignedContainer?: HTMLElement | null;\n\n  /**\n   * - host: if the menu is inside an element, the host is this element.\n   * This is where a set of <ui-menu-item> elements will be read from.\n   * - assignedContainer: the element into which the menu items will be\n   * inserted. A <ul>. Could be in a custom element. If none is provided,\n   * a new <ul> is created.\n   * - wrapper: an element that wraps the container. This elements\n   * gets attached to the scrim for display. If none is provided,\n   * the container is used directly. Pass the custom element when\n   * a custom element wrapper is used (e.g. for <ui-submenu>)\n   */\n  constructor(\n    menuItems?: MenuItemTemplate[],\n    options?: {\n      parentMenu?: MenuInterface;\n      host?: Element;\n      assignedContainer?: HTMLElement | null;\n    }\n  ) {\n    this.parentMenu = options?.parentMenu ?? null;\n    this._assignedContainer = options?.assignedContainer;\n\n    this._menuItemsTemplate = menuItems;\n    this.isSubmenuOpen = false;\n\n    this.menuHost = options?.host;\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'wheel' && this._element) {\n      const ev = event as WheelEvent;\n      // Scroll wheel: adjust scroll position\n      this._element.scrollBy(0, ev.deltaY);\n\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  get rootMenu(): RootMenuInterface {\n    return this.parentMenu!.rootMenu;\n  }\n\n  dispatchEvent(ev: Event): boolean {\n    return this.rootMenu.dispatchEvent(ev);\n  }\n\n  /**\n   * Update the 'model' of this menu (i.e. list of menu items) based\n   * on:\n   * - the state of the keyboard, for programmatically specified items\n   * - the content of the JSON and elements inside the host element\n   * (if there is one)\n   */\n  updateMenu(keyboardModifiers?: KeyboardModifiers): void {\n    // Save the current menu\n    const element = this._element;\n    let saveCurrentItem = -1;\n    let left = 0;\n    let top = 0;\n    let parent: Node | undefined | null;\n    if (element) {\n      // If there is a cached element for this menu,\n      // remove it (but save its state)\n      saveCurrentItem = this.activeMenuItem\n        ? this._menuItems!.indexOf(this.activeMenuItem)\n        : -1;\n      parent = element.parentNode;\n      left = Number.parseInt(element.style.left);\n      top = Number.parseInt(element.style.top);\n      parent?.removeChild(element);\n      this._element = null;\n    }\n\n    this._menuItems = [];\n    this.hasCheckbox = false;\n    this.hasRadio = false;\n    if (this._menuItemsTemplate) {\n      for (const x of this._menuItemsTemplate) {\n        this.appendMenuItem(x, keyboardModifiers);\n      }\n    }\n\n    // Add menu-item-elements\n    if (this.menuHost?.shadowRoot) {\n      const slot = this.menuHost.shadowRoot.querySelector<HTMLSlotElement>(\n        'slot'\n      );\n      if (slot) {\n        const itemElements = slot\n          .assignedElements()\n          .filter<UIMenuItem>(\n            (x): x is UIMenuItem => x.tagName === 'UI-MENU-ITEM'\n          );\n        for (const el of itemElements) {\n          this.appendMenuItem(el, keyboardModifiers);\n        }\n      }\n    }\n\n    this.hasCheckbox = this._menuItems.some((x) => x.type === 'checkbox');\n    this.hasRadio = this._menuItems.some((x) => x.type === 'radio');\n\n    if (element) {\n      // If there was a previous version of the menu,\n      // restore it and its state\n      parent?.appendChild(this.element);\n\n      fitInViewport(this.element, {\n        location: [left, top],\n        verticalPos: 'bottom',\n        horizontalPos: 'right',\n      });\n\n      this.activeMenuItem =\n        saveCurrentItem >= 0 ? this.menuItems[saveCurrentItem] : null;\n      if (this.activeMenuItem?.submenu) {\n        this.activeMenuItem.openSubmenu(keyboardModifiers);\n      }\n    }\n  }\n\n  get menuItems(): MenuItem[] {\n    return this._menuItems;\n  }\n\n  set menuItemTemplates(value: MenuItemTemplate[]) {\n    this._menuItemsTemplate = value;\n    if (this._element) {\n      if (this.menuItems.filter((x) => !x.hidden).length === 0) {\n        this.hide();\n        return;\n      }\n\n      this.updateMenu();\n    }\n  }\n\n  /** First activable menu item */\n  get firstMenuItem(): MenuItem | null {\n    let result = 0;\n    let found = false;\n    const { menuItems } = this;\n    while (!found && result <= menuItems.length - 1) {\n      const item = menuItems[result];\n      found = item.type !== 'divider' && !item.hidden && !item.disabled;\n      result += 1;\n    }\n\n    return found ? menuItems[result - 1] : null;\n  }\n\n  /** Last activable menu item */\n  get lastMenuItem(): MenuItem | null {\n    let result = this.menuItems.length - 1;\n    let found = false;\n    while (!found && result >= 0) {\n      const item = this.menuItems[result];\n      found = item.type !== 'divider' && !item.hidden && !item.disabled;\n      result -= 1;\n    }\n\n    return found ? this.menuItems[result + 1] : null;\n  }\n\n  /**\n   * The active menu is displayed on a colored background.\n   */\n  get activeMenuItem(): MenuItem | null {\n    return this._activeMenuItem;\n  }\n\n  /**\n   * Set to undefined to have no active item.\n   * Note that setting the active menu item doesn't automatically\n   * open the submenu (e.g. when keyboard navigating).\n   * Call `item.submenu.openSubmenu()` to open the submenu.\n   */\n  set activeMenuItem(value: MenuItem | null) {\n    this.parentMenu?.rootMenu.cancelDelayedOperation();\n    if (value !== this._activeMenuItem) {\n      // Remove previously active element\n      if (this.activeMenuItem) {\n        const item = this.activeMenuItem;\n        item.active = false;\n        // If there is a submenu, hide it\n        item.submenu?.hide();\n      }\n\n      if (value?.hidden) {\n        this._activeMenuItem = null;\n        return;\n      }\n\n      this._activeMenuItem = value;\n\n      // Make new element active\n      if (value) value.active = true;\n    }\n\n    if (value) {\n      value.element?.focus();\n    } else {\n      this._element?.focus();\n    }\n\n    // Update secondary state of parent\n    this.parentMenu?.activeMenuItem?.element?.classList.toggle(\n      'is-submenu-open',\n      Boolean(value)\n    );\n  }\n\n  nextMenuItem(dir: number): MenuItem | null {\n    if (!this._activeMenuItem && dir > 0) return this.firstMenuItem;\n    if (!this._activeMenuItem && dir < 0) return this.lastMenuItem;\n    if (!this.firstMenuItem || !this.lastMenuItem || !this._activeMenuItem) {\n      return null;\n    }\n    const first = this._menuItems.indexOf(this.firstMenuItem);\n    const last = this._menuItems.indexOf(this.lastMenuItem);\n    let found = false;\n    let result = this._menuItems.indexOf(this._activeMenuItem) + dir;\n    while (!found && result >= first && result <= last) {\n      const item = this._menuItems[result];\n      found = item.type !== 'divider' && !item.hidden && !item.disabled;\n      result += dir;\n    }\n\n    return found\n      ? this._menuItems[result - dir]\n      : dir > 0\n      ? this.lastMenuItem\n      : this.firstMenuItem;\n  }\n\n  static _collator: Intl.Collator;\n\n  static get collator(): Intl.Collator {\n    if (Menu._collator) return Menu._collator;\n    Menu._collator = new Intl.Collator(undefined, {\n      usage: 'search',\n      sensitivity: 'base',\n    });\n    return Menu._collator;\n  }\n\n  findMenuItem(text: string): MenuItem | null {\n    const candidates = this._menuItems.filter(\n      (x) => x.type !== 'divider' && !x.hidden && !x.disabled\n    );\n    if (candidates.length === 0) return null;\n    const last =\n      Math.max(...candidates.map((x) => x.label.length)) - text.length;\n\n    if (last < 0) return null;\n\n    // Find a \"contain\" match\n    let result: MenuItem | null = null;\n    let i = 0;\n    while (i < last && !result) {\n      result =\n        candidates.find(\n          (x) =>\n            Menu.collator.compare(text, x.label.substr(i, text.length)) === 0\n        ) ?? null;\n      i++;\n    }\n\n    return result;\n  }\n\n  makeElement(container?: HTMLElement | null): HTMLElement {\n    const ul = container ?? document.createElement('ul');\n    ul.classList.add('menu-container');\n    ul.setAttribute('part', 'menu-container');\n    ul.setAttribute('tabindex', '-1');\n    ul.setAttribute('role', 'menu');\n    ul.setAttribute('aria-orientation', 'vertical');\n    ul.addEventListener('wheel', this);\n\n    // Remove all items\n    ul.textContent = '';\n\n    // Add back all necessary items (after they've been updated if applicable)\n    for (const { element } of this._menuItems) {\n      if (element) ul.append(element);\n    }\n    ul.querySelector('li:first-of-type')?.setAttribute('tabindex', '0');\n\n    return ul;\n  }\n\n  /**\n   * Construct (or return a cached version) of an element representing\n   * the items in this menu (model -> view)\n   */\n  get element(): HTMLElement {\n    if (!this._element) {\n      this._element = this.makeElement(this._assignedContainer);\n    }\n\n    return this._element;\n  }\n\n  /**\n   * @param parent: where the menu should be attached\n   * @return false if no menu to show\n   */\n  show(options: {\n    parent: Node;\n    location?: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): boolean {\n    this.updateMenu(options?.keyboardModifiers);\n    if (this.menuItems.filter((x) => !x.hidden).length === 0) return false;\n\n    options.parent.appendChild(this.element);\n\n    if (options.location) {\n      fitInViewport(this.element, {\n        location: options.location,\n        alternateLocation: options.alternateLocation,\n        verticalPos: 'bottom',\n        horizontalPos: 'right',\n      });\n    }\n\n    this.element.focus();\n\n    // Notify our parent we have opened\n    // (so the parent can close any other open submenu and/or\n    // change its state to display the active state correctly)\n    if (this.parentMenu) {\n      this.parentMenu.openSubmenu = this;\n    }\n\n    return true;\n  }\n\n  hide(): void {\n    // Hide any of our child submenus\n    this.openSubmenu = null;\n\n    this.activeMenuItem = null;\n\n    // Notify our parent\n    if (this.parentMenu) {\n      this.parentMenu.openSubmenu = null;\n    }\n\n    this._element?.parentNode?.removeChild(this._element);\n    this._element = null;\n  }\n\n  /**\n   * This method is called to record that one of our submenus has opened.\n   * To open a submenu call openSubmenu() on the item with the submenu\n   * or show() on the submenu.\n   */\n  set openSubmenu(submenu: MenuInterface | null) {\n    const expanded = submenu !== null;\n    // We're closing a submenu\n    if (this.activeMenuItem?.submenu) {\n      this.activeMenuItem.element?.setAttribute(\n        'aria-expanded',\n        expanded.toString()\n      );\n    }\n\n    this.isSubmenuOpen = expanded;\n  }\n\n  appendMenuItem(\n    menuItem: MenuItemTemplate | UIMenuItem,\n    keyboardModifiers?: KeyboardModifiers\n  ): void {\n    this.insertMenuItem(-1, menuItem, keyboardModifiers);\n  }\n\n  insertMenuItem(\n    pos: number,\n    menuItem: MenuItemTemplate | UIMenuItem,\n    keyboardModifiers?: KeyboardModifiers\n  ): void {\n    if (pos < 0) pos = Math.max(0, this._menuItems.length - 1);\n\n    const item =\n      menuItem instanceof UIMenuItem\n        ? new MenuItemFromElement(menuItem, this)\n        : new MenuItemFromTemplate(menuItem, this, {\n            keyboardModifiers,\n          });\n\n    this._menuItems.splice(pos + 1, 0, item);\n  }\n}\n\nexport function evalToBoolean(\n  item: MenuItemTemplate,\n  value:\n    | boolean\n    | undefined\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean),\n  keyboardModifiers?: KeyboardModifiers\n): boolean | undefined {\n  if (typeof value === 'boolean') return value;\n  if (typeof value === 'function') {\n    return value(item, keyboardModifiers);\n  }\n\n  return undefined;\n}\n\nexport function evalToString(\n  item: MenuItemTemplate,\n  value:\n    | string\n    | undefined\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string),\n  options?: {\n    keyboardModifiers?: KeyboardModifiers;\n  }\n): string | undefined {\n  if (typeof value === 'string') {\n    return value;\n  }\n\n  if (typeof value === 'function') {\n    return value(item, options?.keyboardModifiers);\n  }\n\n  return undefined;\n}\n\nconst CHEVRON_RIGHT_TEMPLATE = document.createElement('template');\nCHEVRON_RIGHT_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"right-chevron\"><svg focusable=\"false\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><path fill=\"currentColor\" d=\"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z\"></path></svg></span>`;\n\nconst CHECKMARK_TEMPLATE = document.createElement('template');\nCHECKMARK_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"checkmark\"><svg  xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M435.848 83.466L172.804 346.51l-96.652-96.652c-4.686-4.686-12.284-4.686-16.971 0l-28.284 28.284c-4.686 4.686-4.686 12.284 0 16.971l133.421 133.421c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-28.284-28.284c-4.686-4.686-12.284-4.686-16.97 0z\"></path></svg>\n</span>`;\n\nexport type MenuSelectEvent = {\n  keyboardModifiers?: KeyboardModifiers;\n  id?: string;\n  label?: string;\n  data?: any;\n  element?: HTMLElement;\n};\n\ndeclare global {\n  /**\n   * Map the custom event names to types\n   * @internal\n   */\n  export interface DocumentEventMap {\n    ['select']: CustomEvent<MenuSelectEvent>;\n  }\n}\n\nexport class MenuItemFromTemplate extends MenuItem {\n  _type: 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio';\n  _label?: string;\n  _disabled: boolean;\n  _hidden: boolean;\n\n  ariaLabel?: string;\n  ariaDetails?: string;\n  checked?: boolean;\n  onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n  submenu?: MenuInterface;\n  id?: string;\n  data?: any;\n\n  _element: HTMLElement | null = null;\n\n  constructor(\n    template: MenuItemTemplate,\n    parentMenu: MenuInterface,\n    options?: {\n      keyboardModifiers?: KeyboardModifiers;\n    }\n  ) {\n    super(parentMenu);\n    this.parentMenu = parentMenu;\n\n    this._hidden =\n      evalToBoolean(template, template.hidden, options?.keyboardModifiers) ??\n      false;\n    this._disabled =\n      evalToBoolean(template, template.disabled, options?.keyboardModifiers) ??\n      false;\n    this.checked =\n      evalToBoolean(template, template.checked, options?.keyboardModifiers) ??\n      false;\n\n    this.id = template.id;\n    this._label = evalToString(template, template.label, options);\n    this.ariaLabel = evalToString(template, template.ariaLabel, options);\n    this.ariaDetails = evalToString(template, template.ariaDetails, options);\n    if (typeof template.onSelect) {\n      this.onSelect = template.onSelect;\n    }\n\n    this.data = template.data;\n\n    if (Array.isArray(template.submenu)) {\n      this._type = 'submenu';\n      this.submenu = new Menu(template.submenu, {\n        parentMenu,\n      });\n    } else if (template.type === undefined && template.checked !== undefined) {\n      this._type = 'checkbox';\n    } else {\n      this._type = template.type ?? 'normal';\n    }\n  }\n\n  get type(): 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio' {\n    return this._type;\n  }\n\n  get label(): string {\n    return this._label ?? this.ariaLabel ?? '';\n  }\n\n  get hidden(): boolean {\n    return this._hidden;\n  }\n\n  get disabled(): boolean {\n    return this._disabled;\n  }\n\n  private render(): HTMLElement | null {\n    if (this.hidden) return null;\n\n    if (this.type === 'divider') {\n      const li = document.createElement('li');\n      li.setAttribute('part', 'menu-divider');\n      li.setAttribute('role', 'divider');\n      return li;\n    }\n\n    if (\n      this.type !== 'normal' &&\n      this.type !== 'submenu' &&\n      this.type !== 'radio' &&\n      this.type !== 'checkbox'\n    ) {\n      return null;\n    }\n\n    const li = document.createElement('li');\n    li.setAttribute('part', 'menu-item');\n    li.setAttribute('tabindex', '-1');\n    if (this.type === 'radio') {\n      li.setAttribute('role', 'menuitemradio');\n    } else if (this.type === 'checkbox') {\n      li.setAttribute('role', 'menuitemcheckbox');\n    } else {\n      li.setAttribute('role', 'menuitem');\n    }\n\n    if (this.checked) {\n      li.setAttribute('aria-checked', 'true');\n      li.append(CHECKMARK_TEMPLATE.content.cloneNode(true));\n    }\n\n    if (this.submenu) {\n      li.setAttribute('aria-haspopup', 'true');\n      li.setAttribute('aria-expanded', 'false');\n    }\n\n    if (this.ariaLabel) li.setAttribute('aria-label', this.ariaLabel);\n    if (this.ariaDetails) li.setAttribute('aria-label', this.ariaDetails);\n\n    if (this.disabled) {\n      li.setAttribute('aria-disabled', 'true');\n    } else {\n      li.removeAttribute('aria-disabled');\n      li.addEventListener('pointerenter', this);\n      li.addEventListener('pointerleave', this);\n      li.addEventListener('pointerup', this);\n    }\n\n    const span = document.createElement('span');\n    span.innerHTML = this.label;\n    span.className =\n      this.parentMenu.hasCheckbox || this.parentMenu.hasRadio\n        ? 'label indent'\n        : 'label';\n    if (!this.disabled) {\n      span.addEventListener('click', (ev: MouseEvent) => {\n        this.select(keyboardModifiersFromEvent(ev));\n      });\n    }\n\n    li.append(span);\n    if (this.submenu) {\n      li.append(CHEVRON_RIGHT_TEMPLATE.content.cloneNode(true));\n    }\n\n    return li;\n  }\n\n  get active(): boolean {\n    return this.element?.classList.contains('active') ?? false;\n  }\n\n  set active(value: boolean) {\n    if (!this.element) return;\n    if (value) {\n      this.element.classList.add('active');\n    } else {\n      this.element.classList.remove('active');\n    }\n  }\n\n  get element(): HTMLElement | null {\n    if (this._element) return this._element;\n    this._element = this.render();\n    return this._element;\n  }\n\n  dispatchSelect(kbd?: KeyboardModifiers): void {\n    const ev = new CustomEvent<MenuSelectEvent>('select', {\n      detail: {\n        keyboardModifiers: kbd,\n        id: this.id,\n        label: this.label,\n        data: this.data,\n      },\n    });\n    if (typeof this.onSelect === 'function') {\n      this.onSelect(ev);\n    } else {\n      this.parentMenu.dispatchEvent(ev);\n    }\n  }\n}\n\nexport class MenuItemFromElement extends MenuItem {\n  // The <ui-menu-item> in the <slot> serves as the 'template' for this\n  // menu item\n  _sourceElement: UIElement;\n  // The source element is cloned and inserted in a <li>\n  _sourceElementClone?: UIElement;\n  // The <li> is cached\n  _cachedElement: HTMLElement | null = null;\n\n  constructor(element: UIMenuItem, parentMenu: MenuInterface) {\n    super(parentMenu);\n    this.parentMenu = parentMenu;\n    this._sourceElement = element;\n    element.menuItem = this;\n\n    // Read a <ui-submenu> element if there is one\n    if (element.shadowRoot) {\n      const submenuElements = element.shadowRoot\n        .querySelector<HTMLSlotElement>('slot')\n        ?.assignedElements()\n        .filter<UISubmenu>((x): x is UISubmenu => x.tagName === 'UI-SUBMENU');\n      console.assert(\n        submenuElements && submenuElements.length <= 1,\n        'Expected no more than one submenu'\n      );\n      if (submenuElements && submenuElements.length > 0) {\n        this.submenu = new Submenu({\n          host: submenuElements[0],\n          parentMenu,\n        });\n      }\n    }\n  }\n\n  get type(): 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio' {\n    if (this.divider) return 'divider';\n    if (this.submenu) return 'submenu';\n    // @todo:  radio, checkbox\n    return 'normal';\n  }\n\n  get label(): string {\n    return this._sourceElement.innerHTML;\n  }\n\n  get hidden(): boolean {\n    return this._sourceElement.hasAttribute('hidden');\n  }\n\n  set hidden(value: boolean) {\n    if (value) {\n      this._sourceElementClone?.setAttribute('hidden', '');\n    } else {\n      this._sourceElementClone?.removeAttribute('hidden');\n    }\n  }\n\n  get disabled(): boolean {\n    return this._sourceElement.hasAttribute('disabled');\n  }\n\n  set disabled(value: boolean) {\n    if (!this._cachedElement) return;\n    if (value) {\n      this._sourceElementClone?.setAttribute('disabled', '');\n      addPart(this._cachedElement, 'disabled');\n    } else {\n      this._sourceElementClone?.removeAttribute('disabled');\n      removePart(this._cachedElement, 'disabled');\n    }\n  }\n\n  get checked(): boolean {\n    return this._sourceElement.hasAttribute('checked');\n  }\n\n  set checked(value: boolean) {\n    if (!this._cachedElement) return;\n    if (value) {\n      this._sourceElementClone?.setAttribute('checked', '');\n      addPart(this._cachedElement, 'checked');\n    } else {\n      this._sourceElementClone?.removeAttribute('checked');\n      removePart(this._cachedElement, 'checked');\n    }\n  }\n\n  get divider(): boolean {\n    return this._sourceElement.hasAttribute('divider');\n  }\n\n  set divider(value: boolean) {\n    if (value) {\n      this._sourceElementClone?.setAttribute('divider', '');\n    } else {\n      this._sourceElementClone?.removeAttribute('divider');\n    }\n  }\n\n  get active(): boolean {\n    return this._cachedElement?.classList.contains('active') ?? false;\n  }\n\n  set active(value: boolean) {\n    if (!this._cachedElement) return;\n    // For the active attribute, set the value on the sourced element\n    // (the <ui-menu-item>)\n    if (value) {\n      this._cachedElement?.classList.add('active');\n      addPart(this._cachedElement, 'active');\n      this._sourceElementClone?.setAttribute('active', '');\n    } else {\n      this._cachedElement?.classList.remove('active');\n      removePart(this._cachedElement, 'active');\n      this._sourceElementClone?.removeAttribute('active');\n    }\n  }\n\n  private render(): HTMLElement | null {\n    if (this.hidden) return null;\n\n    if (this.divider) {\n      const li = document.createElement('li');\n      li.setAttribute('part', 'menu-divider');\n      li.setAttribute('role', 'divider');\n      return li;\n    }\n\n    const li = document.createElement('li');\n    li.setAttribute('part', 'menu-item');\n    li.setAttribute('tabindex', '-1');\n    if (this.type === 'radio') {\n      li.setAttribute('role', 'menuitemradio');\n    } else if (this.type === 'checkbox') {\n      li.setAttribute('role', 'menuitemcheckbox');\n    } else {\n      li.setAttribute('role', 'menuitem');\n    }\n\n    if (this.checked) {\n      li.setAttribute('aria-checked', 'true');\n      li.append(CHECKMARK_TEMPLATE.content.cloneNode(true));\n    }\n\n    if (this.submenu) {\n      li.setAttribute('aria-haspopup', 'true');\n      li.setAttribute('aria-expanded', 'false');\n    }\n\n    if (this.disabled) {\n      li.setAttribute('aria-disabled', 'true');\n    } else {\n      li.removeAttribute('aria-disabled');\n      li.addEventListener('pointerenter', this);\n      li.addEventListener('pointerleave', this);\n      li.addEventListener('pointerup', this);\n    }\n\n    if (!this.disabled) {\n      li.addEventListener('click', (ev: MouseEvent) => {\n        this.select(keyboardModifiersFromEvent(ev));\n      });\n    }\n\n    this._sourceElementClone = this._sourceElement.cloneNode(true) as UIElement;\n    li.append(this._sourceElementClone);\n    if (this.submenu) {\n      li.append(CHEVRON_RIGHT_TEMPLATE.content.cloneNode(true));\n    }\n\n    return li;\n  }\n\n  get element(): HTMLElement | null {\n    if (this._cachedElement) return this._cachedElement;\n    this._cachedElement = this.render();\n    return this._cachedElement;\n  }\n\n  dispatchSelect(kbd?: KeyboardModifiers): void {\n    const ev = new CustomEvent<MenuSelectEvent>('select', {\n      detail: {\n        keyboardModifiers: kbd,\n        id: this._sourceElement.getAttribute('id') ?? '',\n        label: this.label,\n        element: this._sourceElement,\n      },\n    });\n    if (typeof this._sourceElement.onselect === 'function') {\n      this._sourceElement.onselect(ev);\n    } else {\n      this.parentMenu.dispatchEvent(ev);\n    }\n  }\n}\n\nexport class Submenu extends Menu {\n  source: UISubmenu;\n  constructor(options: { host: UISubmenu; parentMenu: MenuInterface }) {\n    super([], {\n      parentMenu: options.parentMenu,\n      host: options.host,\n    });\n    this.source = options.host;\n  }\n\n  get element(): HTMLElement {\n    if (this._element) return this._element;\n\n    const clone = this.source.cloneNode(true) as UISubmenu;\n    // Clone.style.display = 'block';\n    clone.importStyle();\n    this.makeElement(clone.shadowRoot?.querySelector('ul'));\n    this._element = clone;\n    return clone;\n  }\n\n  show(options?: {\n    location?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): boolean {\n    if (!this.parentMenu?.rootMenu) return false;\n    return super.show({\n      ...options,\n      parent: this.parentMenu.rootMenu.scrim,\n    });\n  }\n\n  /**\n   */\n  hide(): void {\n    super.hide();\n  }\n}\n","import {\n  equalKeyboardModifiers,\n  KeyboardModifiers,\n  keyboardModifiersFromEvent,\n  mightProducePrintableCharacter,\n} from '../common/events';\nimport { Scrim } from '../common/scrim';\nimport { Menu, MenuItemTemplate } from './menu-core';\nimport { MenuInterface, RootMenuInterface } from './menu-base';\n\nexport class RootMenu extends Menu implements RootMenuInterface {\n  lastMoveEvent?: PointerEvent;\n\n  private typingBufferResetTimer = 0;\n  private typingBuffer: string;\n  private readonly _scrim: Scrim;\n  private _openTimestamp?: number;\n  private currentKeyboardModifiers?: KeyboardModifiers;\n  private hysteresisTimer = 0;\n  /**\n   * - 'closed': the menu is not visible\n   * - 'open': the menu is visible as long as the mouse button is pressed\n   * - 'modal': the menu is visible until dismissed, even with the mouse button\n   * released\n   */\n  state: 'closed' | 'open' | 'modal';\n\n  /** If true, the state of some of the menu items in this menu are\n   * provide by a function and may need to be updated dynamically\n   */\n  isDynamic: boolean;\n\n  /**\n   * If an `options.assignedElement` is provided, the root menu is\n   * attached to that element (the element will be modified\n   * to display the menu). Use this when using a popup menu.\n   * In this mode, call `show()` and `hide()` to control the\n   * display of the menu.\n   *\n   */\n  constructor(\n    menuItems: MenuItemTemplate[],\n    options?: {\n      host?: Element;\n      assignedElement?: HTMLElement | null;\n      keyboardModifiers?: KeyboardModifiers;\n    }\n  ) {\n    super(menuItems, {\n      host: options?.host,\n      assignedContainer: options?.assignedElement ?? null,\n    });\n    this.isDynamic = menuItems.some(isDynamic);\n    this.currentKeyboardModifiers = options?.keyboardModifiers;\n    this.typingBuffer = '';\n    this.state = 'closed';\n\n    this._scrim = new Scrim({\n      onClose: () => {\n        this.hide();\n      },\n    });\n  }\n\n  /**\n   * The currently active menu: could be the root menu or a submenu\n   */\n  get activeMenu(): MenuInterface {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let result: MenuInterface = this;\n    while (result.isSubmenuOpen) {\n      result = result.activeMenuItem!.submenu!;\n    }\n\n    return result;\n  }\n\n  handleKeyupEvent(ev: KeyboardEvent): void {\n    if (this.isDynamic) {\n      const newModifiers = keyboardModifiersFromEvent(ev);\n      if (\n        !equalKeyboardModifiers(this.currentKeyboardModifiers, newModifiers)\n      ) {\n        this.updateMenu(newModifiers);\n        this.currentKeyboardModifiers = newModifiers;\n      }\n    }\n  }\n\n  handleKeydownEvent(ev: KeyboardEvent): void {\n    if (ev.key === 'Tab') {\n      // Close and bubble\n      this.rootMenu.hide();\n      return;\n    }\n\n    if (this.isDynamic) {\n      const newModifiers = keyboardModifiersFromEvent(ev);\n      if (\n        !equalKeyboardModifiers(this.currentKeyboardModifiers, newModifiers)\n      ) {\n        this.updateMenu(newModifiers);\n        this.currentKeyboardModifiers = newModifiers;\n      }\n    }\n\n    let handled = true;\n    const menu = this.activeMenu;\n    const menuItem = menu.activeMenuItem;\n    switch (ev.key) {\n      case ' ':\n      case 'Space':\n      case 'Return':\n      case 'Enter':\n        menuItem?.select(keyboardModifiersFromEvent(ev));\n        break;\n      case 'ArrowRight':\n        if (menuItem?.submenu) {\n          menuItem.select(keyboardModifiersFromEvent(ev));\n          this.activeMenu.activeMenuItem = this.activeMenu.firstMenuItem;\n        } else if (!menuItem) {\n          menu.activeMenuItem = menu.firstMenuItem;\n        }\n\n        break;\n      case 'ArrowLeft':\n        if (menu === this.rootMenu) {\n          if (!menuItem) {\n            menu.activeMenuItem = menu.firstMenuItem;\n          }\n        } else {\n          menu.hide();\n          const activeMenu = menu.parentMenu!.activeMenuItem;\n          if (activeMenu) {\n            const { element } = activeMenu;\n            element?.focus();\n            element?.classList.remove('is-submenu-open');\n          }\n        }\n\n        break;\n      case 'ArrowDown':\n        menu.activeMenuItem = menu.nextMenuItem(+1);\n        break;\n      case 'ArrowUp':\n        menu.activeMenuItem = menu.nextMenuItem(-1);\n        break;\n      case 'Home':\n      case 'PageUp':\n        menu.activeMenuItem = menu.firstMenuItem;\n        break;\n      case 'End':\n      case 'PageDown':\n        menu.activeMenuItem = menu.lastMenuItem;\n        break;\n      case 'Escape':\n        this.rootMenu.hide();\n        break;\n      case 'Backspace':\n        if (this.typingBuffer) {\n          this.typingBuffer = this.typingBuffer.slice(0, -1);\n          if (this.typingBuffer) {\n            clearTimeout(this.typingBufferResetTimer);\n            const newItem = menu.findMenuItem(this.typingBuffer);\n            if (newItem) menu.activeMenuItem = newItem;\n\n            this.typingBufferResetTimer = setTimeout(() => {\n              this.typingBuffer = '';\n            }, 500);\n          }\n        }\n\n        break;\n      default:\n        if (mightProducePrintableCharacter(ev)) {\n          if (isFinite(this.typingBufferResetTimer)) {\n            clearTimeout(this.typingBufferResetTimer);\n          }\n\n          this.typingBuffer += ev.key;\n          const newItem = menu.findMenuItem(this.typingBuffer);\n          if (newItem) menu.activeMenuItem = newItem;\n\n          this.typingBufferResetTimer = setTimeout(() => {\n            this.typingBuffer = '';\n          }, 500);\n        } else {\n          handled = false;\n        }\n    }\n\n    if (handled) {\n      ev.preventDefault();\n      ev.stopPropagation();\n    }\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'keydown') {\n      this.handleKeydownEvent(event as KeyboardEvent);\n    } else if (event.type === 'keyup') {\n      this.handleKeyupEvent(event as KeyboardEvent);\n    } else if (event.type === 'pointermove') {\n      this.lastMoveEvent = event as PointerEvent;\n    } else if (event.type === 'pointerup' && event.target === this.scrim) {\n      if (\n        Number.isFinite(this.rootMenu._openTimestamp!) &&\n        Date.now() - this.rootMenu._openTimestamp! < 120\n      ) {\n        // Hold mode...\n        this.state = 'modal';\n      } else {\n        // Cancel\n        this.hide();\n      }\n    } else if (event.type === 'contextmenu') {\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    super.handleEvent(event);\n  }\n\n  dispatchEvent(ev: Event): boolean {\n    if (!this.menuHost) return false;\n    return this.menuHost.dispatchEvent(ev);\n  }\n\n  get scrim(): Element {\n    return this._scrim.element;\n  }\n\n  private connectScrim(root?: Node | null): void {\n    const { scrim } = this;\n    scrim.addEventListener('pointerup', this);\n\n    scrim.addEventListener('contextmenu', this);\n\n    scrim.addEventListener('keydown', this);\n    scrim.addEventListener('keyup', this);\n    scrim.addEventListener('pointermove', this);\n\n    this._scrim.open({ root });\n  }\n\n  private disconnectScrim(): void {\n    const { scrim } = this;\n    scrim.removeEventListener('pointerup', this);\n\n    scrim.removeEventListener('contextmenu', this);\n\n    scrim.removeEventListener('keydown', this);\n    scrim.removeEventListener('keyup', this);\n    scrim.removeEventListener('pointermove', this);\n    this._scrim.close();\n  }\n\n  get rootMenu(): RootMenu {\n    // I AM THE ONE WHO KNOCKS\n    return this;\n  }\n\n  show(options?: {\n    location?: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    parent?: Node | null; // Where the menu should attach\n    keyboardModifiers?: KeyboardModifiers;\n  }): boolean {\n    // Connect the scrim now, so that the menu can be measured and placed\n    this.connectScrim(options?.parent);\n    if (!super.show({ ...options, parent: this.scrim })) {\n      // There was nothing to show: remove the scrim\n      this.disconnectScrim();\n      return false;\n    }\n\n    // Record the opening time.\n    // If we receive a mouseup within a small delta of the open time stamp\n    // hold the menu open until it is dismissed, otherwise close it.\n    this._openTimestamp = Date.now();\n    this.state = 'open';\n    return true;\n  }\n\n  hide(): void {\n    this.cancelDelayedOperation();\n    if (this.state !== 'closed') {\n      this.activeMenuItem = null;\n      super.hide();\n      this.state = 'closed';\n      this.disconnectScrim();\n    }\n  }\n\n  scheduleOperation(fn: () => void): void {\n    this.cancelDelayedOperation();\n\n    const delay = this.submenuHysteresis;\n    if (delay <= 0) {\n      fn();\n      return;\n    }\n\n    this.hysteresisTimer = setTimeout(() => {\n      this.hysteresisTimer = 0;\n      fn();\n    }, delay);\n  }\n\n  cancelDelayedOperation(): void {\n    if (this.hysteresisTimer) {\n      clearTimeout(this.hysteresisTimer);\n      this.hysteresisTimer = 0;\n    }\n  }\n\n  /**\n   * Delay (in milliseconds) before displaying a submenu.\n   * Prevents distracting \"flashing\" of submenus when moving through the\n   * options in a menu.\n   */\n  get submenuHysteresis(): number {\n    return 120;\n  }\n}\n\nfunction isDynamic(item: MenuItemTemplate): boolean {\n  const result =\n    typeof item.disabled === 'function' ||\n    typeof item.hidden === 'function' ||\n    typeof item.checked === 'function' ||\n    typeof item.label === 'function' ||\n    typeof item.ariaDetails === 'function' ||\n    typeof item.ariaLabel === 'function';\n\n  if (item.type === 'submenu' && item.submenu) {\n    return result || item.submenu.some(isDynamic);\n  }\n\n  return result;\n}\n","import {\n  eventLocation,\n  keyboardModifiersFromEvent,\n  KeyboardModifiers,\n  LongPressDetector,\n} from '../common/events';\nimport { UIElement } from '../common/ui-element';\nimport { MenuItemTemplate } from './menu-core';\nimport { MENU_TEMPLATE, MENU_STYLE } from './menu-templates';\nimport { RootMenu } from './root-menu';\n\n/**\n * This web component display a contextual menu when the user performs the\n * appropriate gesture (right-click, control+click, shift+F10, etc...),\n * handles the user interaction to navigate the items in the menu and submenus\n * and either invoke the `onSelect()` hook associated with the selected menu item\n * or dispatches a 'select' event when the user completes their selection.\n *\n * Place this element inside a container and the contextual menu will be\n * displayed when a right-click/control+click/long tap is performed in the\n * container or if the container is keyboard focused when shift+f10 is pressed.\n * In the former case, the menu is diplayed where the click/tap occured.\n * In the later case, the menu is displayed in the center of the parent container.\n *\n * This component is:\n * - screen-reader compatible\n * - keyboard navigable\n * - dark-theme aware\n * - responsive (the menu and submenus will attempt to avoid being displayed\n *   outside of the viewport boundary)\n *\n * Principles of Operation\n *\n * The content of a menu (menu items and submenus) is represented by a 'model',\n * an instance of the Menu class.\n * The model is created from:\n * - argument to the UIContextMenu constructor\n * - setting the `menuItems` property\n * - a `<script>` tag containing a JSON description of menu items\n * - a set of child `<ui-menu-item>` elements.\n *\n * A menu can also have a `<style>` tag, which is applied to style the menu\n * once it is open.\n *\n * The `<ui-context-menu>` and its child elements are kept hidden.\n *\n * When the menu is invoked (with `show()`) a scrim element is created\n * and added as a child of the `<ui-context-menu>`, and a new `<ul>` element\n * is created and attached as a child of the scrim.\n *\n * A set of `<li>` element is added as children of the `<ul>` element, one\n * for each visible menu item, whether this menu item was specified in\n * JSON or with a `<menu-item>` element. The `<li>` element are made of\n * the following components:\n * - a checkmark (optional)\n * - a text label (as a text node, if specified from JSON or as a cloned\n * `UIMenuItemElement` if specified from the `<ui-menu-item>`)\n * - a submenu indicator\n *\n */\nexport class UIContextMenu extends UIElement {\n  private rootMenu?: RootMenu;\n  // The menu items specified via a constructor or setter\n  private templateMenuItems: MenuItemTemplate[];\n\n  private longPressDetector?: LongPressDetector;\n\n  constructor(menuItems?: MenuItemTemplate[]) {\n    super({\n      template: MENU_TEMPLATE,\n      style: MENU_STYLE,\n    });\n    this.templateMenuItems = menuItems ?? [];\n  }\n\n  set menuItems(menuItems: MenuItemTemplate[]) {\n    this.templateMenuItems = menuItems;\n    if (this.rootMenu) {\n      this.rootMenu.menuItemTemplates = menuItems;\n    }\n  }\n\n  get menuItems(): MenuItemTemplate[] {\n    return this.templateMenuItems;\n  }\n\n  /**\n   * @internal\n   */\n  handleEvent(event: Event): void {\n    this.longPressDetector?.dispose();\n    this.longPressDetector = undefined;\n\n    if (event.type === 'contextmenu') {\n      const evt = event as MouseEvent;\n      this.show({\n        location: [Math.round(evt.clientX), Math.round(evt.clientY)],\n        keyboardModifiers: keyboardModifiersFromEvent(evt),\n      });\n      event.preventDefault();\n      event.stopPropagation();\n    } else if (event.type === 'keydown') {\n      const evt = event as KeyboardEvent;\n      if (evt.code === 'ContextMenu' || (evt.code === 'F10' && evt.shiftKey)) {\n        // Shift+F10 = contextual menu\n        // Get the center of the parent\n        const bounds = this.parentElement?.getBoundingClientRect();\n        if (bounds) {\n          this.show({\n            location: [\n              Math.round(bounds.left + bounds.width / 2),\n              Math.round(bounds.top + bounds.height / 2),\n            ],\n            keyboardModifiers: keyboardModifiersFromEvent(evt),\n          });\n          event.preventDefault();\n          event.stopPropagation();\n        }\n      }\n    } else if (\n      event.type === 'pointerdown' &&\n      event.target === this.shadowRoot?.host.parentNode\n    ) {\n      const pt = eventLocation(event);\n      this.longPressDetector = new LongPressDetector(event, () => {\n        this.show({\n          location: pt,\n          keyboardModifiers: keyboardModifiersFromEvent(event),\n        });\n      });\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  connectedCallback(): void {\n    super.connectedCallback();\n    // Listen for contextual menu in the parent\n    const parent = this.parentNode;\n    if (parent) {\n      parent.addEventListener('contextmenu', this);\n      parent.addEventListener('keydown', this);\n      parent.addEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    const parent = this.parentNode;\n    if (parent) {\n      parent.removeEventListener('contextmenu', this);\n      parent.removeEventListener('keydown', this);\n      parent.removeEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  focus(): void {\n    super.focus();\n    if (this.rootMenu && this.rootMenu.state !== 'closed') {\n      if (this.rootMenu.activeMenuItem) {\n        this.rootMenu.activeMenuItem.element?.focus();\n      } else {\n        this.rootMenu.element.focus();\n      }\n    }\n  }\n\n  /**\n   * Display the menu at the specified location.\n   * If provided, the `keyboardModifiers` option can change what commands\n   * are visible, enabled, or what their label is.\n   *\n   * The contextual menu is shown automatically when the appropriate UI gesture\n   * is performed by the user (right-click, shift+F10, etc...). This method\n   * only needs to be called to trigger the menu manually (for example to\n   * trigger it on click of an item).\n   */\n  show(options?: {\n    location?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): void {\n    if (!this.rootMenu) {\n      // Import inline (in the component) style sheet\n      this.importStyle();\n\n      // Inline menu items (as a JSON structure in a <script> tag\n      // in the markup)\n      let jsonMenuItems: MenuItemTemplate[] = this.json as MenuItemTemplate[];\n      if (!Array.isArray(jsonMenuItems)) jsonMenuItems = [];\n      this.rootMenu = new RootMenu(\n        [...this.templateMenuItems, ...jsonMenuItems],\n        {\n          host: this.shadowRoot?.host,\n          assignedElement: this.shadowRoot?.querySelector<HTMLElement>('ul'),\n        }\n      );\n    }\n\n    this.style.display = 'block';\n    if (this.rootMenu.show({ ...options, parent: this.shadowRoot! })) {\n      if (!this.hasAttribute('tabindex')) {\n        this.setAttribute('tabindex', '-1');\n      }\n\n      this.focus();\n    } else {\n      this.style.display = 'none';\n    }\n  }\n\n  /**\n   * Hide the menu.\n   *\n   * The visibility of the menu is typically controlled by the user\n   * interaction: the menu is automatically hidden if the user release the\n   * mouse button, or after having selected a command. This is a manual\n   * override that should be very rarely needed.\n   */\n  hide(): void {\n    this.rootMenu?.hide();\n    this.style.display = 'none';\n  }\n}\n\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UIContextMenu: typeof UIContextMenu;\n  }\n  /** @internal */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace JSX {\n    interface IntrinsicElements {\n      'ui-context-menu': UIContextMenu;\n    }\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-context-menu',\n  className: 'UIContextMenu',\n  constructor: UIContextMenu,\n});\n","import { getEdge, getOppositeEdge, UIElement } from '../common/ui-element';\nimport {\n  keyboardModifiersFromEvent,\n  KeyboardModifiers,\n} from '../common/events';\nimport { MenuItemTemplate } from './menu-core';\nimport { RootMenu } from './root-menu';\nimport { MENU_TEMPLATE, MENU_STYLE } from './menu-templates';\n\nexport class UIPopupMenu extends UIElement {\n  position: 'leading' | 'trailing' | 'left' | 'end' = 'leading';\n\n  private rootMenu?: RootMenu;\n  private templateMenuItems: MenuItemTemplate[];\n\n  private _savedTransform?: string;\n\n  constructor(menuItems?: MenuItemTemplate[]) {\n    super({\n      template: MENU_TEMPLATE,\n      style: MENU_STYLE,\n    });\n    this.templateMenuItems = menuItems ?? [];\n    this.reflectStringAttribute('position');\n  }\n\n  get menuItems(): MenuItemTemplate[] {\n    return this.templateMenuItems;\n  }\n\n  set menuItems(menuItems: MenuItemTemplate[]) {\n    this.templateMenuItems = menuItems;\n    if (this.rootMenu) {\n      this.rootMenu.menuItemTemplates = menuItems;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  handleEvent(event: Event): void {\n    if (event.type === 'keydown' && event.target === this.parentElement) {\n      const evt = event as KeyboardEvent;\n      if (evt.code === 'Return' || evt.code === 'Enter') {\n        this.show({\n          keyboardModifiers: keyboardModifiersFromEvent(evt),\n        });\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    } else if (event.type === 'pointerdown') {\n      console.assert(this.shadowRoot?.host.parentNode === this.parentElement);\n      if (event.target === this.shadowRoot?.host.parentNode) {\n        this.show({\n          keyboardModifiers: keyboardModifiersFromEvent(event),\n        });\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  connectedCallback(): void {\n    super.connectedCallback();\n    // Listen for contextual menu in the parent\n    const parent = this.parentNode;\n    if (parent) {\n      parent.addEventListener('keydown', this);\n      parent.addEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    const parent = this.parentNode;\n    if (parent) {\n      parent.removeEventListener('keydown', this);\n      parent.removeEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  focus(): void {\n    super.focus();\n    if (this.rootMenu && this.rootMenu.state !== 'closed') {\n      if (this.rootMenu.activeMenuItem) {\n        this.rootMenu.activeMenuItem.element?.focus();\n      } else {\n        this.rootMenu.element.focus();\n      }\n    }\n  }\n\n  /**\n   * Display the menu at the specified location.\n   * If provided, the `keyboardModifiers` option can change what commands\n   * are visible, enabled, or what their label is.\n   *\n   * The contextual menu is shown automatically when the appropriate UI gesture\n   * is performed by the user (right-click, shift+F10, etc...). This method\n   * only needs to be called to trigger the menu manually (for example to\n   * trigger it on click of an item).\n   */\n  show(options?: { keyboardModifiers?: KeyboardModifiers }): void {\n    if (!this.parentElement) return;\n    if (!this.rootMenu) {\n      // Import inline (in the component) style sheet\n      this.importStyle();\n\n      // Inline menu items (as a JSON structure in a <script> tag\n      // in the markup)\n      let jsonMenuItems = (this.json as unknown) as MenuItemTemplate[];\n      if (!Array.isArray(jsonMenuItems)) jsonMenuItems = [];\n      this.rootMenu = new RootMenu(\n        [...this.templateMenuItems, ...jsonMenuItems],\n        {\n          host: this.shadowRoot?.host,\n          assignedElement: this.shadowRoot?.querySelector<HTMLElement>('ul'),\n        }\n      );\n    }\n\n    this.style.display = 'inline-block';\n    // This is yucky...\n    // The 'fixed' display mode (used by the scrim to position itself over\n    // the viewport) becomes 'relative' when a transform is specified\n    // on a parent element in WebKit and Chromium.\n    // See https://stackoverflow.com/revisions/15256339/2\n    // So we have to remove any transform that might be present to prevent\n    // the scrim from being displayed incorrectly.\n    this._savedTransform = window.getComputedStyle(\n      this.parentElement\n    ).transform;\n    if (this._savedTransform !== 'none') {\n      this.parentElement.style.transform = 'none';\n    }\n\n    const bounds = this.parentElement.getBoundingClientRect();\n    if (\n      this.rootMenu.show({\n        ...options,\n        location: [\n          getEdge(bounds, this.position ?? 'leading', this.computedDir),\n          bounds.bottom,\n        ],\n        alternateLocation: [\n          getOppositeEdge(bounds, this.position ?? 'leading', this.computedDir),\n          bounds.bottom,\n        ],\n        parent: this.shadowRoot,\n      })\n    ) {\n      if (!this.hasAttribute('tabindex')) {\n        this.setAttribute('tabindex', '-1');\n      }\n\n      this.focus();\n    } else {\n      this.style.display = 'none';\n    }\n  }\n\n  /**\n   * Hide the menu.\n   *\n   * The visibility of the menu is typically controlled by the user\n   * interaction: the menu is automatically hidden if the user release the\n   * mouse button, or after having selected a command. This is a manual\n   * override that should be very rarely needed.\n   */\n  hide(): void {\n    this.rootMenu?.hide();\n    this.style.display = 'none';\n    if (this._savedTransform !== 'none' && this.parentElement) {\n      this.parentElement.style.transform = this._savedTransform ?? 'none';\n    }\n  }\n}\n\nexport default UIPopupMenu;\n\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UIPopupMenu: typeof UIPopupMenu;\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-popup-menu',\n  className: 'UIPopupMenu',\n  constructor: UIPopupMenu,\n});\n","import { UIElement } from '../common/ui-element';\nimport { MENU_STYLE, MENU_TEMPLATE } from './menu-templates';\n\n/**\n * Use `<ui-submenu>` as a child of a `<ui-menuitem>`.\n *\n * This element is used as a \"template\" for a submenu when a\n * menu is displayed: it displays nothing by itself.\n *\n * It can include a `<style>` tag.\n */\nexport class UISubmenu extends UIElement {\n  constructor() {\n    super({\n      template: MENU_TEMPLATE,\n      style: MENU_STYLE,\n    });\n  }\n}\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UISubmenu: typeof UISubmenu;\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-submenu',\n  className: 'UISubmenu',\n  constructor: UISubmenu,\n});\n","import { UIElement } from './common/ui-element';\n\nexport { UIContextMenu, UIPopupMenu, UISubmenu } from './menus/menus';\n\n/**\n * To insure that all the web components are ready to use, and in particular\n * that custom methods on web components can be called, use:\n * ```\n * try {\n *  await ready();\n * // Ready to use the web components...\n * } catch (e) {\n *  // web components are not supported\n * }\n * ```\n *\n */\nexport async function ready(): Promise<unknown> {\n  if (window?.customElements) {\n    return Promise.all<void>(\n      Object.keys(UIElement.registry).map((x) =>\n        window.customElements.whenDefined(x)\n      )\n    );\n  }\n\n  return Promise.reject<void>(new Error('web components not supported'));\n}\n"],"names":[],"mappings":"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"}