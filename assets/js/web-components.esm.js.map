{"version":3,"file":"web-components.esm.js","sources":["../src/common/updatable.ts","../src/common/ui-element.ts","../src/common/events.ts","../src/menus/menu-templates.ts","../src/common/scrim.ts","../src/menus/menu-base.ts","../src/menus/menu-item-element.ts","../src/menus/menu-core.ts","../src/menus/root-menu.ts","../src/menus/context-menu-element.ts","../src/menus/popup-menu-element.ts","../src/menus/submenu-element.ts","../src/web-components.ts"],"sourcesContent":["export interface Updatable {\n  update(): void;\n}\n\nconst gDirtyList = new Set<Updatable>();\nlet gTimer = 0;\n\nexport function dirty(updatable: Updatable): void {\n  gDirtyList.add(updatable);\n\n  // If there's already a pending timer, bail\n  if (gTimer !== 0) return;\n\n  // Request a timer\n  gTimer = requestAnimationFrame(() => {\n    gTimer = 0;\n    const xs = [...gDirtyList.values()];\n    gDirtyList.clear();\n    for (const x of xs) x.update();\n  });\n}\n","import { Json } from './json';\nimport { dirty, Updatable } from './updatable';\n\n/**\n * In general, the 'source of truth' should be a property rather than an\n * attribute.\n *\n * When that's the case, the property definition specifies how the attribute\n * and property should coordinate:\n * - read initial property value from attribute (or not if attribute = false)\n * - observe attribute: update property value when attribute is changed (or not )\n * - reflect property: update attribute value when property value is changed (or not)\n *\n * If the source of truth is an attribute, simply declare a get/set accessor\n * for the property that reads/write to the attribute.\n */\nexport type PropertyDefinition = {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  type: String | Boolean | Number | Function | string[];\n  default: string;\n  /** If a string, reflect property to attribute with specified name\n   * If true, reflect property to attribute named from property name (kebab-case\n   * variant)\n   * If false, don't initialize property with attribute value, attribute\n   * changes will not affect property\n   * Default: true\n   */\n  attribute: boolean | string;\n  /**\n   * When attribute is updated => property is updated\n   * When property is updated:\n   * If true => the attribute is updated\n   * If false => the attribute is *not* updated\n   * Default: false\n   */\n  reflect: boolean;\n};\n\n/**\n * - When the 'source of truth' is an attribute\n * - Adds property getter/setter reflecting the value of the attribute\n * - Use when the attribute is readonly (used for the construction of the element)\n * or rarely changed\n */\n// export type AttributeDefinition = {\n//   // eslint-disable-next-line @typescript-eslint/ban-types\n//   type: String | Boolean | Number | Function | string[];\n//   default: unknown;\n// };\n\n/**\n * @internal\n */\nexport abstract class UIElement extends HTMLElement implements Updatable {\n  // Registry of UIElement classes to support `await ready()` in 'ui.ts'\n  static registry: Record<string, CustomElementConstructor> = {};\n\n  // The properties of this element and how they map to attributes\n  static properties: Readonly<Record<string, PropertyDefinition>> = {};\n\n  // Content of a `<script type='application/json'></script>` in the light DOM\n  private _json?: Json;\n  // Content of a `<style></style>` in the light DOM\n  private _style?: HTMLStyleElement | null;\n\n  constructor(options?: {\n    template: string | HTMLTemplateElement;\n    style: string | HTMLTemplateElement;\n  }) {\n    super();\n\n    const shadowRoot = this.attachShadow({ mode: 'open' });\n\n    if (options?.template instanceof HTMLTemplateElement) {\n      shadowRoot.append(options.template.content.cloneNode(true));\n    } else if (typeof options?.template === 'string') {\n      shadowRoot.innerHTML = options.template;\n    }\n\n    if (options?.style instanceof HTMLTemplateElement) {\n      shadowRoot.append(options.style.content.cloneNode(true));\n    } else if (typeof options?.style === 'string') {\n      const style = document.createElement('style');\n      style.textContent = options.style;\n      shadowRoot.append(style);\n    }\n  }\n\n  static async register(options: {\n    tag: string;\n    className: string;\n    constructor: CustomElementConstructor;\n  }): Promise<void> {\n    UIElement.registry[options.tag] = options.constructor;\n\n    if (!window.customElements?.get(options.tag)) {\n      (window as { [key: string]: any })[options.className] =\n        options.constructor;\n      window.customElements?.define(options.tag, options.constructor);\n    }\n\n    if (window.customElements) {\n      return window.customElements.whenDefined(options.tag);\n    }\n\n    return Promise.reject<void>(new Error('web components not supported'));\n  }\n\n  private static getAttributeNameForProperty(p: string): string | null {\n    if (!this.properties[p]) return null;\n    if (typeof this.properties[p].attribute === 'boolean') {\n      if (this.properties[p].attribute) {\n        return toKebabCase(p);\n      }\n      return null;\n    } else if (typeof this.properties[p].attribute === 'string') {\n      return this.properties[p].attribute as string;\n    }\n    return null;\n  }\n\n  static get observedAttributes(): string[] {\n    const attributes: string[] = [];\n\n    for (const prop of Object.keys(this.properties)) {\n      const attr = UIElement.getAttributeNameForProperty(prop);\n      if (attr) attributes.push(attr);\n    }\n\n    // @todo: add observed attributes from parent class, if any\n\n    return attributes;\n  }\n\n  set dirty(value: boolean) {\n    if (value) dirty(this);\n  }\n\n  /**\n   * Declare that an attribute should be reflected as a property\n   */\n  reflectStringAttribute(attrName: string, propName = attrName): void {\n    // Attributes should be all lower case, kebab-case.\n    console.assert(attrName.toLowerCase() === attrName);\n    Object.defineProperty(this, propName, {\n      enumerable: true,\n      get(): string {\n        return this.getAttribute(attrName);\n      },\n      set(value: string) {\n        this.setAttribute(attrName, value);\n      },\n    });\n  }\n\n  /**\n   * Declare that an attribute should be reflected as a property\n   */\n  reflectBooleanAttribute(attrName: string, propName = attrName): void {\n    // Attributes should be all lower case, kebab-case.\n    console.assert(attrName.toLowerCase() === attrName);\n    Object.defineProperty(this, propName, {\n      enumerable: true,\n      get(): boolean {\n        return this.hasAttribute(attrName);\n      },\n      set(value: boolean) {\n        if (value) {\n          this.setAttribute(attrName, '');\n        } else {\n          this.removeAttribute(attrName);\n        }\n      },\n    });\n  }\n\n  /**\n   * Declare that an attribute should be reflected as a property\n   */\n  reflectEnumAttribute(\n    attrName: string,\n    attrValues: string[],\n    propName = attrName\n  ): void {\n    // Attributes should be all lower case, kebab-case.\n    console.assert(attrName.toLowerCase() === attrName);\n    Object.defineProperty(this, propName, {\n      enumerable: true,\n      get(): string {\n        let value: string | undefined;\n        for (const x of attrValues) {\n          if (this.hasAttribute(x)) {\n            console.assert(\n              value === undefined,\n              `inconsistent ${attrName} attributes on ${this}`\n            );\n            value = x;\n          }\n        }\n        if (value !== undefined) return value;\n        return this.getAttribute(attrName);\n      },\n      set(value: string) {\n        this.setAttribute(attrName, value);\n        this.setAttribute(value, '');\n        for (const x of attrValues) {\n          if (x !== value) {\n            this.removeAttribute(x);\n          }\n        }\n      },\n    });\n  }\n\n  reflectBooleanAttributes(\n    attrNames: (string | [attrName: string, propName: string])[]\n  ): void {\n    for (const x of attrNames) {\n      if (typeof x === 'string') {\n        this.reflectBooleanAttribute(x);\n      } else {\n        this.reflectBooleanAttribute(x[0], x[1]);\n      }\n    }\n  }\n\n  reflectStringAttributes(\n    attrNames: (string | [attrName: string, propName: string])[]\n  ): void {\n    for (const x of attrNames) {\n      if (typeof x === 'string') {\n        this.reflectStringAttribute(x);\n      } else {\n        this.reflectStringAttribute(x[0], x[1]);\n      }\n    }\n  }\n\n  get computedDir(): 'rtl' | 'ltr' {\n    return getComputedDir(this);\n  }\n\n  /**\n   * @internal\n   */\n  connectedCallback(): void {\n    // this.update();\n  }\n\n  /**\n   * @internal\n   */\n  disconnectedCallback(): void {\n    return;\n  }\n\n  /**\n   * @internal\n   */\n  protected get json(): Json {\n    if (this._json !== undefined) return this._json;\n\n    this._json = null;\n    const slot = this.shadowRoot?.querySelector<HTMLSlotElement>('slot');\n    if (!slot) return null;\n    const json: string = slot\n      .assignedElements()\n      .filter(\n        (x) =>\n          x.tagName === 'SCRIPT' &&\n          (x as HTMLScriptElement).type === 'application/json'\n      )\n      .map((x) => x.textContent)\n      .join('');\n\n    if (!json) return null;\n\n    try {\n      this._json = JSON.parse(json);\n    } catch (error) {\n      // @todo: do this if __DEV__ only\n      // There was an error parsing the JSON.\n      // Display a helpful message.\n      const message = error.toString();\n      const m = message.match(/position (\\d+)/);\n      if (m) {\n        const index = Number.parseInt(m[1]);\n        const extract = json.substring(Math.max(index - 40, 0), index);\n        throw new Error(`${message}\\n${extract.trim()}`);\n      } else {\n        throw error;\n      }\n    }\n\n    return this._json!;\n  }\n\n  /**\n   * @internal\n   */\n  protected get importedStyle(): HTMLStyleElement | null {\n    if (this._style !== undefined) return this._style;\n\n    let stylesheet = '';\n    const slot = this.shadowRoot?.querySelector<HTMLSlotElement>('slot');\n    if (slot) {\n      stylesheet = slot\n        .assignedElements()\n        .filter((x) => x.tagName === 'STYLE')\n        .map((x) => x.textContent)\n        .join('')\n        .trim();\n    }\n    if (stylesheet.length === 0) {\n      this._style = null;\n    } else {\n      this._style = document.createElement('style');\n      this._style.textContent = stylesheet;\n    }\n\n    return this._style;\n  }\n\n  /** If there is an embedded <style> tag in the slot\n   *  \"import\" it in the shadow dom\n   */\n  importStyle(): void {\n    if (this.importedStyle) {\n      this.shadowRoot?.append(this.importedStyle.cloneNode(true));\n    }\n  }\n\n  update(): void {\n    if (!this.isConnected) return;\n\n    // Iterate over all the nodes and remove them\n    // (ensures that eventHandlers are removed, unlike innerHTML = '')\n    while (this.shadowRoot?.firstChild) {\n      this.shadowRoot.firstChild.remove();\n    }\n\n    // Add new nodes\n    const child = this.render();\n    if (child) this.shadowRoot?.append(child);\n\n    this.importStyle();\n  }\n\n  /**\n   * Return a `HTMLElement` that will get attached to the root of\n   * this element.\n   * Event handlers should get added as well.\n   */\n  render(): HTMLElement | null {\n    return null;\n  }\n}\n\n/**\n * An element can have multiple 'parts', which function as a kind of\n * parallel classList.\n *\n * Add a part name to the part list of this element.\n */\nexport function addPart(element: HTMLElement, part: string): void {\n  if (!element) return;\n  const current = element.getAttribute('part') ?? '';\n  if (!current.includes(part)) {\n    element.setAttribute('part', `${current} ${part}`);\n  }\n}\n\n/**\n * Remove a part name from the part list of this element.\n */\nexport function removePart(element: HTMLElement, part: string): void {\n  if (!element) return;\n  const current = element.getAttribute('part') ?? '';\n  if (current.includes(part)) {\n    element.setAttribute(\n      'part',\n      current.replace(new RegExp('\\\\bs*' + part + 's*\\\\b', 'g'), '')\n    );\n  }\n}\n\nexport function getComputedDir(element: HTMLElement): 'ltr' | 'rtl' {\n  if (element.dir && element.dir !== 'auto') {\n    return element.dir as 'ltr' | 'rtl';\n  }\n  if (element.parentElement) return getComputedDir(element.parentElement);\n  return 'ltr';\n}\n\nexport function getOppositeEdge(\n  bounds: DOMRectReadOnly,\n  position: 'leading' | 'trailing' | 'left' | 'end',\n  direction: 'ltr' | 'rtl'\n): number {\n  if (\n    position === 'left' ||\n    (position === 'leading' && direction === 'ltr') ||\n    (position === 'trailing' && direction === 'rtl')\n  ) {\n    return bounds.right;\n  }\n\n  return bounds.left;\n}\n\nexport function getEdge(\n  bounds: DOMRectReadOnly,\n  position: 'leading' | 'trailing' | 'left' | 'end',\n  direction: 'ltr' | 'rtl'\n): number {\n  if (\n    position === 'left' ||\n    (position === 'leading' && direction === 'ltr') ||\n    (position === 'trailing' && direction === 'rtl')\n  ) {\n    return bounds.left;\n  }\n\n  return bounds.right;\n}\n\nfunction toKebabCase(s: string): string {\n  return s\n    .match(\n      /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g\n    )!\n    .map((x: string) => x.toLowerCase())\n    .join('-');\n}\n\nexport function toCamelCase(s: string): string {\n  return s.toLowerCase().replace(/[^a-zA-Z\\d]+(.)/g, (m, c) => c.toUpperCase());\n}\n","export type KeyboardModifiers = {\n  alt: boolean;\n  control: boolean;\n  shift: boolean;\n  meta: boolean;\n};\n\n// We use a class to encapsulate the state that needs to be tracked and,\n// more importantly, to avoid memory leaks by using the `handleEvent()` hook\n// to ensure proper disposal of event handlers\nexport class LongPressDetector {\n  static DELAY = 300; // In ms\n\n  private readonly onLongPress: () => void;\n  private readonly startPoint?: [x: number, y: number];\n  private lastPoint?: [x: number, y: number];\n\n  private timer = 0;\n\n  constructor(triggerEvent: Event, onLongPress: () => void) {\n    this.onLongPress = onLongPress;\n    const location = eventLocation(triggerEvent);\n    if (!location) return;\n\n    this.startPoint = location;\n    this.lastPoint = location;\n\n    this.timer = setTimeout(() => {\n      this.dispose();\n      if (distance(this.lastPoint!, this.startPoint!) < 10) {\n        this.onLongPress();\n      }\n    }, LongPressDetector.DELAY);\n    for (const evt of ['pointermove', 'pointerup', 'pointercancel']) {\n      window.addEventListener(evt, this, { passive: true });\n    }\n  }\n\n  dispose(): void {\n    clearTimeout(this.timer);\n    this.timer = 0;\n\n    for (const evt of ['pointermove', 'pointerup', 'pointercancel']) {\n      window.removeEventListener(evt, this);\n    }\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'pointerup') {\n      this.dispose();\n\n      event.stopPropagation();\n    } else if (event.type === 'pointermove') {\n      const location = eventLocation(event);\n      if (location) {\n        this.lastPoint = location;\n        event.stopPropagation();\n      }\n    } else if (event.type === 'pointercancel') {\n      this.dispose();\n      event.stopPropagation();\n    }\n  }\n}\n\nfunction distance(\n  p1: [x: number, y: number],\n  p2: [x: number, y: number]\n): number {\n  const dx = p2[0] - p1[0];\n  const dy = p2[1] - p1[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\nexport function eventLocation(evt: Event): [x: number, y: number] | undefined {\n  if (evt instanceof MouseEvent) {\n    return [evt.clientX, evt.clientY];\n  }\n\n  if (evt instanceof TouchEvent) {\n    const result = [...evt.touches].reduce(\n      (acc, x) => [acc[0] + x.clientX, acc[1] + x.clientY],\n      [0, 0]\n    );\n    const l = evt.touches.length;\n    return [result[0] / l, result[1] / l];\n  }\n\n  return undefined;\n}\n\nexport function eventPointerCount(evt: Event): number {\n  if (evt instanceof MouseEvent) {\n    return 1;\n  }\n\n  if (evt instanceof TouchEvent) {\n    return evt.touches.length;\n  }\n\n  return 0;\n}\n\n/**\n * When the potential start of a long press event (`pointerdown`)\n * event is detected, this function will invoke the `fn` callback if the\n * user performs a long press.\n */\nexport function onLongPress(triggerEvent: Event, fn: () => void): void {\n  new LongPressDetector(triggerEvent, fn);\n}\n\nexport function keyboardModifiersFromEvent(ev: Event): KeyboardModifiers {\n  const result = {\n    alt: false,\n    control: false,\n    shift: false,\n    meta: false,\n  };\n  if (\n    ev instanceof MouseEvent ||\n    ev instanceof TouchEvent ||\n    ev instanceof KeyboardEvent\n  ) {\n    if (ev.altKey) result.alt = true;\n    if (ev.ctrlKey) result.control = true;\n    if (ev.metaKey) result.meta = true;\n    if (ev.shiftKey) result.shift = true;\n  }\n\n  return result;\n}\n\nexport function equalKeyboardModifiers(\n  a?: KeyboardModifiers,\n  b?: KeyboardModifiers\n): boolean {\n  if ((!a && b) || (a && !b)) return false;\n  if (!a && !b) return true;\n  return (\n    a!.alt === b!.alt &&\n    a!.control === b!.control &&\n    a!.shift === b!.shift &&\n    a!.meta === b!.meta\n  );\n}\n\nconst PRINTABLE_KEYCODE = new Set([\n  'Backquote', // Japanese keyboard: hankaku/zenkaku/kanji key, which is non-printable\n  'Digit0',\n  'Digit1',\n  'Digit2',\n  'Digit3',\n  'Digit4',\n  'Digit5',\n  'Digit6',\n  'Digit7',\n  'Digit8',\n  'Digit9',\n  'Minus',\n  'Equal',\n  'IntlYen', // Japanese Keyboard. Russian keyboard: \\/\n\n  'KeyQ', // AZERTY keyboard: labeled 'a'\n  'KeyW', // AZERTY keyboard: labeled 'z'\n  'KeyE',\n  'KeyR',\n  'KeyT',\n  'KeyY', // QWERTZ keyboard: labeled 'z'\n  'KeyU',\n  'KeyI',\n  'KeyO',\n  'KeyP',\n  'BracketLeft',\n  'BracketRight',\n  'Backslash', // May be labeled #~ on UK 102 keyboard\n  'KeyA', // AZERTY keyboard: labeled 'q'\n  'KeyS',\n  'KeyD',\n  'KeyF',\n  'KeyG',\n  'KeyH',\n  'KeyJ',\n  'KeyK',\n  'KeyL',\n  'Semicolon',\n  'Quote',\n  'IntlBackslash', // QWERTZ keyboard '><'\n  'KeyZ', // AZERTY: 'w', QWERTZ: 'y'\n  'KeyX',\n  'KeyC',\n  'KeyV',\n  'KeyB',\n  'KeyN',\n  'KeyM',\n  'Comma',\n  'Period',\n  'Slash',\n  'IntlRo', // Japanse keyboard '\\ろ'\n\n  'Space',\n\n  'Numpad0',\n  'Numpad1',\n  'Numpad2',\n  'Numpad3',\n  'Numpad4',\n  'Numpad5',\n  'Numpad6',\n  'Numpad7',\n  'Numpad8',\n  'Numpad9',\n  'NumpadAdd',\n  'NumpadComma',\n  'NumpadDecimal',\n  'NumpadDivide',\n  'NumpadEqual',\n  'NumpadHash',\n  'NumpadMultiply',\n  'NumpadParenLeft',\n  'NumpadParenRight',\n  'NumpadStar',\n  'NumpadSubstract',\n]);\n\nexport function mightProducePrintableCharacter(evt: KeyboardEvent): boolean {\n  if (evt.ctrlKey || evt.metaKey) {\n    // ignore ctrl/cmd-combination but not shift/alt-combinations\n    return false;\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\n  if (evt.key === 'Dead') return false;\n\n  // When issued via a composition, the `code` field is empty\n  if (evt.code === '') return true;\n\n  return PRINTABLE_KEYCODE.has(evt.code);\n}\n","export const MENU_TEMPLATE = document.createElement('template');\nMENU_TEMPLATE.innerHTML = `<ul></ul><slot></slot>`;\nexport const MENU_STYLE = document.createElement('template');\nMENU_STYLE.innerHTML = `<style>\n*,\n::before,\n::after {\n    box-sizing: border-box;\n}\n:host {\n    display: none;\n    color-scheme: light dark;\n    -webkit-user-select: none;  /* Important: Safari iOS doesn't respect user-select */\n    user-select: none;\n    cursor: default;\n    -webkit-touch-callout: none;\n    -webkit-tap-highlight-color: rgba(0 0 0 0);\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    pointer-events: none;\n    opacity:  .5;\n}\n:host(:focus), :host(:focus-within) {\n    outline: Highlight auto 1px;    /* For Firefox */\n    outline: -webkit-focus-ring-color auto 1px;\n}\n:host div.scrim {\n    position: fixed;\n    contain: content;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    outline: none;\n    background: transparent;\n}\n:host slot {\n    display: none;\n}\nul.menu-container {\n    position: absolute;\n    width: auto;\n    height: auto;\n    z-index: 10000;\n    border-radius: 8px;\n    background: var(--menu-bg);\n    box-shadow: 0 0 2px rgba(0, 0, 0, .5), 0 0 20px rgba(0, 0, 0, .2);\n\n    list-style: none;\n    padding: 6px 0 6px 0;\n    margin: 0;\n    user-select: none;\n    cursor: default;\n\n    color: var(--label-color);\n    font-weight: normal;\n    font-style: normal;\n    text-shadow: none;\n    text-transform: none;\n    letter-spacing: 0;\n    outline: none;\n    opacity: 1;\n}\nul.menu-container > li {\n    display: flex;\n    flex-flow: row;\n    align-items: center;\n    padding: 1px 7px 1px 7px;\n    margin-top: 0;\n    margin-left: 6px;\n    margin-right: 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n    position: relative;\n    outline: none;\n    fill: currentColor;\n    user-select: none;\n    cursor: default;\n    text-align: left;\n    color: inherit;\n\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n}\nul.menu-container > li > .label {\n    appearance: none;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\n\nul.menu-container > li > .label.indent {\n    margin-left: 12px;\n}\nul.menu-container > li[role=divider] {\n    border-bottom: 1px solid #c7c7c7;\n    border-radius: 0;\n    padding: 0;\n    margin-left: 15px;\n    margin-right: 15px;\n    padding-top: 5px;\n    margin-bottom: 5px;\n    width: calc(100% - 30px);\n}\nul.menu-container > li[aria-disabled=true] {\n    opacity: .5;\n}\n\nul.menu-container > li.active {\n    background: var(--active-bg);\n    background: -apple-system-control-accent;\n    color: var(--active-label-color);\n}\n\nul.menu-container > li.active.is-submenu-open {\n    background: var(--active-bg-dimmed);\n    color: inherit;\n}\n\nul.menu-container > li[aria-haspopup=true]>.label {\n     padding-right: 0;\n}\n\n.right-chevron {\n    margin-left: 24px;\n    width: 10px;\n    height: 10px;\n    margin-bottom: 4px;\n}\n.checkmark {\n    margin-right: -11px;\n    margin-left: -4px;\n    margin-top : 2px;\n    width: 16px;\n    height: 16px;\n}\n\nul.menu-container > li[aria-haspopup=true].active::after {\n    color: white;\n}\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}\n</style>`;\n","import { getComputedDir } from './ui-element';\n\nexport class Scrim {\n  private _element?: HTMLElement;\n\n  private readonly preventOverlayClose: boolean;\n  private readonly onClose?: () => void;\n\n  private savedOverflow?: string;\n  private savedMarginRight?: string;\n\n  private savedActiveElement?: HTMLOrSVGElement | null;\n\n  private state: 'closed' | 'opening' | 'open' | 'closing';\n\n  private readonly translucent: boolean;\n\n  /**\n   * - If `options.preventOverlayClose` is false, the scrim is closed if the\n   * user clicks on the scrim. That's the behavior for menus, for example.\n   * When you need a fully modal situation until the user has made an\n   * explicit choice (validating cookie usage, for example), set\n   * `preventOverlayClose` to true.\n   * - `onClose()` is called when the scrim is being closed\n   * -\n   */\n  constructor(options?: {\n    translucent?: boolean;\n    preventOverlayClose?: boolean;\n    onClose?: () => void;\n  }) {\n    this.preventOverlayClose = options?.preventOverlayClose ?? false;\n    this.translucent = options?.translucent ?? false;\n\n    this.state = 'closed';\n  }\n\n  get element(): HTMLElement {\n    if (this._element) return this._element;\n\n    const element = document.createElement('div');\n    element.setAttribute('role', 'presentation');\n\n    element.style.position = 'fixed';\n    element.style['contain' as any] = 'content';\n    element.style.top = '0';\n    element.style.left = '0';\n    element.style.right = '0';\n    element.style.bottom = '0';\n    element.style.zIndex = '9999';\n    element.style.outline = 'none';\n    if (this.translucent) {\n      element.style.background = 'rgba(255, 255, 255, .2)';\n      element.style['backdropFilter' as any] = 'contrast(40%)';\n    } else {\n      element.style.background = 'transparent';\n    }\n\n    this._element = element;\n    return element;\n  }\n\n  open(options: { root?: Node | null; child?: HTMLElement }): void {\n    if (this.state !== 'closed') return;\n\n    this.state = 'opening';\n\n    // Remember the previously focused element. We'll restore it when we close.\n    this.savedActiveElement = deepActiveElement();\n\n    const { element } = this;\n    (options?.root ?? document.body).appendChild(element);\n\n    element.addEventListener('click', this);\n    document.addEventListener('touchmove', this, false);\n    document.addEventListener('scroll', this, false);\n\n    // Prevent (some) scrolling\n    // (touch scrolling will still happen)\n    const scrollbarWidth =\n      window.innerWidth - document.documentElement.clientWidth;\n    this.savedMarginRight = document.body.style.marginRight;\n    this.savedOverflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n\n    const marginRight = Number.parseFloat(\n      getComputedStyle(document.body).marginRight\n    );\n\n    document.body.style.marginRight = `${marginRight + scrollbarWidth}px`;\n\n    if (options?.child) {\n      element.append(options.child);\n    }\n\n    this.state = 'open';\n  }\n\n  close(): void {\n    if (this.state !== 'open') return;\n    this.state = 'closing';\n\n    if (typeof this.onClose === 'function') this.onClose();\n\n    const { element } = this;\n    element.removeEventListener('click', this);\n    document.removeEventListener('touchmove', this, false);\n    document.removeEventListener('scroll', this, false);\n\n    element.remove();\n\n    // Restore body state\n    document.body.style.overflow = this.savedOverflow ?? '';\n    document.body.style.marginRight = this.savedMarginRight ?? '';\n\n    // Restore the previously focused element\n    this.savedActiveElement?.focus?.();\n\n    // Remove all children\n    element.innerHTML = '';\n    this.state = 'closed';\n  }\n\n  handleEvent(ev: Event): void {\n    if (!this.preventOverlayClose) {\n      if (ev.target === this._element && ev.type === 'click') {\n        this.close();\n        ev.preventDefault();\n        ev.stopPropagation();\n      } else if (\n        ev.target === document &&\n        (ev.type === 'touchmove' || ev.type === 'scroll')\n      ) {\n        // This is an attempt at scrolling on a touch-device\n        this.close();\n        ev.preventDefault();\n        ev.stopPropagation();\n      }\n    }\n  }\n}\n\nfunction deepActiveElement(): HTMLOrSVGElement | null {\n  let a = document.activeElement;\n  while (a?.shadowRoot?.activeElement) {\n    a = a.shadowRoot.activeElement;\n  }\n\n  return (a as unknown) as HTMLOrSVGElement;\n}\n\n/**\n * Calculate the effective position (width or height) given a starting pos,\n * a placement (left, top, middle, etc...) and dir (ltr/rtl).\n */\nfunction getEffectivePos(\n  pos: number,\n  length: number,\n  placement: 'start' | 'end' | 'middle' | 'left' | 'right' | 'top' | 'bottom',\n  dir: 'ltr' | 'rtl'\n): number {\n  if (placement === 'middle') {\n    return pos - length / 2;\n  }\n\n  if (\n    (placement === 'start' && dir === 'ltr') ||\n    (placement === 'end' && dir === 'rtl') ||\n    placement === 'top' ||\n    placement === 'left'\n  ) {\n    return Math.max(0, pos - length);\n  }\n\n  return pos;\n}\n\nexport function getOppositeEffectivePos(\n  pos: number,\n  length: number,\n  placement: 'start' | 'end' | 'middle' | 'left' | 'right' | 'top' | 'bottom',\n  dir: 'ltr' | 'rtl'\n): number {\n  if (placement === 'middle') {\n    return pos - length / 2;\n  }\n\n  if (\n    (placement === 'start' && dir === 'ltr') ||\n    (placement === 'end' && dir === 'rtl') ||\n    placement === 'top' ||\n    placement === 'left'\n  ) {\n    return pos;\n  }\n\n  return pos - length;\n}\n\n/**\n * Set the position of the element so that it fits in the viewport.\n *\n * The element is first positioned at `location`.\n * If it overflows and there is an alternate location, use the alternate\n * location to fit the topright at the alternate location.\n *\n * If the element still overflows, adjust its location moving it up and to the\n * left as necessary until it fits (and adjusting its width/height as a result)\n */\nexport function fitInViewport(\n  element: HTMLElement,\n  options: {\n    location: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    verticalPos: 'bottom' | 'top' | 'middle' | 'start' | 'end';\n    horizontalPos: 'left' | 'right' | 'middle' | 'start' | 'end';\n    width?: number;\n    height?: number;\n    maxWidth?: number;\n    maxHeight?: number;\n  }\n): void {\n  const dir = getComputedDir(element) ?? 'ltr';\n\n  // Reset any location, so we can get the natural width/height\n  element.style.display = 'block';\n  element.style.position = 'absolute';\n  element.style.left = 'auto';\n  element.style.top = 'auto';\n  element.style.right = 'auto';\n  element.style.bottom = 'auto';\n  element.style.height = 'auto';\n  element.style.width = 'auto';\n\n  const elementBounds = element.getBoundingClientRect();\n\n  //\n  // Vertical positioning\n  //\n  const maxHeight = Number.isFinite(options.maxHeight)\n    ? Math.min(options.maxHeight!, window.innerHeight)\n    : window.innerHeight;\n  let height = Math.min(maxHeight, options.height ?? elementBounds.height);\n\n  let top: number | undefined = getEffectivePos(\n    options.location[1],\n    height,\n    options.verticalPos,\n    dir\n  );\n  if (top + height > window.innerHeight - 8) {\n    if (options.alternateLocation) {\n      top = getEffectivePos(\n        options.alternateLocation[1],\n        height,\n        options.verticalPos,\n        dir\n      );\n      if (top + height > window.innerHeight - 8) {\n        top = undefined;\n      }\n    } else {\n      top = undefined;\n    }\n  }\n\n  if (!Number.isFinite(top)) {\n    // Move element as high as possible\n    top = Math.max(8, window.innerHeight - 8 - height);\n    if (8 + height > window.innerHeight - 8) {\n      // Still doesn't fit, we'll clamp it\n      element.style.bottom = '8px';\n    }\n  }\n\n  height = Math.min(top! + height, window.innerHeight - 8) - top!;\n\n  //\n  // Horizontal positioning\n  //\n  const maxWidth = Number.isFinite(options.maxWidth)\n    ? Math.min(options.maxWidth!, window.innerWidth)\n    : window.innerWidth;\n\n  let width = Math.min(maxWidth, options.width ?? elementBounds.width);\n\n  let left: number | undefined = getEffectivePos(\n    options.location[0],\n    width,\n    options.horizontalPos,\n    dir\n  );\n  if (left + width > window.innerWidth - 8) {\n    if (options.alternateLocation) {\n      left = getOppositeEffectivePos(\n        options.alternateLocation[0],\n        width,\n        options.verticalPos,\n        dir\n      );\n      if (left + width > window.innerWidth - 8) {\n        left = undefined;\n      }\n    } else {\n      left = undefined;\n    }\n  }\n\n  if (!Number.isFinite(left)) {\n    // Move element as high as possible\n    left = Math.max(8, window.innerWidth - 8 - width);\n    if (8 + width > window.innerWidth - 8) {\n      // Still doesn't fit, we'll clamp it\n      element.style.right = '8px';\n    }\n  }\n\n  width = Math.min(left! + width, window.innerWidth - 8) - left!;\n\n  element.style.left = `${Math.round(left!).toString()}px`;\n  element.style.top = `${Math.round(top!).toString()}px`;\n  element.style.height = `${Math.round(height).toString()}px`;\n  element.style.width = `${Math.round(width).toString()}px`;\n}\n","import {\n  keyboardModifiersFromEvent,\n  KeyboardModifiers,\n} from '../common/events';\n\n/**\n * Base class to represent a menu item.\n * There are two subclasses:\n * - MenuItemFromTemplate for menu items created from a JSON template\n * - MenuItemFromElement for menu items created for a UIMenuItem\n */\nexport abstract class MenuItem {\n  parentMenu: MenuInterface;\n  submenu?: MenuInterface;\n\n  constructor(parentMenu: MenuInterface) {\n    this.parentMenu = parentMenu;\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'pointerenter') {\n      const ev = event as PointerEvent;\n      this.parentMenu.rootMenu.cancelDelayedOperation();\n      // If there is a submenu open, and the mouse is moving in the\n      // triangle formed from the current mouse location and the two\n      // adjacent corners of the open menu, schedule setting the new\n      // active menuitem to later\n      if (\n        this.parentMenu.isSubmenuOpen &&\n        this.parentMenu.activeMenuItem?.movingTowardSubmenu(ev)\n      ) {\n        this.parentMenu.rootMenu.scheduleOperation(() => {\n          this.parentMenu.activeMenuItem = this;\n          if (this.submenu) {\n            this.openSubmenu(keyboardModifiersFromEvent(ev));\n          }\n        });\n      } else {\n        this.parentMenu.activeMenuItem = this;\n        if (this.submenu) {\n          this.openSubmenu(keyboardModifiersFromEvent(ev), {\n            withDelay: true,\n          });\n        }\n      }\n    } else if (event.type === 'pointerleave') {\n      if (this.parentMenu.rootMenu.activeMenu === this.parentMenu) {\n        this.parentMenu.activeMenuItem = null;\n      }\n    } else if (event.type === 'pointerup') {\n      // When modal, the items are activated on click,\n      // so ignore mouseup\n      if (this.parentMenu.rootMenu.state !== 'modal') {\n        this.select(keyboardModifiersFromEvent(event));\n      }\n\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  }\n\n  /**\n   * Called when a menu item is selected:\n   * - either dismiss the menu and execute the command\n   * - or display the submenu\n   */\n  select(kbd?: KeyboardModifiers): void {\n    this.parentMenu.rootMenu.cancelDelayedOperation();\n\n    if (this.submenu) {\n      this.openSubmenu(kbd);\n      return;\n    }\n\n    // Make the item blink, then execute the command\n    this.active = false;\n    setTimeout(() => {\n      this.active = true;\n      setTimeout(() => {\n        this.active = false;\n        setTimeout(() => {\n          this.parentMenu.rootMenu.hide();\n          setTimeout(() => {\n            this.dispatchSelect(kbd);\n          }, 120);\n        }, 120);\n      }, 120);\n    }, 120);\n  }\n\n  /**\n   * Open the submenu of this menu item, with a delay if options.delay\n   * This delay improves targeting of submenus with the mouse.\n   */\n  openSubmenu(kbd?: KeyboardModifiers, options?: { withDelay: boolean }): void {\n    if (!this.submenu || !this.element) return;\n    if (options?.withDelay ?? false) {\n      this.parentMenu.rootMenu.scheduleOperation(() => {\n        this.openSubmenu(kbd);\n      });\n      return;\n    }\n\n    const bounds = this.element.getBoundingClientRect();\n    this.submenu.show({\n      location: [bounds.right, bounds.top - 4],\n      alternateLocation: [bounds.left, bounds.top - 4],\n      parent: this.parentMenu.rootMenu.element?.parentNode ?? null,\n      keyboardModifiers: kbd,\n    });\n  }\n\n  movingTowardSubmenu(ev: PointerEvent): boolean {\n    if (!this.element) return false;\n    const lastEv = this.parentMenu.rootMenu.lastMoveEvent;\n    if (!lastEv) return false;\n\n    const deltaT = ev.timeStamp - lastEv.timeStamp;\n    if (deltaT > 500) return false;\n\n    const deltaX = ev.clientX - lastEv.clientX;\n\n    // Moving too slow?\n    const s = speed(deltaX, lastEv.clientY - ev.clientY, deltaT);\n    if (s <= 0.2) return false;\n\n    // Moving horizontally towards the submenu?\n    let position: 'left' | 'right' = 'right';\n    if (this.submenu!.element) {\n      const submenuBounds = this.submenu!.element.getBoundingClientRect();\n\n      const bounds = this.element.getBoundingClientRect();\n      if (submenuBounds.left < bounds.left + bounds.width / 2) {\n        position = 'left';\n      }\n    }\n\n    return position === 'right' ? deltaX > 0 : deltaX < 0;\n  }\n  abstract get type(): 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio';\n\n  abstract get active(): boolean;\n  abstract get hidden(): boolean;\n  abstract get disabled(): boolean;\n  abstract get label(): string;\n  abstract set active(value: boolean);\n\n  // Notify the owner that a menu item has been selected\n  abstract dispatchSelect(kbd?: KeyboardModifiers): void;\n\n  abstract get element(): HTMLElement | null;\n}\n\nfunction speed(dx: number, dy: number, dt: number): number {\n  return Math.sqrt(dx * dx + dy * dy) / dt;\n}\n\nexport interface MenuInterface {\n  parentMenu: MenuInterface | null;\n  readonly rootMenu: RootMenuInterface;\n  // Readonly menuHost: Element;\n\n  readonly element: HTMLElement | null;\n  readonly isSubmenuOpen: boolean;\n\n  activeMenuItem: MenuItem | null;\n  readonly firstMenuItem: MenuItem | null;\n  readonly lastMenuItem: MenuItem | null;\n\n  openSubmenu: MenuInterface | null;\n  readonly hasRadio: boolean;\n  readonly hasCheckbox: boolean;\n\n  hide(): void;\n  show(options: {\n    parent: Node | null;\n    location?: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): void;\n  nextMenuItem(dir: number): MenuItem | null;\n  findMenuItem(text: string): MenuItem | null;\n  dispatchEvent(ev: Event): boolean;\n}\n\nexport interface RootMenuInterface extends MenuInterface {\n  lastMoveEvent?: PointerEvent;\n  activeMenu: MenuInterface;\n  state: 'closed' | 'open' | 'modal';\n  readonly scrim: Element;\n\n  cancelDelayedOperation(): void;\n  scheduleOperation(op: () => void): void;\n}\n","import { UIElement } from '../common/ui-element';\nimport { MenuItem } from './menu-base';\n\nconst MENU_ITEM_STYLE = document.createElement('template');\nMENU_ITEM_STYLE.innerHTML = `<style>\n:host {\n    display: inline;\n    color-scheme: light dark;\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n    outline: none;\n    fill: currentColor;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    text-align: left;\n    color: var(--label-color);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    opacity:  .5;\n}\n\n:host([active]) {\n    color: var(--active-label-color);\n}\n\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}</style>`;\nconst MENU_ITEM_TEMPLATE = document.createElement('template');\nMENU_ITEM_TEMPLATE.innerHTML = '<slot></slot>';\n\n/**\n * Each `UIMenuItemElement` is wrapped inside a `<li>` tag.\n * A `UIMenuItemElement` represents the label part of a menu item.\n * Other elements such as the checkmark and the submenu indicator\n * are rendered by the menu container.\n */\nexport class UIMenuItem extends UIElement {\n  // The _menuItem is the 'model' corresponding to this element.\n  private _menuItem?: MenuItem;\n\n  get menuItem(): MenuItem | undefined {\n    return this._menuItem;\n  }\n\n  set menuItem(value: MenuItem | undefined) {\n    this._menuItem = value;\n  }\n\n  constructor() {\n    super({ template: MENU_ITEM_TEMPLATE, style: MENU_ITEM_STYLE });\n    this.reflectBooleanAttributes(['active', 'divider', 'disabled', 'checked']);\n  }\n}\n\nexport default UIMenuItem;\n\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UIMenuItem: typeof UIMenuItem;\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-menu-item',\n  className: 'UIMenuItem',\n  constructor: UIMenuItem,\n});\n","import {\n  KeyboardModifiers,\n  keyboardModifiersFromEvent,\n} from '../common/events';\nimport { fitInViewport } from '../common/scrim';\nimport { addPart, removePart, UIElement } from '../common/ui-element';\nimport { MenuInterface, MenuItem, RootMenuInterface } from './menu-base';\nimport { UIMenuItem } from './menu-item-element';\nimport { UISubmenu } from './submenu-element';\n\nexport type MenuItemTemplate = {\n  onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n  type?: 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio';\n  className?: string;\n  label?:\n    | string\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string);\n  ariaLabel?:\n    | string\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string);\n  ariaDetails?:\n    | string\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string);\n  submenu?: MenuItemTemplate[];\n\n  hidden?:\n    | boolean\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean);\n  disabled?:\n    | boolean\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean);\n  checked?:\n    | boolean\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean);\n\n  /** Caller defined id string. Passed to the `onSelect()` hook. */\n  id?: string;\n\n  /** Caller defined data block. Passed to the `onSelect()` hook. */\n  data?: any;\n};\n\n/**\n * An instance of `Menu` is a model of a collection of menu items, including\n * submenus.\n *\n *\n */\nexport class Menu implements MenuInterface {\n  parentMenu: MenuInterface | null;\n  isSubmenuOpen: boolean; // If true, _activeMenuItem.submenu_ is open\n\n  /**\n   * The Element from which menu items will be used as template (optional)\n   */\n  menuHost?: Element;\n\n  hasCheckbox = false; // If true, has at least one checkbox menu item\n  hasRadio = false; // If true, has at least one radio menu item\n\n  protected _element: HTMLElement | null = null;\n  protected _menuItems: MenuItem[] = [];\n  private _activeMenuItem: MenuItem | null = null;\n\n  /*\n   * The menu items template are preserved so that the actual menu items\n   * can be recalculated, for example if the keyboard modifiers change.\n   * (when isDynamic is true)\n   */\n  private _menuItemsTemplate: MenuItemTemplate[] | undefined;\n\n  /**\n   * Optional, an HTML element to be used as the container for this menu.\n   * Used when this maps to a custom element with a <ul> in its template.\n   */\n  protected _assignedContainer?: HTMLElement | null;\n\n  /**\n   * - host: if the menu is inside an element, the host is this element.\n   * This is where a set of <ui-menu-item> elements will be read from.\n   * - assignedContainer: the element into which the menu items will be\n   * inserted. A <ul>. Could be in a custom element. If none is provided,\n   * a new <ul> is created.\n   * - wrapper: an element that wraps the container. This elements\n   * gets attached to the scrim for display. If none is provided,\n   * the container is used directly. Pass the custom element when\n   * a custom element wrapper is used (e.g. for <ui-submenu>)\n   */\n  constructor(\n    menuItems?: MenuItemTemplate[],\n    options?: {\n      parentMenu?: MenuInterface;\n      host?: Element;\n      assignedContainer?: HTMLElement | null;\n    }\n  ) {\n    this.parentMenu = options?.parentMenu ?? null;\n    this._assignedContainer = options?.assignedContainer;\n\n    this._menuItemsTemplate = menuItems;\n    this.isSubmenuOpen = false;\n\n    this.menuHost = options?.host;\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'wheel' && this._element) {\n      const ev = event as WheelEvent;\n      // Scroll wheel: adjust scroll position\n      this._element.scrollBy(0, ev.deltaY);\n\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  get rootMenu(): RootMenuInterface {\n    return this.parentMenu!.rootMenu;\n  }\n\n  dispatchEvent(ev: Event): boolean {\n    return this.rootMenu.dispatchEvent(ev);\n  }\n\n  /**\n   * Update the 'model' of this menu (i.e. list of menu items) based\n   * on:\n   * - the state of the keyboard, for programmatically specified items\n   * - the content of the JSON and elements inside the host element\n   * (if there is one)\n   */\n  updateMenu(keyboardModifiers?: KeyboardModifiers): void {\n    // Save the current menu\n    const element = this._element;\n    let saveCurrentItem = -1;\n    let left = 0;\n    let top = 0;\n    let parent: Node | undefined | null;\n    if (element) {\n      // If there is a cached element for this menu,\n      // remove it (but save its state)\n      saveCurrentItem = this.activeMenuItem\n        ? this._menuItems!.indexOf(this.activeMenuItem)\n        : -1;\n      parent = element.parentNode;\n      left = Number.parseInt(element.style.left);\n      top = Number.parseInt(element.style.top);\n      parent?.removeChild(element);\n      this._element = null;\n    }\n\n    this._menuItems = [];\n    this.hasCheckbox = false;\n    this.hasRadio = false;\n    if (this._menuItemsTemplate) {\n      for (const x of this._menuItemsTemplate) {\n        this.appendMenuItem(x, keyboardModifiers);\n      }\n    }\n\n    // Add menu-item-elements\n    if (this.menuHost?.shadowRoot) {\n      const slot = this.menuHost.shadowRoot.querySelector<HTMLSlotElement>(\n        'slot'\n      );\n      if (slot) {\n        const itemElements = slot\n          .assignedElements()\n          .filter<UIMenuItem>(\n            (x): x is UIMenuItem => x.tagName === 'UI-MENU-ITEM'\n          );\n        for (const el of itemElements) {\n          this.appendMenuItem(el, keyboardModifiers);\n        }\n      }\n    }\n\n    this.hasCheckbox = this._menuItems.some((x) => x.type === 'checkbox');\n    this.hasRadio = this._menuItems.some((x) => x.type === 'radio');\n\n    if (element) {\n      // If there was a previous version of the menu,\n      // restore it and its state\n      parent?.appendChild(this.element);\n\n      fitInViewport(this.element, {\n        location: [left, top],\n        verticalPos: 'bottom',\n        horizontalPos: 'right',\n      });\n\n      this.activeMenuItem =\n        saveCurrentItem >= 0 ? this.menuItems[saveCurrentItem] : null;\n      if (this.activeMenuItem?.submenu) {\n        this.activeMenuItem.openSubmenu(keyboardModifiers);\n      }\n    }\n  }\n\n  get menuItems(): MenuItem[] {\n    return this._menuItems;\n  }\n\n  set menuItemTemplates(value: MenuItemTemplate[]) {\n    this._menuItemsTemplate = value;\n    if (this._element) {\n      if (this.menuItems.filter((x) => !x.hidden).length === 0) {\n        this.hide();\n        return;\n      }\n\n      this.updateMenu();\n    }\n  }\n\n  /** First activable menu item */\n  get firstMenuItem(): MenuItem | null {\n    let result = 0;\n    let found = false;\n    const { menuItems } = this;\n    while (!found && result <= menuItems.length - 1) {\n      const item = menuItems[result];\n      found = item.type !== 'divider' && !item.hidden && !item.disabled;\n      result += 1;\n    }\n\n    return found ? menuItems[result - 1] : null;\n  }\n\n  /** Last activable menu item */\n  get lastMenuItem(): MenuItem | null {\n    let result = this.menuItems.length - 1;\n    let found = false;\n    while (!found && result >= 0) {\n      const item = this.menuItems[result];\n      found = item.type !== 'divider' && !item.hidden && !item.disabled;\n      result -= 1;\n    }\n\n    return found ? this.menuItems[result + 1] : null;\n  }\n\n  /**\n   * The active menu is displayed on a colored background.\n   */\n  get activeMenuItem(): MenuItem | null {\n    return this._activeMenuItem;\n  }\n\n  /**\n   * Set to undefined to have no active item.\n   * Note that setting the active menu item doesn't automatically\n   * open the submenu (e.g. when keyboard navigating).\n   * Call `item.submenu.openSubmenu()` to open the submenu.\n   */\n  set activeMenuItem(value: MenuItem | null) {\n    this.parentMenu?.rootMenu.cancelDelayedOperation();\n    if (value !== this._activeMenuItem) {\n      // Remove previously active element\n      if (this.activeMenuItem) {\n        const item = this.activeMenuItem;\n        item.active = false;\n        // If there is a submenu, hide it\n        item.submenu?.hide();\n      }\n\n      if (value?.hidden) {\n        this._activeMenuItem = null;\n        return;\n      }\n\n      this._activeMenuItem = value;\n\n      // Make new element active\n      if (value) value.active = true;\n    }\n\n    if (value) {\n      value.element?.focus();\n    } else {\n      this._element?.focus();\n    }\n\n    // Update secondary state of parent\n    this.parentMenu?.activeMenuItem?.element?.classList.toggle(\n      'is-submenu-open',\n      Boolean(value)\n    );\n  }\n\n  nextMenuItem(dir: number): MenuItem | null {\n    if (!this._activeMenuItem && dir > 0) return this.firstMenuItem;\n    if (!this._activeMenuItem && dir < 0) return this.lastMenuItem;\n    if (!this.firstMenuItem || !this.lastMenuItem || !this._activeMenuItem) {\n      return null;\n    }\n    const first = this._menuItems.indexOf(this.firstMenuItem);\n    const last = this._menuItems.indexOf(this.lastMenuItem);\n    let found = false;\n    let result = this._menuItems.indexOf(this._activeMenuItem) + dir;\n    while (!found && result >= first && result <= last) {\n      const item = this._menuItems[result];\n      found = item.type !== 'divider' && !item.hidden && !item.disabled;\n      result += dir;\n    }\n\n    return found\n      ? this._menuItems[result - dir]\n      : dir > 0\n      ? this.lastMenuItem\n      : this.firstMenuItem;\n  }\n\n  static _collator: Intl.Collator;\n\n  static get collator(): Intl.Collator {\n    if (Menu._collator) return Menu._collator;\n    Menu._collator = new Intl.Collator(undefined, {\n      usage: 'search',\n      sensitivity: 'base',\n    });\n    return Menu._collator;\n  }\n\n  findMenuItem(text: string): MenuItem | null {\n    const candidates = this._menuItems.filter(\n      (x) => x.type !== 'divider' && !x.hidden && !x.disabled\n    );\n    if (candidates.length === 0) return null;\n    const last =\n      Math.max(...candidates.map((x) => x.label.length)) - text.length;\n\n    if (last < 0) return null;\n\n    // Find a \"contain\" match\n    let result: MenuItem | null = null;\n    let i = 0;\n    while (i < last && !result) {\n      result =\n        candidates.find(\n          (x) =>\n            Menu.collator.compare(text, x.label.substr(i, text.length)) === 0\n        ) ?? null;\n      i++;\n    }\n\n    return result;\n  }\n\n  makeElement(container?: HTMLElement | null): HTMLElement {\n    const ul = container ?? document.createElement('ul');\n    ul.classList.add('menu-container');\n    ul.setAttribute('part', 'menu-container');\n    ul.setAttribute('tabindex', '-1');\n    ul.setAttribute('role', 'menu');\n    ul.setAttribute('aria-orientation', 'vertical');\n    ul.addEventListener('wheel', this);\n\n    // Remove all items\n    ul.textContent = '';\n\n    // Add back all necessary items (after they've been updated if applicable)\n    for (const { element } of this._menuItems) {\n      if (element) ul.append(element);\n    }\n    ul.querySelector('li:first-of-type')?.setAttribute('tabindex', '0');\n\n    return ul;\n  }\n\n  /**\n   * Construct (or return a cached version) of an element representing\n   * the items in this menu (model -> view)\n   */\n  get element(): HTMLElement {\n    if (!this._element) {\n      this._element = this.makeElement(this._assignedContainer);\n    }\n\n    return this._element;\n  }\n\n  /**\n   * @param parent: where the menu should be attached\n   * @return false if no menu to show\n   */\n  show(options: {\n    parent: Node;\n    location?: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): boolean {\n    this.updateMenu(options?.keyboardModifiers);\n    if (this.menuItems.filter((x) => !x.hidden).length === 0) return false;\n\n    options.parent.appendChild(this.element);\n\n    if (options.location) {\n      fitInViewport(this.element, {\n        location: options.location,\n        alternateLocation: options.alternateLocation,\n        verticalPos: 'bottom',\n        horizontalPos: 'right',\n      });\n    }\n\n    this.element.focus();\n\n    // Notify our parent we have opened\n    // (so the parent can close any other open submenu and/or\n    // change its state to display the active state correctly)\n    if (this.parentMenu) {\n      this.parentMenu.openSubmenu = this;\n    }\n\n    return true;\n  }\n\n  hide(): void {\n    // Hide any of our child submenus\n    this.openSubmenu = null;\n\n    this.activeMenuItem = null;\n\n    // Notify our parent\n    if (this.parentMenu) {\n      this.parentMenu.openSubmenu = null;\n    }\n\n    this._element?.parentNode?.removeChild(this._element);\n    this._element = null;\n  }\n\n  /**\n   * This method is called to record that one of our submenus has opened.\n   * To open a submenu call openSubmenu() on the item with the submenu\n   * or show() on the submenu.\n   */\n  set openSubmenu(submenu: MenuInterface | null) {\n    const expanded = submenu !== null;\n    // We're closing a submenu\n    if (this.activeMenuItem?.submenu) {\n      this.activeMenuItem.element?.setAttribute(\n        'aria-expanded',\n        expanded.toString()\n      );\n    }\n\n    this.isSubmenuOpen = expanded;\n  }\n\n  appendMenuItem(\n    menuItem: MenuItemTemplate | UIMenuItem,\n    keyboardModifiers?: KeyboardModifiers\n  ): void {\n    this.insertMenuItem(-1, menuItem, keyboardModifiers);\n  }\n\n  insertMenuItem(\n    pos: number,\n    menuItem: MenuItemTemplate | UIMenuItem,\n    keyboardModifiers?: KeyboardModifiers\n  ): void {\n    if (pos < 0) pos = Math.max(0, this._menuItems.length - 1);\n\n    const item =\n      menuItem instanceof UIMenuItem\n        ? new MenuItemFromElement(menuItem, this)\n        : new MenuItemFromTemplate(menuItem, this, {\n            keyboardModifiers,\n          });\n\n    this._menuItems.splice(pos + 1, 0, item);\n  }\n}\n\nexport function evalToBoolean(\n  item: MenuItemTemplate,\n  value:\n    | boolean\n    | undefined\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => boolean),\n  keyboardModifiers?: KeyboardModifiers\n): boolean | undefined {\n  if (typeof value === 'boolean') return value;\n  if (typeof value === 'function') {\n    return value(item, keyboardModifiers);\n  }\n\n  return undefined;\n}\n\nexport function evalToString(\n  item: MenuItemTemplate,\n  value:\n    | string\n    | undefined\n    | ((\n        item: MenuItemTemplate,\n        keyboardModifiers?: KeyboardModifiers\n      ) => string),\n  options?: {\n    keyboardModifiers?: KeyboardModifiers;\n  }\n): string | undefined {\n  if (typeof value === 'string') {\n    return value;\n  }\n\n  if (typeof value === 'function') {\n    return value(item, options?.keyboardModifiers);\n  }\n\n  return undefined;\n}\n\nconst CHEVRON_RIGHT_TEMPLATE = document.createElement('template');\nCHEVRON_RIGHT_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"right-chevron\"><svg focusable=\"false\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><path fill=\"currentColor\" d=\"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z\"></path></svg></span>`;\n\nconst CHECKMARK_TEMPLATE = document.createElement('template');\nCHECKMARK_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"checkmark\"><svg  xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M435.848 83.466L172.804 346.51l-96.652-96.652c-4.686-4.686-12.284-4.686-16.971 0l-28.284 28.284c-4.686 4.686-4.686 12.284 0 16.971l133.421 133.421c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-28.284-28.284c-4.686-4.686-12.284-4.686-16.97 0z\"></path></svg>\n</span>`;\n\nexport type MenuSelectEvent = {\n  keyboardModifiers?: KeyboardModifiers;\n  id?: string;\n  label?: string;\n  data?: any;\n  element?: HTMLElement;\n};\n\ndeclare global {\n  /**\n   * Map the custom event names to types\n   * @internal\n   */\n  export interface DocumentEventMap {\n    ['select']: CustomEvent<MenuSelectEvent>;\n  }\n}\n\nexport class MenuItemFromTemplate extends MenuItem {\n  _type: 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio';\n  _label?: string;\n  _disabled: boolean;\n  _hidden: boolean;\n\n  ariaLabel?: string;\n  ariaDetails?: string;\n  checked?: boolean;\n  onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n  submenu?: MenuInterface;\n  id?: string;\n  data?: any;\n\n  _element: HTMLElement | null = null;\n\n  constructor(\n    template: MenuItemTemplate,\n    parentMenu: MenuInterface,\n    options?: {\n      keyboardModifiers?: KeyboardModifiers;\n    }\n  ) {\n    super(parentMenu);\n    this.parentMenu = parentMenu;\n\n    this._hidden =\n      evalToBoolean(template, template.hidden, options?.keyboardModifiers) ??\n      false;\n    this._disabled =\n      evalToBoolean(template, template.disabled, options?.keyboardModifiers) ??\n      false;\n    this.checked =\n      evalToBoolean(template, template.checked, options?.keyboardModifiers) ??\n      false;\n\n    this.id = template.id;\n    this._label = evalToString(template, template.label, options);\n    this.ariaLabel = evalToString(template, template.ariaLabel, options);\n    this.ariaDetails = evalToString(template, template.ariaDetails, options);\n    if (typeof template.onSelect) {\n      this.onSelect = template.onSelect;\n    }\n\n    this.data = template.data;\n\n    if (Array.isArray(template.submenu)) {\n      this._type = 'submenu';\n      this.submenu = new Menu(template.submenu, {\n        parentMenu,\n      });\n    } else if (template.type === undefined && template.checked !== undefined) {\n      this._type = 'checkbox';\n    } else {\n      this._type = template.type ?? 'normal';\n    }\n  }\n\n  get type(): 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio' {\n    return this._type;\n  }\n\n  get label(): string {\n    return this._label ?? this.ariaLabel ?? '';\n  }\n\n  get hidden(): boolean {\n    return this._hidden;\n  }\n\n  get disabled(): boolean {\n    return this._disabled;\n  }\n\n  private render(): HTMLElement | null {\n    if (this.hidden) return null;\n\n    if (this.type === 'divider') {\n      const li = document.createElement('li');\n      li.setAttribute('part', 'menu-divider');\n      li.setAttribute('role', 'divider');\n      return li;\n    }\n\n    if (\n      this.type !== 'normal' &&\n      this.type !== 'submenu' &&\n      this.type !== 'radio' &&\n      this.type !== 'checkbox'\n    ) {\n      return null;\n    }\n\n    const li = document.createElement('li');\n    li.setAttribute('part', 'menu-item');\n    li.setAttribute('tabindex', '-1');\n    if (this.type === 'radio') {\n      li.setAttribute('role', 'menuitemradio');\n    } else if (this.type === 'checkbox') {\n      li.setAttribute('role', 'menuitemcheckbox');\n    } else {\n      li.setAttribute('role', 'menuitem');\n    }\n\n    if (this.checked) {\n      li.setAttribute('aria-checked', 'true');\n      li.append(CHECKMARK_TEMPLATE.content.cloneNode(true));\n    }\n\n    if (this.submenu) {\n      li.setAttribute('aria-haspopup', 'true');\n      li.setAttribute('aria-expanded', 'false');\n    }\n\n    if (this.ariaLabel) li.setAttribute('aria-label', this.ariaLabel);\n    if (this.ariaDetails) li.setAttribute('aria-label', this.ariaDetails);\n\n    if (this.disabled) {\n      li.setAttribute('aria-disabled', 'true');\n    } else {\n      li.removeAttribute('aria-disabled');\n      li.addEventListener('pointerenter', this);\n      li.addEventListener('pointerleave', this);\n      li.addEventListener('pointerup', this);\n    }\n\n    const span = document.createElement('span');\n    span.innerHTML = this.label;\n    span.className =\n      this.parentMenu.hasCheckbox || this.parentMenu.hasRadio\n        ? 'label indent'\n        : 'label';\n    if (!this.disabled) {\n      span.addEventListener('click', (ev: MouseEvent) => {\n        this.select(keyboardModifiersFromEvent(ev));\n      });\n    }\n\n    li.append(span);\n    if (this.submenu) {\n      li.append(CHEVRON_RIGHT_TEMPLATE.content.cloneNode(true));\n    }\n\n    return li;\n  }\n\n  get active(): boolean {\n    return this.element?.classList.contains('active') ?? false;\n  }\n\n  set active(value: boolean) {\n    if (!this.element) return;\n    if (value) {\n      this.element.classList.add('active');\n    } else {\n      this.element.classList.remove('active');\n    }\n  }\n\n  get element(): HTMLElement | null {\n    if (this._element) return this._element;\n    this._element = this.render();\n    return this._element;\n  }\n\n  dispatchSelect(kbd?: KeyboardModifiers): void {\n    const ev = new CustomEvent<MenuSelectEvent>('select', {\n      detail: {\n        keyboardModifiers: kbd,\n        id: this.id,\n        label: this.label,\n        data: this.data,\n      },\n    });\n    if (typeof this.onSelect === 'function') {\n      this.onSelect(ev);\n    } else {\n      this.parentMenu.dispatchEvent(ev);\n    }\n  }\n}\n\nexport class MenuItemFromElement extends MenuItem {\n  // The <ui-menu-item> in the <slot> serves as the 'template' for this\n  // menu item\n  _sourceElement: UIElement;\n  // The source element is cloned and inserted in a <li>\n  _sourceElementClone?: UIElement;\n  // The <li> is cached\n  _cachedElement: HTMLElement | null = null;\n\n  constructor(element: UIMenuItem, parentMenu: MenuInterface) {\n    super(parentMenu);\n    this.parentMenu = parentMenu;\n    this._sourceElement = element;\n    element.menuItem = this;\n\n    // Read a <ui-submenu> element if there is one\n    if (element.shadowRoot) {\n      const submenuElements = element.shadowRoot\n        .querySelector<HTMLSlotElement>('slot')\n        ?.assignedElements()\n        .filter<UISubmenu>((x): x is UISubmenu => x.tagName === 'UI-SUBMENU');\n      console.assert(\n        submenuElements && submenuElements.length <= 1,\n        'Expected no more than one submenu'\n      );\n      if (submenuElements && submenuElements.length > 0) {\n        this.submenu = new Submenu({\n          host: submenuElements[0],\n          parentMenu,\n        });\n      }\n    }\n  }\n\n  get type(): 'normal' | 'divider' | 'submenu' | 'checkbox' | 'radio' {\n    if (this.divider) return 'divider';\n    if (this.submenu) return 'submenu';\n    // @todo:  radio, checkbox\n    return 'normal';\n  }\n\n  get label(): string {\n    return this._sourceElement.innerHTML;\n  }\n\n  get hidden(): boolean {\n    return this._sourceElement.hasAttribute('hidden');\n  }\n\n  set hidden(value: boolean) {\n    if (value) {\n      this._sourceElementClone?.setAttribute('hidden', '');\n    } else {\n      this._sourceElementClone?.removeAttribute('hidden');\n    }\n  }\n\n  get disabled(): boolean {\n    return this._sourceElement.hasAttribute('disabled');\n  }\n\n  set disabled(value: boolean) {\n    if (!this._cachedElement) return;\n    if (value) {\n      this._sourceElementClone?.setAttribute('disabled', '');\n      addPart(this._cachedElement, 'disabled');\n    } else {\n      this._sourceElementClone?.removeAttribute('disabled');\n      removePart(this._cachedElement, 'disabled');\n    }\n  }\n\n  get checked(): boolean {\n    return this._sourceElement.hasAttribute('checked');\n  }\n\n  set checked(value: boolean) {\n    if (!this._cachedElement) return;\n    if (value) {\n      this._sourceElementClone?.setAttribute('checked', '');\n      addPart(this._cachedElement, 'checked');\n    } else {\n      this._sourceElementClone?.removeAttribute('checked');\n      removePart(this._cachedElement, 'checked');\n    }\n  }\n\n  get divider(): boolean {\n    return this._sourceElement.hasAttribute('divider');\n  }\n\n  set divider(value: boolean) {\n    if (value) {\n      this._sourceElementClone?.setAttribute('divider', '');\n    } else {\n      this._sourceElementClone?.removeAttribute('divider');\n    }\n  }\n\n  get active(): boolean {\n    return this._cachedElement?.classList.contains('active') ?? false;\n  }\n\n  set active(value: boolean) {\n    if (!this._cachedElement) return;\n    // For the active attribute, set the value on the sourced element\n    // (the <ui-menu-item>)\n    if (value) {\n      this._cachedElement?.classList.add('active');\n      addPart(this._cachedElement, 'active');\n      this._sourceElementClone?.setAttribute('active', '');\n    } else {\n      this._cachedElement?.classList.remove('active');\n      removePart(this._cachedElement, 'active');\n      this._sourceElementClone?.removeAttribute('active');\n    }\n  }\n\n  private render(): HTMLElement | null {\n    if (this.hidden) return null;\n\n    if (this.divider) {\n      const li = document.createElement('li');\n      li.setAttribute('part', 'menu-divider');\n      li.setAttribute('role', 'divider');\n      return li;\n    }\n\n    const li = document.createElement('li');\n    li.setAttribute('part', 'menu-item');\n    li.setAttribute('tabindex', '-1');\n    if (this.type === 'radio') {\n      li.setAttribute('role', 'menuitemradio');\n    } else if (this.type === 'checkbox') {\n      li.setAttribute('role', 'menuitemcheckbox');\n    } else {\n      li.setAttribute('role', 'menuitem');\n    }\n\n    if (this.checked) {\n      li.setAttribute('aria-checked', 'true');\n      li.append(CHECKMARK_TEMPLATE.content.cloneNode(true));\n    }\n\n    if (this.submenu) {\n      li.setAttribute('aria-haspopup', 'true');\n      li.setAttribute('aria-expanded', 'false');\n    }\n\n    if (this.disabled) {\n      li.setAttribute('aria-disabled', 'true');\n    } else {\n      li.removeAttribute('aria-disabled');\n      li.addEventListener('pointerenter', this);\n      li.addEventListener('pointerleave', this);\n      li.addEventListener('pointerup', this);\n    }\n\n    if (!this.disabled) {\n      li.addEventListener('click', (ev: MouseEvent) => {\n        this.select(keyboardModifiersFromEvent(ev));\n      });\n    }\n\n    this._sourceElementClone = this._sourceElement.cloneNode(true) as UIElement;\n    li.append(this._sourceElementClone);\n    if (this.submenu) {\n      li.append(CHEVRON_RIGHT_TEMPLATE.content.cloneNode(true));\n    }\n\n    return li;\n  }\n\n  get element(): HTMLElement | null {\n    if (this._cachedElement) return this._cachedElement;\n    this._cachedElement = this.render();\n    return this._cachedElement;\n  }\n\n  dispatchSelect(kbd?: KeyboardModifiers): void {\n    const ev = new CustomEvent<MenuSelectEvent>('select', {\n      detail: {\n        keyboardModifiers: kbd,\n        id: this._sourceElement.getAttribute('id') ?? '',\n        label: this.label,\n        element: this._sourceElement,\n      },\n    });\n    if (typeof this._sourceElement.onselect === 'function') {\n      this._sourceElement.onselect(ev);\n    } else {\n      this.parentMenu.dispatchEvent(ev);\n    }\n  }\n}\n\nexport class Submenu extends Menu {\n  source: UISubmenu;\n  constructor(options: { host: UISubmenu; parentMenu: MenuInterface }) {\n    super([], {\n      parentMenu: options.parentMenu,\n      host: options.host,\n    });\n    this.source = options.host;\n  }\n\n  get element(): HTMLElement {\n    if (this._element) return this._element;\n\n    const clone = this.source.cloneNode(true) as UISubmenu;\n    // Clone.style.display = 'block';\n    clone.importStyle();\n    this.makeElement(clone.shadowRoot?.querySelector('ul'));\n    this._element = clone;\n    return clone;\n  }\n\n  show(options?: {\n    location?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): boolean {\n    if (!this.parentMenu?.rootMenu) return false;\n    return super.show({\n      ...options,\n      parent: this.parentMenu.rootMenu.scrim,\n    });\n  }\n\n  /**\n   */\n  hide(): void {\n    super.hide();\n  }\n}\n","import {\n  equalKeyboardModifiers,\n  KeyboardModifiers,\n  keyboardModifiersFromEvent,\n  mightProducePrintableCharacter,\n} from '../common/events';\nimport { Scrim } from '../common/scrim';\nimport { Menu, MenuItemTemplate } from './menu-core';\nimport { MenuInterface, RootMenuInterface } from './menu-base';\n\nexport class RootMenu extends Menu implements RootMenuInterface {\n  lastMoveEvent?: PointerEvent;\n\n  private typingBufferResetTimer = 0;\n  private typingBuffer: string;\n  private readonly _scrim: Scrim;\n  private _openTimestamp?: number;\n  private currentKeyboardModifiers?: KeyboardModifiers;\n  private hysteresisTimer = 0;\n  /**\n   * - 'closed': the menu is not visible\n   * - 'open': the menu is visible as long as the mouse button is pressed\n   * - 'modal': the menu is visible until dismissed, even with the mouse button\n   * released\n   */\n  state: 'closed' | 'open' | 'modal';\n\n  /** If true, the state of some of the menu items in this menu are\n   * provide by a function and may need to be updated dynamically\n   */\n  isDynamic: boolean;\n\n  /**\n   * If an `options.assignedElement` is provided, the root menu is\n   * attached to that element (the element will be modified\n   * to display the menu). Use this when using a popup menu.\n   * In this mode, call `show()` and `hide()` to control the\n   * display of the menu.\n   *\n   */\n  constructor(\n    menuItems: MenuItemTemplate[],\n    options?: {\n      host?: Element;\n      assignedElement?: HTMLElement | null;\n      keyboardModifiers?: KeyboardModifiers;\n    }\n  ) {\n    super(menuItems, {\n      host: options?.host,\n      assignedContainer: options?.assignedElement ?? null,\n    });\n    this.isDynamic = menuItems.some(isDynamic);\n    this.currentKeyboardModifiers = options?.keyboardModifiers;\n    this.typingBuffer = '';\n    this.state = 'closed';\n\n    this._scrim = new Scrim({\n      onClose: () => {\n        this.hide();\n      },\n    });\n  }\n\n  /**\n   * The currently active menu: could be the root menu or a submenu\n   */\n  get activeMenu(): MenuInterface {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let result: MenuInterface = this;\n    while (result.isSubmenuOpen) {\n      result = result.activeMenuItem!.submenu!;\n    }\n\n    return result;\n  }\n\n  handleKeyupEvent(ev: KeyboardEvent): void {\n    if (this.isDynamic) {\n      const newModifiers = keyboardModifiersFromEvent(ev);\n      if (\n        !equalKeyboardModifiers(this.currentKeyboardModifiers, newModifiers)\n      ) {\n        this.updateMenu(newModifiers);\n        this.currentKeyboardModifiers = newModifiers;\n      }\n    }\n  }\n\n  handleKeydownEvent(ev: KeyboardEvent): void {\n    if (ev.key === 'Tab') {\n      // Close and bubble\n      this.rootMenu.hide();\n      return;\n    }\n\n    if (this.isDynamic) {\n      const newModifiers = keyboardModifiersFromEvent(ev);\n      if (\n        !equalKeyboardModifiers(this.currentKeyboardModifiers, newModifiers)\n      ) {\n        this.updateMenu(newModifiers);\n        this.currentKeyboardModifiers = newModifiers;\n      }\n    }\n\n    let handled = true;\n    const menu = this.activeMenu;\n    const menuItem = menu.activeMenuItem;\n    switch (ev.key) {\n      case ' ':\n      case 'Space':\n      case 'Return':\n      case 'Enter':\n        menuItem?.select(keyboardModifiersFromEvent(ev));\n        break;\n      case 'ArrowRight':\n        if (menuItem?.submenu) {\n          menuItem.select(keyboardModifiersFromEvent(ev));\n          this.activeMenu.activeMenuItem = this.activeMenu.firstMenuItem;\n        } else if (!menuItem) {\n          menu.activeMenuItem = menu.firstMenuItem;\n        }\n\n        break;\n      case 'ArrowLeft':\n        if (menu === this.rootMenu) {\n          if (!menuItem) {\n            menu.activeMenuItem = menu.firstMenuItem;\n          }\n        } else {\n          menu.hide();\n          const activeMenu = menu.parentMenu!.activeMenuItem;\n          if (activeMenu) {\n            const { element } = activeMenu;\n            element?.focus();\n            element?.classList.remove('is-submenu-open');\n          }\n        }\n\n        break;\n      case 'ArrowDown':\n        menu.activeMenuItem = menu.nextMenuItem(+1);\n        break;\n      case 'ArrowUp':\n        menu.activeMenuItem = menu.nextMenuItem(-1);\n        break;\n      case 'Home':\n      case 'PageUp':\n        menu.activeMenuItem = menu.firstMenuItem;\n        break;\n      case 'End':\n      case 'PageDown':\n        menu.activeMenuItem = menu.lastMenuItem;\n        break;\n      case 'Escape':\n        this.rootMenu.hide();\n        break;\n      case 'Backspace':\n        if (this.typingBuffer) {\n          this.typingBuffer = this.typingBuffer.slice(0, -1);\n          if (this.typingBuffer) {\n            clearTimeout(this.typingBufferResetTimer);\n            const newItem = menu.findMenuItem(this.typingBuffer);\n            if (newItem) menu.activeMenuItem = newItem;\n\n            this.typingBufferResetTimer = setTimeout(() => {\n              this.typingBuffer = '';\n            }, 500);\n          }\n        }\n\n        break;\n      default:\n        if (mightProducePrintableCharacter(ev)) {\n          if (isFinite(this.typingBufferResetTimer)) {\n            clearTimeout(this.typingBufferResetTimer);\n          }\n\n          this.typingBuffer += ev.key;\n          const newItem = menu.findMenuItem(this.typingBuffer);\n          if (newItem) menu.activeMenuItem = newItem;\n\n          this.typingBufferResetTimer = setTimeout(() => {\n            this.typingBuffer = '';\n          }, 500);\n        } else {\n          handled = false;\n        }\n    }\n\n    if (handled) {\n      ev.preventDefault();\n      ev.stopPropagation();\n    }\n  }\n\n  handleEvent(event: Event): void {\n    if (event.type === 'keydown') {\n      this.handleKeydownEvent(event as KeyboardEvent);\n    } else if (event.type === 'keyup') {\n      this.handleKeyupEvent(event as KeyboardEvent);\n    } else if (event.type === 'pointermove') {\n      this.lastMoveEvent = event as PointerEvent;\n    } else if (event.type === 'pointerup' && event.target === this.scrim) {\n      if (\n        Number.isFinite(this.rootMenu._openTimestamp!) &&\n        Date.now() - this.rootMenu._openTimestamp! < 120\n      ) {\n        // Hold mode...\n        this.state = 'modal';\n      } else {\n        // Cancel\n        this.hide();\n      }\n    } else if (event.type === 'contextmenu') {\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    super.handleEvent(event);\n  }\n\n  dispatchEvent(ev: Event): boolean {\n    if (!this.menuHost) return false;\n    return this.menuHost.dispatchEvent(ev);\n  }\n\n  get scrim(): Element {\n    return this._scrim.element;\n  }\n\n  private connectScrim(root?: Node | null): void {\n    const { scrim } = this;\n    scrim.addEventListener('pointerup', this);\n\n    scrim.addEventListener('contextmenu', this);\n\n    scrim.addEventListener('keydown', this);\n    scrim.addEventListener('keyup', this);\n    scrim.addEventListener('pointermove', this);\n\n    this._scrim.open({ root });\n  }\n\n  private disconnectScrim(): void {\n    const { scrim } = this;\n    scrim.removeEventListener('pointerup', this);\n\n    scrim.removeEventListener('contextmenu', this);\n\n    scrim.removeEventListener('keydown', this);\n    scrim.removeEventListener('keyup', this);\n    scrim.removeEventListener('pointermove', this);\n    this._scrim.close();\n  }\n\n  get rootMenu(): RootMenu {\n    // I AM THE ONE WHO KNOCKS\n    return this;\n  }\n\n  show(options?: {\n    location?: [x: number, y: number];\n    alternateLocation?: [x: number, y: number];\n    parent?: Node | null; // Where the menu should attach\n    keyboardModifiers?: KeyboardModifiers;\n  }): boolean {\n    // Connect the scrim now, so that the menu can be measured and placed\n    this.connectScrim(options?.parent);\n    if (!super.show({ ...options, parent: this.scrim })) {\n      // There was nothing to show: remove the scrim\n      this.disconnectScrim();\n      return false;\n    }\n\n    // Record the opening time.\n    // If we receive a mouseup within a small delta of the open time stamp\n    // hold the menu open until it is dismissed, otherwise close it.\n    this._openTimestamp = Date.now();\n    this.state = 'open';\n    return true;\n  }\n\n  hide(): void {\n    this.cancelDelayedOperation();\n    if (this.state !== 'closed') {\n      this.activeMenuItem = null;\n      super.hide();\n      this.state = 'closed';\n      this.disconnectScrim();\n    }\n  }\n\n  scheduleOperation(fn: () => void): void {\n    this.cancelDelayedOperation();\n\n    const delay = this.submenuHysteresis;\n    if (delay <= 0) {\n      fn();\n      return;\n    }\n\n    this.hysteresisTimer = setTimeout(() => {\n      this.hysteresisTimer = 0;\n      fn();\n    }, delay);\n  }\n\n  cancelDelayedOperation(): void {\n    if (this.hysteresisTimer) {\n      clearTimeout(this.hysteresisTimer);\n      this.hysteresisTimer = 0;\n    }\n  }\n\n  /**\n   * Delay (in milliseconds) before displaying a submenu.\n   * Prevents distracting \"flashing\" of submenus when moving through the\n   * options in a menu.\n   */\n  get submenuHysteresis(): number {\n    return 120;\n  }\n}\n\nfunction isDynamic(item: MenuItemTemplate): boolean {\n  const result =\n    typeof item.disabled === 'function' ||\n    typeof item.hidden === 'function' ||\n    typeof item.checked === 'function' ||\n    typeof item.label === 'function' ||\n    typeof item.ariaDetails === 'function' ||\n    typeof item.ariaLabel === 'function';\n\n  if (item.type === 'submenu' && item.submenu) {\n    return result || item.submenu.some(isDynamic);\n  }\n\n  return result;\n}\n","import {\n  eventLocation,\n  keyboardModifiersFromEvent,\n  KeyboardModifiers,\n  LongPressDetector,\n} from '../common/events';\nimport { UIElement } from '../common/ui-element';\nimport { MenuItemTemplate } from './menu-core';\nimport { MENU_TEMPLATE, MENU_STYLE } from './menu-templates';\nimport { RootMenu } from './root-menu';\n\n/**\n * This web component display a contextual menu when the user performs the\n * appropriate gesture (right-click, control+click, shift+F10, etc...),\n * handles the user interaction to navigate the items in the menu and submenus\n * and either invoke the `onSelect()` hook associated with the selected menu item\n * or dispatches a 'select' event when the user completes their selection.\n *\n * Place this element inside a container and the contextual menu will be\n * displayed when a right-click/control+click/long tap is performed in the\n * container or if the container is keyboard focused when shift+f10 is pressed.\n * In the former case, the menu is diplayed where the click/tap occured.\n * In the later case, the menu is displayed in the center of the parent container.\n *\n * This component is:\n * - screen-reader compatible\n * - keyboard navigable\n * - dark-theme aware\n * - responsive (the menu and submenus will attempt to avoid being displayed\n *   outside of the viewport boundary)\n *\n * Principles of Operation\n *\n * The content of a menu (menu items and submenus) is represented by a 'model',\n * an instance of the Menu class.\n * The model is created from:\n * - argument to the UIContextMenu constructor\n * - setting the `menuItems` property\n * - a `<script>` tag containing a JSON description of menu items\n * - a set of child `<ui-menu-item>` elements.\n *\n * A menu can also have a `<style>` tag, which is applied to style the menu\n * once it is open.\n *\n * The `<ui-context-menu>` and its child elements are kept hidden.\n *\n * When the menu is invoked (with `show()`) a scrim element is created\n * and added as a child of the `<ui-context-menu>`, and a new `<ul>` element\n * is created and attached as a child of the scrim.\n *\n * A set of `<li>` element is added as children of the `<ul>` element, one\n * for each visible menu item, whether this menu item was specified in\n * JSON or with a `<menu-item>` element. The `<li>` element are made of\n * the following components:\n * - a checkmark (optional)\n * - a text label (as a text node, if specified from JSON or as a cloned\n * `UIMenuItemElement` if specified from the `<ui-menu-item>`)\n * - a submenu indicator\n *\n */\nexport class UIContextMenu extends UIElement {\n  private rootMenu?: RootMenu;\n  // The menu items specified via a constructor or setter\n  private templateMenuItems: MenuItemTemplate[];\n\n  private longPressDetector?: LongPressDetector;\n\n  constructor(menuItems?: MenuItemTemplate[]) {\n    super({\n      template: MENU_TEMPLATE,\n      style: MENU_STYLE,\n    });\n    this.templateMenuItems = menuItems ?? [];\n  }\n\n  set menuItems(menuItems: MenuItemTemplate[]) {\n    this.templateMenuItems = menuItems;\n    if (this.rootMenu) {\n      this.rootMenu.menuItemTemplates = menuItems;\n    }\n  }\n\n  get menuItems(): MenuItemTemplate[] {\n    return this.templateMenuItems;\n  }\n\n  /**\n   * @internal\n   */\n  handleEvent(event: Event): void {\n    this.longPressDetector?.dispose();\n    this.longPressDetector = undefined;\n\n    if (event.type === 'contextmenu') {\n      const evt = event as MouseEvent;\n      this.show({\n        location: [Math.round(evt.clientX), Math.round(evt.clientY)],\n        keyboardModifiers: keyboardModifiersFromEvent(evt),\n      });\n      event.preventDefault();\n      event.stopPropagation();\n    } else if (event.type === 'keydown') {\n      const evt = event as KeyboardEvent;\n      if (evt.code === 'ContextMenu' || (evt.code === 'F10' && evt.shiftKey)) {\n        // Shift+F10 = contextual menu\n        // Get the center of the parent\n        const bounds = this.parentElement?.getBoundingClientRect();\n        if (bounds) {\n          this.show({\n            location: [\n              Math.round(bounds.left + bounds.width / 2),\n              Math.round(bounds.top + bounds.height / 2),\n            ],\n            keyboardModifiers: keyboardModifiersFromEvent(evt),\n          });\n          event.preventDefault();\n          event.stopPropagation();\n        }\n      }\n    } else if (\n      event.type === 'pointerdown' &&\n      event.target === this.shadowRoot?.host.parentNode\n    ) {\n      const pt = eventLocation(event);\n      this.longPressDetector = new LongPressDetector(event, () => {\n        this.show({\n          location: pt,\n          keyboardModifiers: keyboardModifiersFromEvent(event),\n        });\n      });\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  connectedCallback(): void {\n    super.connectedCallback();\n    // Listen for contextual menu in the parent\n    const parent = this.parentNode;\n    if (parent) {\n      parent.addEventListener('contextmenu', this);\n      parent.addEventListener('keydown', this);\n      parent.addEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    const parent = this.parentNode;\n    if (parent) {\n      parent.removeEventListener('contextmenu', this);\n      parent.removeEventListener('keydown', this);\n      parent.removeEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  focus(): void {\n    super.focus();\n    if (this.rootMenu && this.rootMenu.state !== 'closed') {\n      if (this.rootMenu.activeMenuItem) {\n        this.rootMenu.activeMenuItem.element?.focus();\n      } else {\n        this.rootMenu.element.focus();\n      }\n    }\n  }\n\n  /**\n   * Display the menu at the specified location.\n   * If provided, the `keyboardModifiers` option can change what commands\n   * are visible, enabled, or what their label is.\n   *\n   * The contextual menu is shown automatically when the appropriate UI gesture\n   * is performed by the user (right-click, shift+F10, etc...). This method\n   * only needs to be called to trigger the menu manually (for example to\n   * trigger it on click of an item).\n   */\n  show(options?: {\n    location?: [x: number, y: number];\n    keyboardModifiers?: KeyboardModifiers;\n  }): void {\n    if (!this.rootMenu) {\n      // Import inline (in the component) style sheet\n      this.importStyle();\n\n      // Inline menu items (as a JSON structure in a <script> tag\n      // in the markup)\n      let jsonMenuItems: MenuItemTemplate[] = this.json as MenuItemTemplate[];\n      if (!Array.isArray(jsonMenuItems)) jsonMenuItems = [];\n      this.rootMenu = new RootMenu(\n        [...this.templateMenuItems, ...jsonMenuItems],\n        {\n          host: this.shadowRoot?.host,\n          assignedElement: this.shadowRoot?.querySelector<HTMLElement>('ul'),\n        }\n      );\n    }\n\n    this.style.display = 'block';\n    if (this.rootMenu.show({ ...options, parent: this.shadowRoot! })) {\n      if (!this.hasAttribute('tabindex')) {\n        this.setAttribute('tabindex', '-1');\n      }\n\n      this.focus();\n    } else {\n      this.style.display = 'none';\n    }\n  }\n\n  /**\n   * Hide the menu.\n   *\n   * The visibility of the menu is typically controlled by the user\n   * interaction: the menu is automatically hidden if the user release the\n   * mouse button, or after having selected a command. This is a manual\n   * override that should be very rarely needed.\n   */\n  hide(): void {\n    this.rootMenu?.hide();\n    this.style.display = 'none';\n  }\n}\n\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UIContextMenu: typeof UIContextMenu;\n  }\n  /** @internal */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace JSX {\n    interface IntrinsicElements {\n      'ui-context-menu': UIContextMenu;\n    }\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-context-menu',\n  className: 'UIContextMenu',\n  constructor: UIContextMenu,\n});\n","import { getEdge, getOppositeEdge, UIElement } from '../common/ui-element';\nimport {\n  keyboardModifiersFromEvent,\n  KeyboardModifiers,\n} from '../common/events';\nimport { MenuItemTemplate } from './menu-core';\nimport { RootMenu } from './root-menu';\nimport { MENU_TEMPLATE, MENU_STYLE } from './menu-templates';\n\nexport class UIPopupMenu extends UIElement {\n  position: 'leading' | 'trailing' | 'left' | 'end' = 'leading';\n\n  private rootMenu?: RootMenu;\n  private templateMenuItems: MenuItemTemplate[];\n\n  private _savedTransform?: string;\n\n  constructor(menuItems?: MenuItemTemplate[]) {\n    super({\n      template: MENU_TEMPLATE,\n      style: MENU_STYLE,\n    });\n    this.templateMenuItems = menuItems ?? [];\n    this.reflectStringAttribute('position');\n  }\n\n  get menuItems(): MenuItemTemplate[] {\n    return this.templateMenuItems;\n  }\n\n  set menuItems(menuItems: MenuItemTemplate[]) {\n    this.templateMenuItems = menuItems;\n    if (this.rootMenu) {\n      this.rootMenu.menuItemTemplates = menuItems;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  handleEvent(event: Event): void {\n    if (event.type === 'keydown' && event.target === this.parentElement) {\n      const evt = event as KeyboardEvent;\n      if (evt.code === 'Return' || evt.code === 'Enter') {\n        this.show({\n          keyboardModifiers: keyboardModifiersFromEvent(evt),\n        });\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    } else if (event.type === 'pointerdown') {\n      console.assert(this.shadowRoot?.host.parentNode === this.parentElement);\n      if (event.target === this.shadowRoot?.host.parentNode) {\n        this.show({\n          keyboardModifiers: keyboardModifiersFromEvent(event),\n        });\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  connectedCallback(): void {\n    super.connectedCallback();\n    // Listen for contextual menu in the parent\n    const parent = this.parentNode;\n    if (parent) {\n      parent.addEventListener('keydown', this);\n      parent.addEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * Custom elements lifecycle hooks\n   * @internal\n   */\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    const parent = this.parentNode;\n    if (parent) {\n      parent.removeEventListener('keydown', this);\n      parent.removeEventListener('pointerdown', this);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  focus(): void {\n    super.focus();\n    if (this.rootMenu && this.rootMenu.state !== 'closed') {\n      if (this.rootMenu.activeMenuItem) {\n        this.rootMenu.activeMenuItem.element?.focus();\n      } else {\n        this.rootMenu.element.focus();\n      }\n    }\n  }\n\n  /**\n   * Display the menu at the specified location.\n   * If provided, the `keyboardModifiers` option can change what commands\n   * are visible, enabled, or what their label is.\n   *\n   * The contextual menu is shown automatically when the appropriate UI gesture\n   * is performed by the user (right-click, shift+F10, etc...). This method\n   * only needs to be called to trigger the menu manually (for example to\n   * trigger it on click of an item).\n   */\n  show(options?: { keyboardModifiers?: KeyboardModifiers }): void {\n    if (!this.parentElement) return;\n    if (!this.rootMenu) {\n      // Import inline (in the component) style sheet\n      this.importStyle();\n\n      // Inline menu items (as a JSON structure in a <script> tag\n      // in the markup)\n      let jsonMenuItems = (this.json as unknown) as MenuItemTemplate[];\n      if (!Array.isArray(jsonMenuItems)) jsonMenuItems = [];\n      this.rootMenu = new RootMenu(\n        [...this.templateMenuItems, ...jsonMenuItems],\n        {\n          host: this.shadowRoot?.host,\n          assignedElement: this.shadowRoot?.querySelector<HTMLElement>('ul'),\n        }\n      );\n    }\n\n    this.style.display = 'inline-block';\n    // This is yucky...\n    // The 'fixed' display mode (used by the scrim to position itself over\n    // the viewport) becomes 'relative' when a transform is specified\n    // on a parent element in WebKit and Chromium.\n    // See https://stackoverflow.com/revisions/15256339/2\n    // So we have to remove any transform that might be present to prevent\n    // the scrim from being displayed incorrectly.\n    this._savedTransform = window.getComputedStyle(\n      this.parentElement\n    ).transform;\n    if (this._savedTransform !== 'none') {\n      this.parentElement.style.transform = 'none';\n    }\n\n    const bounds = this.parentElement.getBoundingClientRect();\n    if (\n      this.rootMenu.show({\n        ...options,\n        location: [\n          getEdge(bounds, this.position ?? 'leading', this.computedDir),\n          bounds.bottom,\n        ],\n        alternateLocation: [\n          getOppositeEdge(bounds, this.position ?? 'leading', this.computedDir),\n          bounds.bottom,\n        ],\n        parent: this.shadowRoot,\n      })\n    ) {\n      if (!this.hasAttribute('tabindex')) {\n        this.setAttribute('tabindex', '-1');\n      }\n\n      this.focus();\n    } else {\n      this.style.display = 'none';\n    }\n  }\n\n  /**\n   * Hide the menu.\n   *\n   * The visibility of the menu is typically controlled by the user\n   * interaction: the menu is automatically hidden if the user release the\n   * mouse button, or after having selected a command. This is a manual\n   * override that should be very rarely needed.\n   */\n  hide(): void {\n    this.rootMenu?.hide();\n    this.style.display = 'none';\n    if (this._savedTransform !== 'none' && this.parentElement) {\n      this.parentElement.style.transform = this._savedTransform ?? 'none';\n    }\n  }\n}\n\nexport default UIPopupMenu;\n\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UIPopupMenu: typeof UIPopupMenu;\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-popup-menu',\n  className: 'UIPopupMenu',\n  constructor: UIPopupMenu,\n});\n","import { UIElement } from '../common/ui-element';\nimport { MENU_STYLE, MENU_TEMPLATE } from './menu-templates';\n\n/**\n * Use `<ui-submenu>` as a child of a `<ui-menuitem>`.\n *\n * This element is used as a \"template\" for a submenu when a\n * menu is displayed: it displays nothing by itself.\n *\n * It can include a `<style>` tag.\n */\nexport class UISubmenu extends UIElement {\n  constructor() {\n    super({\n      template: MENU_TEMPLATE,\n      style: MENU_STYLE,\n    });\n  }\n}\ndeclare global {\n  /** @internal */\n  export interface Window {\n    UISubmenu: typeof UISubmenu;\n  }\n}\n\nvoid UIElement.register({\n  tag: 'ui-submenu',\n  className: 'UISubmenu',\n  constructor: UISubmenu,\n});\n","import { UIElement } from './common/ui-element';\n\nexport { UIContextMenu, UIPopupMenu, UISubmenu } from './menus/menus';\n\n/**\n * To insure that all the web components are ready to use, and in particular\n * that custom methods on web components can be called, use:\n * ```\n * try {\n *  await ready();\n * // Ready to use the web components...\n * } catch (e) {\n *  // web components are not supported\n * }\n * ```\n *\n */\nexport async function ready(): Promise<unknown> {\n  if (window?.customElements) {\n    return Promise.all<void>(\n      Object.keys(UIElement.registry).map((x) =>\n        window.customElements.whenDefined(x)\n      )\n    );\n  }\n\n  return Promise.reject<void>(new Error('web components not supported'));\n}\n"],"names":[],"mappings":"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"}