{"version":3,"file":"ui.js","sources":["../src/common/events.ts","../src/common/ui-element.ts","../src/menus/menu-templates.ts","../src/common/scrim.ts","../src/menus/menu-base.ts","../src/menus/menu-item-element.ts","../src/menus/menu-core.ts","../src/menus/root-menu.ts","../src/menus/context-menu-element.ts","../src/menus/popup-menu-element.ts","../src/menus/submenu-element.ts"],"sourcesContent":["export type KeyboardModifiers = {\n    alt: boolean;\n    control: boolean;\n    shift: boolean;\n    meta: boolean;\n};\n\n// We use a class to encapsulate the state that needs to be tracked and,\n// more importantly, to avoid memory leaks by using the `handleEvent()` hook\n// to ensure proper disposal of event handlers\nexport class LongPressDetector {\n    private onLongPress: () => void;\n    private startPoint: [x: number, y: number];\n    private lastPoint: [x: number, y: number];\n\n    private timer: number;\n\n    static DELAY = 300; // in ms\n    constructor(triggerEvent: Event, onLongPress: () => void) {\n        this.onLongPress = onLongPress;\n        this.startPoint = eventLocation(triggerEvent);\n        this.lastPoint = this.startPoint;\n\n        this.timer = setTimeout(() => {\n            this.dispose();\n            if (distance(this.lastPoint, this.startPoint) < 10) {\n                this.onLongPress();\n            }\n        }, LongPressDetector.DELAY);\n        ['pointermove', 'pointerup', 'pointercancel'].forEach((x) =>\n            window.addEventListener(x, this, { passive: true })\n        );\n    }\n\n    dispose(): void {\n        clearTimeout(this.timer);\n        this.timer = undefined;\n\n        ['pointermove', 'pointerup', 'pointercancel'].forEach((x) =>\n            window.removeEventListener(x, this)\n        );\n    }\n\n    handleEvent(event: Event): void {\n        if (event.type === 'pointerup') {\n            this.dispose();\n\n            event.stopPropagation();\n        } else if (event.type === 'pointermove') {\n            this.lastPoint = eventLocation(event);\n\n            event.stopPropagation();\n        } else if (event.type === 'pointercancel') {\n            this.dispose();\n            event.stopPropagation();\n        }\n    }\n}\n\nfunction distance(\n    p1: [x: number, y: number],\n    p2: [x: number, y: number]\n): number {\n    const dx = p2[0] - p1[0];\n    const dy = p2[1] - p1[1];\n    return Math.sqrt(dx * dx + dy * dy);\n}\n\nexport function eventLocation(evt: Event): [x: number, y: number] {\n    if (evt instanceof MouseEvent) {\n        return [evt.clientX, evt.clientY];\n    } else if (evt instanceof TouchEvent) {\n        const result = Array.from(evt.touches).reduce(\n            (acc, x) => [acc[0] + x.clientX, acc[1] + x.clientY],\n            [0, 0]\n        );\n        const l = evt.touches.length;\n        return [result[0] / l, result[1] / l];\n    }\n\n    return undefined;\n}\n\nexport function eventPointerCount(evt: Event): number {\n    if (evt instanceof MouseEvent) {\n        return 1;\n    } else if (evt instanceof TouchEvent) {\n        return evt.touches.length;\n    }\n    return 0;\n}\n/**\n * When the potential start of a long press event (`pointerdown`)\n * event is detected, this function will invoke the `fn` callback if the\n * user performs a long press.\n */\nexport function onLongPress(triggerEvent: Event, fn: () => void): void {\n    new LongPressDetector(triggerEvent, fn);\n}\n\nexport function keyboardModifiersFromEvent(ev: Event): KeyboardModifiers {\n    const result = {\n        alt: false,\n        control: false,\n        shift: false,\n        meta: false,\n    };\n    if (\n        ev instanceof MouseEvent ||\n        ev instanceof TouchEvent ||\n        ev instanceof KeyboardEvent\n    ) {\n        if (ev.altKey) result.alt = true;\n        if (ev.ctrlKey) result.control = true;\n        if (ev.metaKey) result.meta = true;\n        if (ev.shiftKey) result.shift = true;\n    }\n    return result;\n}\n\nexport function equalKeyboardModifiers(\n    a: KeyboardModifiers,\n    b: KeyboardModifiers\n): boolean {\n    if ((!a && b) || (a && !b)) return false;\n    return (\n        a.alt === b.alt &&\n        a.control === b.control &&\n        a.shift === b.shift &&\n        a.meta === b.meta\n    );\n}\n\nconst PRINTABLE_KEYCODE = [\n    'Backquote', // Japanese keyboard: hankaku/zenkaku/kanji key, which is non-printable\n    'Digit0',\n    'Digit1',\n    'Digit2',\n    'Digit3',\n    'Digit4',\n    'Digit5',\n    'Digit6',\n    'Digit7',\n    'Digit8',\n    'Digit9',\n    'Minus',\n    'Equal',\n    'IntlYen', // Japanese Keyboard. Russian keyboard: \\/\n\n    'KeyQ', // AZERTY keyboard: labeled 'a'\n    'KeyW', // AZERTY keyboard: labeled 'z'\n    'KeyE',\n    'KeyR',\n    'KeyT',\n    'KeyY', // QWERTZ keyboard: labeled 'z'\n    'KeyU',\n    'KeyI',\n    'KeyO',\n    'KeyP',\n    'BracketLeft',\n    'BracketRight',\n    'Backslash', // May be labeled #~ on UK 102 keyboard\n    'KeyA', // AZERTY keyboard: labeled 'q'\n    'KeyS',\n    'KeyD',\n    'KeyF',\n    'KeyG',\n    'KeyH',\n    'KeyJ',\n    'KeyK',\n    'KeyL',\n    'Semicolon',\n    'Quote',\n    'IntlBackslash', // QWERTZ keyboard '><'\n    'KeyZ', // AZERTY: 'w', QWERTZ: 'y'\n    'KeyX',\n    'KeyC',\n    'KeyV',\n    'KeyB',\n    'KeyN',\n    'KeyM',\n    'Comma',\n    'Period',\n    'Slash',\n    'IntlRo', // Japanse keyboard '\\ろ'\n\n    'Space',\n\n    'Numpad0',\n    'Numpad1',\n    'Numpad2',\n    'Numpad3',\n    'Numpad4',\n    'Numpad5',\n    'Numpad6',\n    'Numpad7',\n    'Numpad8',\n    'Numpad9',\n    'NumpadAdd',\n    'NumpadComma',\n    'NumpadDecimal',\n    'NumpadDivide',\n    'NumpadEqual',\n    'NumpadHash',\n    'NumpadMultiply',\n    'NumpadParenLeft',\n    'NumpadParenRight',\n    'NumpadStar',\n    'NumpadSubstract',\n];\n\nexport function mightProducePrintableCharacter(evt: KeyboardEvent): boolean {\n    if (evt.ctrlKey || evt.metaKey) {\n        // ignore ctrl/cmd-combination but not shift/alt-combinations\n        return false;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\n    if (evt.key === 'Dead') return false;\n\n    // When issued via a composition, the `code` field is empty\n    if (evt.code === '') return true;\n\n    return PRINTABLE_KEYCODE.indexOf(evt.code) >= 0;\n}\n","/**\n * @internal\n */\nexport class UIElement extends HTMLElement {\n    private _json: any;\n    private _style: string;\n\n    constructor(options?: {\n        template: string | HTMLTemplateElement;\n        style: string | HTMLTemplateElement;\n    }) {\n        super();\n\n        this.attachShadow({ mode: 'open' });\n\n        if (options?.template instanceof HTMLTemplateElement) {\n            this.shadowRoot.appendChild(\n                options.template.content.cloneNode(true)\n            );\n        } else if (typeof options?.template === 'string') {\n            this.shadowRoot.innerHTML = options.template;\n        }\n\n        if (options?.style instanceof HTMLTemplateElement) {\n            this.shadowRoot.appendChild(options.style.content.cloneNode(true));\n        } else if (typeof options?.style === 'string') {\n            const style = document.createElement('style');\n            style.textContent = options.style;\n            this.shadowRoot.append(style);\n        }\n    }\n\n    /**\n     * Declare that an attribute should be reflected as a property\n     */\n    reflectStringAttribute(attrName: string, propName = attrName): void {\n        // Attributes should be all lower case, kebab-case.\n        console.assert(attrName.toLowerCase() === attrName);\n        Object.defineProperty(this, propName, {\n            enumerable: true,\n            get(): string {\n                return this.getAttribute(attrName);\n            },\n            set(value: string) {\n                this.setAttribute(attrName, value);\n            },\n        });\n    }\n    /**\n     * Declare that an attribute should be reflected as a property\n     */\n    reflectBooleanAttribute(attrName: string, propName = attrName): void {\n        // Attributes should be all lower case, kebab-case.\n        console.assert(attrName.toLowerCase() === attrName);\n        Object.defineProperty(this, propName, {\n            enumerable: true,\n            get(): boolean {\n                return this.hasAttribute(attrName);\n            },\n            set(value: boolean) {\n                if (value) {\n                    this.setAttribute(attrName, '');\n                } else {\n                    this.removeAttribute(attrName);\n                }\n            },\n        });\n    }\n\n    /**\n     * Declare that an attribute should be reflected as a property\n     */\n    reflectEnumAttribute(\n        attrName: string,\n        attrValues: string[],\n        propName = attrName\n    ): void {\n        // Attributes should be all lower case, kebab-case.\n        console.assert(attrName.toLowerCase() === attrName);\n        Object.defineProperty(this, propName, {\n            enumerable: true,\n            get(): string {\n                let value: string;\n                attrValues.forEach((x) => {\n                    if (this.hasAttribute(x)) {\n                        console.assert(\n                            typeof value === 'undefined',\n                            `inconsistent ${attrName} attributes on ${this}`\n                        );\n                        value = x;\n                    }\n                });\n                if (typeof value === 'string') return value;\n                return this.getAttribute(attrName);\n            },\n            set(value: string) {\n                this.setAttribute(attrName, value);\n                this.setAttribute(value, '');\n                attrValues.forEach((x) => {\n                    if (x !== value) {\n                        this.removeAttribute(x);\n                    }\n                });\n            },\n        });\n    }\n\n    reflectBooleanAttributes(\n        attrNames: (string | [attrName: string, propName: string])[]\n    ): void {\n        attrNames.forEach((x) => {\n            if (typeof x === 'string') {\n                this.reflectBooleanAttribute(x);\n            } else {\n                this.reflectBooleanAttribute(x[0], x[1]);\n            }\n        });\n    }\n    reflectStringAttributes(\n        attrNames: (string | [attrName: string, propName: string])[]\n    ): void {\n        attrNames.forEach((x) => {\n            if (typeof x === 'string') {\n                this.reflectStringAttribute(x);\n            } else {\n                this.reflectStringAttribute(x[0], x[1]);\n            }\n        });\n    }\n\n    get computedDir(): 'rtl' | 'ltr' {\n        return getComputedDir(this);\n    }\n\n    /**\n     * @internal\n     */\n    connectedCallback(): void {\n        return;\n    }\n    /**\n     * @internal\n     */\n    disconnectedCallback(): void {\n        return;\n    }\n\n    /**\n     * @internal\n     */\n    protected get json(): any {\n        if (typeof this._json === 'undefined') {\n            this._json = null;\n            const json = this.shadowRoot\n                .querySelector<HTMLSlotElement>('slot')\n                .assignedElements()\n                .filter(\n                    (x) =>\n                        x.tagName === 'SCRIPT' &&\n                        x['type'] === 'application/json'\n                )\n                .map((x) => x.textContent)\n                .join('');\n            if (json) {\n                try {\n                    this._json = JSON.parse(json);\n                } catch (e) {\n                    // There was an error parsing the JSON.\n                    // Display a helpful message.\n                    const msg = e.toString();\n                    const m = msg.match(/position ([0-9]+)/);\n                    if (m) {\n                        const index = parseInt(m[1]);\n                        const extract = json.substring(\n                            Math.max(index - 40, 0),\n                            index\n                        );\n                        throw new Error(msg + '\\n' + extract.trim());\n                    } else {\n                        throw e;\n                    }\n                }\n            }\n        }\n        return this._json;\n    }\n\n    /**\n     * @internal\n     */\n    protected get importedStyle(): any {\n        if (typeof this._style === 'undefined') {\n            this._style = this.shadowRoot\n                .querySelector<HTMLSlotElement>('slot')\n                .assignedElements()\n                .filter((x) => x.tagName === 'STYLE')\n                .map((x) => x.textContent)\n                .join('');\n        }\n        return this._style;\n    }\n\n    /** If there is an embedded <style> tag in the slot\n     *  \"import\" it in the shadow dom\n     */\n    importStyle(): void {\n        if (this.importedStyle) {\n            const style = document.createElement('style');\n            style.textContent = this.importedStyle;\n            this.shadowRoot.append(style);\n        }\n    }\n}\n\n/**\n * An element can have multiple 'parts', which function as a kind of\n * parallel classList.\n *\n * Add a part name to the part list of this element.\n */\nexport function addPart(el: HTMLElement, part: string): void {\n    if (!el) return;\n    const current = el.getAttribute('part') ?? '';\n    if (!current.includes(part)) {\n        el.setAttribute('part', `${current} ${part}`);\n    }\n}\n\n/**\n * Remove a part name from the part list of this element.\n */\nexport function removePart(el: HTMLElement, part: string): void {\n    if (!el) return;\n    const current = el.getAttribute('part') ?? '';\n    if (current.includes(part)) {\n        el.setAttribute(\n            'part',\n            current.replace(new RegExp('\\\\bs*' + part + 's*\\\\b', 'g'), '')\n        );\n    }\n}\n\nexport function getComputedDir(el: HTMLElement): 'ltr' | 'rtl' {\n    if (el.dir && el.dir !== 'auto') return el.dir as 'ltr' | 'rtl';\n    if (el.parentElement) return getComputedDir(el.parentElement);\n    return 'ltr';\n}\n\nexport function getOppositeEdge(\n    bounds: DOMRectReadOnly,\n    position: 'leading' | 'trailing' | 'left' | 'end',\n    direction: 'ltr' | 'rtl'\n): number {\n    if (\n        position === 'left' ||\n        (position === 'leading' && direction === 'ltr') ||\n        (position === 'trailing' && direction === 'rtl')\n    ) {\n        return bounds.right;\n    }\n    return bounds.left;\n}\n\nexport function getEdge(\n    bounds: DOMRectReadOnly,\n    position: 'leading' | 'trailing' | 'left' | 'end',\n    direction: 'ltr' | 'rtl'\n): number {\n    if (\n        position === 'left' ||\n        (position === 'leading' && direction === 'ltr') ||\n        (position === 'trailing' && direction === 'rtl')\n    ) {\n        return bounds.left;\n    }\n    return bounds.right;\n}\n","export const MENU_TEMPLATE = document.createElement('template');\nMENU_TEMPLATE.innerHTML = `<ul></ul><slot></slot>`;\nexport const MENU_STYLE = document.createElement('template');\nMENU_STYLE.innerHTML = `<style>\n*,\n::before,\n::after {\n    box-sizing: border-box;\n}\n:host {\n    display: none;\n    color-scheme: light dark;\n    -webkit-user-select: none;  /* Important: Safari iOS doesn't respect user-select */\n    user-select: none;\n    cursor: default;\n    -webkit-touch-callout: none;\n    -webkit-tap-highlight-color: rgba(0 0 0 0);\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    pointer-events: none;\n    opacity:  .5;\n}\n:host(:focus), :host(:focus-within) {\n    outline: Highlight auto 1px;    /* For Firefox */\n    outline: -webkit-focus-ring-color auto 1px;\n}\n:host div.scrim {\n    position: fixed;\n    contain: content;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    outline: none;\n    background: transparent;\n}\n:host slot {\n    display: none;\n}\nul.menu-container {\n    position: absolute;\n    width: auto;\n    height: auto;\n    z-index: 10000;\n    border-radius: 8px;\n    background: var(--menu-bg);\n    box-shadow: 0 0 2px rgba(0, 0, 0, .5), 0 0 20px rgba(0, 0, 0, .2);\n\n    list-style: none;\n    padding: 6px 0 6px 0;\n    margin: 0;\n    user-select: none;\n    cursor: default;\n\n    color: var(--label-color);\n    font-weight: normal;\n    font-style: normal;\n    text-shadow: none;\n    text-transform: none;\n    letter-spacing: 0;\n    outline: none;\n    opacity: 1;\n}\nul.menu-container > li {\n    display: flex;\n    flex-flow: row;\n    align-items: center;\n    padding: 1px 7px 1px 7px;\n    margin-top: 0;\n    margin-left: 6px;\n    margin-right: 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n    position: relative;\n    outline: none;\n    fill: currentColor;\n    user-select: none;\n    cursor: default;\n    text-align: left;\n    color: inherit;\n\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n}\nul.menu-container > li > .label {\n    appearance: none;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\n\nul.menu-container > li > .label.indent {\n    margin-left: 12px;\n}\nul.menu-container > li[role=separator] {\n    border-bottom: 1px solid #c7c7c7;\n    border-radius: 0;\n    padding: 0;\n    margin-left: 15px;\n    margin-right: 15px;\n    padding-top: 5px;\n    margin-bottom: 5px;\n    width: calc(100% - 30px);\n}\nul.menu-container > li[aria-disabled=true] {\n    opacity: .5;\n}\n\nul.menu-container > li.active {\n    background: var(--active-bg);\n    background: -apple-system-control-accent;\n    color: var(--active-label-color);\n}\n\nul.menu-container > li.active.is-submenu-open {\n    background: var(--active-bg-dimmed);\n    color: inherit;\n}\n\nul.menu-container > li[aria-haspopup=true]>.label {\n     padding-right: 0;\n}\n\n.right-chevron {\n    margin-left: 24px;\n    width: 10px;\n    height: 10px;\n    margin-bottom: 4px;\n}\n.checkmark {\n    margin-right: -11px;\n    margin-left: -4px;\n    margin-top : 2px;\n    width: 16px;\n    height: 16px;\n}\n\nul.menu-container > li[aria-haspopup=true].active::after {\n    color: white;\n}\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}\n</style>`;\n","import { getComputedDir } from './ui-element';\n\nexport class Scrim {\n    private _element: HTMLElement;\n\n    private dismissOnClick: boolean;\n    private onHide: () => void;\n\n    private savedOverflow: string;\n    private savedMarginRight: string;\n\n    private savedActiveElement: HTMLOrSVGElement;\n\n    private state: 'closed' | 'opening' | 'open' | 'closing';\n\n    private translucent: boolean;\n\n    /**\n     * - If `options.dismissOnClick` is true, the scrim is dismissed if the\n     * user clicks on the scrim. That's the behavior for menus, for example.\n     * - `onHide()` is called when the scrim is being hidden\n     * -\n     */\n    constructor(options?: {\n        translucent?: boolean;\n        dismissOnClick?: boolean;\n        onHide?: () => void;\n    }) {\n        this.dismissOnClick = options?.dismissOnClick ?? false;\n        this.translucent = options?.translucent ?? false;\n\n        this.state = 'closed';\n    }\n\n    get element(): HTMLElement {\n        if (this._element) return this._element;\n\n        const el = document.createElement('div');\n        el.setAttribute('role', 'presentation');\n\n        el.style.position = 'fixed';\n        el.style['contain'] = 'content';\n        el.style.top = '0';\n        el.style.left = '0';\n        el.style.right = '0';\n        el.style.bottom = '0';\n        el.style.zIndex = '9999';\n        el.style.outline = 'none';\n        if (this.translucent) {\n            el.style.background = 'rgba(255 255 255 .2)';\n            el.style['backdropFilter'] = 'contrast(40%)';\n        } else {\n            el.style.background = 'transparent';\n        }\n        this._element = el;\n        return el;\n    }\n\n    show(options: { root?: Node; child?: HTMLElement }): void {\n        if (this.state !== 'closed') return;\n\n        this.state = 'opening';\n\n        // Remember the previously focused element. We'll restore it when we close.\n        this.savedActiveElement = deepActiveElement();\n\n        const el = this.element;\n        (options?.root ?? document.body).appendChild(el);\n\n        el.addEventListener('click', this);\n        document.addEventListener('touchmove', this, false);\n        document.addEventListener('scroll', this, false);\n\n        // Prevent (some) scrolling\n        // (touch scrolling will still happen)\n        const scrollbarWidth =\n            window.innerWidth - document.documentElement.clientWidth;\n        this.savedMarginRight = document.body.style.marginRight;\n        this.savedOverflow = document.body.style.overflow;\n        document.body.style.overflow = 'hidden';\n\n        const marginRight = parseFloat(\n            getComputedStyle(document.body).marginRight\n        );\n\n        document.body.style.marginRight = `${marginRight + scrollbarWidth}px`;\n\n        if (options?.child) {\n            el.appendChild(options.child);\n        }\n        this.state = 'open';\n    }\n\n    hide(): void {\n        if (this.state !== 'open') return;\n        this.state = 'closing';\n\n        if (typeof this.onHide === 'function') this.onHide();\n\n        const el = this.element;\n        el.removeEventListener('click', this);\n        document.removeEventListener('touchmove', this, false);\n        document.removeEventListener('scroll', this, false);\n\n        el.parentNode.removeChild(el);\n\n        // Restore body state\n        document.body.style.overflow = this.savedOverflow;\n        document.body.style.marginRight = this.savedMarginRight;\n\n        // Restore the previously focused element\n        this.savedActiveElement?.focus?.();\n\n        // Remove all children\n        el.innerHTML = '';\n        this.state = 'closed';\n    }\n\n    handleEvent(ev: Event): void {\n        if (\n            ev.target === this._element &&\n            ev.type === 'click' &&\n            this.dismissOnClick\n        ) {\n            this.hide();\n            ev.preventDefault();\n            ev.stopPropagation();\n            return;\n        } else if (\n            ev.target === document &&\n            (ev.type === 'touchmove' || ev.type === 'scroll')\n        ) {\n            // This is an attempt at scrolling on a touch-device\n            this.hide();\n            ev.preventDefault();\n            ev.stopPropagation();\n            return;\n        }\n    }\n}\n\nfunction deepActiveElement(): HTMLOrSVGElement | null {\n    let a = document.activeElement;\n    while (a?.shadowRoot?.activeElement) {\n        a = a.shadowRoot.activeElement;\n    }\n    return (a as unknown) as HTMLOrSVGElement;\n}\n\n/**\n * Calculate the effective position (width or height) given a starting pos,\n * a placement (left, top, middle, etc...) and dir (ltr/rtl).\n */\nfunction getEffectivePos(\n    pos: number,\n    length: number,\n    placement: 'start' | 'end' | 'middle' | 'left' | 'right' | 'top' | 'bottom',\n    dir: 'ltr' | 'rtl'\n): number {\n    if (placement === 'middle') {\n        return pos - length / 2;\n    } else if (\n        (placement === 'start' && dir === 'ltr') ||\n        (placement === 'end' && dir === 'rtl') ||\n        placement === 'top' ||\n        placement === 'left'\n    ) {\n        return Math.max(0, pos - length);\n    }\n    return pos;\n}\n\nexport function getOppositeEffectivePos(\n    pos: number,\n    length: number,\n    placement: 'start' | 'end' | 'middle' | 'left' | 'right' | 'top' | 'bottom',\n    dir: 'ltr' | 'rtl'\n): number {\n    if (placement === 'middle') {\n        return pos - length / 2;\n    } else if (\n        (placement === 'start' && dir === 'ltr') ||\n        (placement === 'end' && dir === 'rtl') ||\n        placement === 'top' ||\n        placement === 'left'\n    ) {\n        return pos;\n    }\n    return pos - length;\n}\n\n/**\n * Set the position of the element so that it fits in the viewport.\n *\n * The element is first positioned at `location`.\n * If it overflows and there is an alternate location, use the alternate\n * location to fit the topright at the alternate location.\n *\n * If the element still overflows, adjust its location moving it up and to the\n * left as necessary until it fits (and adjusting its width/height as a result)\n */\nexport function fitInViewport(\n    el: HTMLElement,\n    options: {\n        location: [x: number, y: number];\n        alternateLocation?: [x: number, y: number];\n        verticalPos: 'bottom' | 'top' | 'middle' | 'start' | 'end';\n        horizontalPos: 'left' | 'right' | 'middle' | 'start' | 'end';\n        width?: number;\n        height?: number;\n        maxWidth?: number;\n        maxHeight?: number;\n    }\n): void {\n    const dir = getComputedDir(el) ?? 'ltr';\n\n    // Reset any location, so we can get the natural width/height\n    el.style.display = 'block';\n    el.style.position = 'absolute';\n    el.style.left = 'auto';\n    el.style.top = 'auto';\n    el.style.right = 'auto';\n    el.style.bottom = 'auto';\n    el.style.height = 'auto';\n    el.style.width = 'auto';\n\n    const elementBounds = el.getBoundingClientRect();\n\n    //\n    // Vertical positioning\n    //\n    const maxHeight = isFinite(options.maxHeight)\n        ? Math.min(options.maxHeight, window.innerHeight)\n        : window.innerHeight;\n    let height = Math.min(maxHeight, options.height ?? elementBounds.height);\n\n    let top = getEffectivePos(\n        options.location[1],\n        height,\n        options.verticalPos,\n        dir\n    );\n    if (top + height > window.innerHeight - 8) {\n        if (options.alternateLocation) {\n            top = getEffectivePos(\n                options.alternateLocation[1],\n                height,\n                options.verticalPos,\n                dir\n            );\n            if (top + height > window.innerHeight - 8) {\n                top = undefined;\n            }\n        } else {\n            top = undefined;\n        }\n    }\n    if (!isFinite(top)) {\n        // Move element as high as possible\n        top = Math.max(8, window.innerHeight - 8 - height);\n        if (8 + height > window.innerHeight - 8) {\n            // Still doesn't fit, we'll clamp it\n            el.style.bottom = '8px';\n        }\n    }\n    height = Math.min(top + height, window.innerHeight - 8) - top;\n\n    //\n    // Horizontal positioning\n    //\n    const maxWidth = isFinite(options.maxWidth)\n        ? Math.min(options.maxWidth, window.innerWidth)\n        : window.innerWidth;\n\n    let width = Math.min(maxWidth, options.width ?? elementBounds.width);\n\n    let left = getEffectivePos(\n        options.location[0],\n        width,\n        options.horizontalPos,\n        dir\n    );\n    if (left + width > window.innerWidth - 8) {\n        if (options.alternateLocation) {\n            left = getOppositeEffectivePos(\n                options.alternateLocation[0],\n                width,\n                options.verticalPos,\n                dir\n            );\n            if (left + width > window.innerWidth - 8) {\n                left = undefined;\n            }\n        } else {\n            left = undefined;\n        }\n    }\n    if (!isFinite(left)) {\n        // Move element as high as possible\n        left = Math.max(8, window.innerWidth - 8 - width);\n        if (8 + width > window.innerWidth - 8) {\n            // Still doesn't fit, we'll clamp it\n            el.style.right = '8px';\n        }\n    }\n    width = Math.min(left + width, window.innerWidth - 8) - left;\n\n    el.style.left = `${Math.round(left).toString()}px`;\n    el.style.top = `${Math.round(top).toString()}px`;\n    el.style.height = `${Math.round(height).toString()}px`;\n    el.style.width = `${Math.round(width).toString()}px`;\n}\n","import {\n    keyboardModifiersFromEvent,\n    KeyboardModifiers,\n} from '../common/events';\n\n/**\n * Base class to represent a menu item.\n * There are two subclasses:\n * - MenuItemFromTemplate for menu items created from a JSON template\n * - MenuItemFromElement for menu items created for a UIMenuItemElement\n */\nexport abstract class MenuItem {\n    parentMenu: MenuInterface;\n    submenu?: MenuInterface;\n\n    constructor(parentMenu: MenuInterface) {\n        this.parentMenu = parentMenu;\n    }\n\n    handleEvent(event: Event): void {\n        if (event.type === 'pointerenter') {\n            const ev = event as PointerEvent;\n            this.parentMenu.rootMenu.cancelDelayedOperation();\n            // If there is a submenu open, and the mouse is moving in the\n            // triangle formed from the current mouse location and the two\n            // adjacent corners of the open menu, schedule setting the new\n            // active menuitem to later\n            if (\n                this.parentMenu.isSubmenuOpen &&\n                this.parentMenu.activeMenuItem?.movingTowardSubmenu(ev)\n            ) {\n                this.parentMenu.rootMenu.scheduleOperation(() => {\n                    this.parentMenu.activeMenuItem = this;\n                    if (this.submenu) {\n                        this.openSubmenu(keyboardModifiersFromEvent(ev));\n                    }\n                });\n            } else {\n                this.parentMenu.activeMenuItem = this;\n                if (this.submenu) {\n                    this.openSubmenu(keyboardModifiersFromEvent(ev), {\n                        withDelay: true,\n                    });\n                }\n            }\n        } else if (event.type === 'pointerleave') {\n            if (this.parentMenu.rootMenu.activeMenu === this.parentMenu) {\n                this.parentMenu.activeMenuItem = null;\n            }\n        } else if (event.type === 'pointerup') {\n            // when modal, the items are activated on click,\n            // so ignore mouseup\n            if (this.parentMenu.rootMenu.state !== 'modal') {\n                this.select(keyboardModifiersFromEvent(event));\n            }\n            event.stopPropagation();\n            event.preventDefault();\n        }\n    }\n\n    abstract get type():\n        | 'normal'\n        | 'separator'\n        | 'submenu'\n        | 'checkbox'\n        | 'radio';\n\n    abstract get active(): boolean;\n    abstract get hidden(): boolean;\n    abstract get disabled(): boolean;\n    abstract get label(): string;\n    abstract set active(val: boolean);\n\n    // Notify the owner that a menu item has been selected\n    abstract dispatchSelect(kbd?: KeyboardModifiers): void;\n\n    abstract get element(): HTMLElement;\n\n    /**\n     * Called when a menu item is selected:\n     * - either dismiss the menu and execute the command\n     * - or display the submenu\n     */\n    select(kbd?: KeyboardModifiers): void {\n        this.parentMenu.rootMenu.cancelDelayedOperation();\n\n        if (this.submenu) {\n            this.openSubmenu(kbd);\n            return;\n        }\n\n        // Make the item blink, then execute the command\n        this.active = false;\n        setTimeout(() => {\n            this.active = true;\n            setTimeout(() => {\n                this.active = false;\n                setTimeout(() => {\n                    this.parentMenu.rootMenu.hide();\n                    setTimeout(() => this.dispatchSelect(kbd), 120);\n                }, 120);\n            }, 120);\n        }, 120);\n    }\n\n    /**\n     * Open the submenu of this menu item, with a delay if options.delay\n     * This delay improves targeting of submenus with the mouse.\n     */\n    openSubmenu(\n        kbd: KeyboardModifiers,\n        options?: { withDelay: boolean }\n    ): void {\n        if (options?.withDelay ?? false) {\n            this.parentMenu.rootMenu.scheduleOperation(() =>\n                this.openSubmenu(kbd)\n            );\n            return;\n        }\n        const bounds = this.element.getBoundingClientRect();\n        this.submenu.show({\n            location: [bounds.right, bounds.top - 4],\n            alternateLocation: [bounds.left, bounds.top - 4],\n            parent: this.parentMenu.rootMenu.element.parentNode,\n            keyboardModifiers: kbd,\n        });\n    }\n\n    movingTowardSubmenu(ev: PointerEvent): boolean {\n        const lastEv = this.parentMenu.rootMenu.lastMoveEvent;\n        if (!lastEv) return false;\n\n        const deltaT = ev.timeStamp - lastEv.timeStamp;\n        if (deltaT > 500) return false;\n\n        const deltaX = ev.clientX - lastEv.clientX;\n\n        // Moving too slow?\n        const s = speed(deltaX, lastEv.clientY - ev.clientY, deltaT);\n        if (s <= 0.2) return false;\n\n        // Moving horizontally towards the submenu?\n        let position: 'left' | 'right' = 'right';\n        if (this.submenu.element) {\n            const submenuBounds = this.submenu.element.getBoundingClientRect();\n\n            const bounds = this.element.getBoundingClientRect();\n            if (submenuBounds.left < bounds.left + bounds.width / 2) {\n                position = 'left';\n            }\n        }\n\n        return position === 'right' ? deltaX > 0 : deltaX < 0;\n    }\n}\n\nfunction speed(dx: number, dy: number, dt: number): number {\n    return Math.sqrt(dx * dx + dy * dy) / dt;\n}\n\nexport interface MenuInterface {\n    parentMenu: MenuInterface;\n    readonly rootMenu: RootMenuInterface;\n    // readonly menuHost: Element;\n\n    readonly element: HTMLElement;\n    readonly isSubmenuOpen: boolean;\n\n    activeMenuItem: MenuItem;\n    readonly firstMenuItem: MenuItem;\n    readonly lastMenuItem: MenuItem;\n\n    openSubmenu: MenuInterface;\n    readonly hasRadio: boolean;\n    readonly hasCheckbox: boolean;\n\n    hide(): void;\n    show(options: {\n        parent: Node;\n        location?: [x: number, y: number];\n        alternateLocation?: [x: number, y: number];\n        keyboardModifiers?: KeyboardModifiers;\n    }): void;\n    nextMenuItem(dir: number): MenuItem;\n    findMenuItem(text: string): MenuItem;\n    dispatchEvent(ev: Event): boolean;\n}\n\nexport interface RootMenuInterface extends MenuInterface {\n    lastMoveEvent: PointerEvent;\n    activeMenu: MenuInterface;\n    state: 'closed' | 'open' | 'modal';\n    readonly scrim: Element;\n\n    cancelDelayedOperation(): void;\n    scheduleOperation(op: () => void): void;\n}\n","import { UIElement } from '../common/ui-element';\nimport { MenuItem } from './menu-base';\n\nconst MENU_ITEM_STYLE = document.createElement('template');\nMENU_ITEM_STYLE.innerHTML = `<style>\n:host {\n    display: inline;\n    color-scheme: light dark;\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n    outline: none;\n    fill: currentColor;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    text-align: left;\n    color: var(--label-color);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    opacity:  .5;\n}\n\n:host([active]) {\n    color: var(--active-label-color);\n}\n\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}</style>`;\nconst MENU_ITEM_TEMPLATE = document.createElement('template');\nMENU_ITEM_TEMPLATE.innerHTML = '<slot></slot>';\n\n/**\n * Each `UIMenuItemElement` is wrapped inside a `<li>` tag.\n * A `UIMenuItemElement` represents the label part of a menu item.\n * Other elements such as the checkmark and the submenu indicator\n * are rendered by the menu container.\n */\nexport class UIMenuItemElement extends UIElement {\n    // The _menuItem is the 'model' corresponding to this element.\n    private _menuItem: MenuItem;\n\n    set menuItem(value: MenuItem) {\n        this._menuItem = value;\n    }\n    get menuItem(): MenuItem {\n        return this._menuItem;\n    }\n    constructor() {\n        super({ template: MENU_ITEM_TEMPLATE, style: MENU_ITEM_STYLE });\n        this.reflectBooleanAttributes([\n            'active',\n            'separator',\n            'disabled',\n            'checked',\n        ]);\n    }\n}\n\nexport default UIMenuItemElement;\n\ndeclare global {\n    /** @internal */\n    export interface Window {\n        UIMenuItemElement: typeof UIMenuItemElement;\n    }\n}\n\nif (!window.customElements.get('ui-menu-item')) {\n    window.UIMenuItemElement = UIMenuItemElement;\n    window.customElements.define('ui-menu-item', UIMenuItemElement);\n}\n","import {\n    KeyboardModifiers,\n    keyboardModifiersFromEvent,\n} from '../common/events';\nimport { fitInViewport } from '../common/scrim';\nimport { addPart, removePart, UIElement } from '../common/ui-element';\nimport { MenuInterface, MenuItem, RootMenuInterface } from './menu-base';\nimport { UIMenuItemElement } from './menu-item-element';\nimport { UISubmenuElement } from './submenu-element';\n\nexport type MenuItemTemplate = {\n    onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n    type?: 'normal' | 'separator' | 'submenu' | 'checkbox' | 'radio';\n    className?: string;\n    label?:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string);\n    ariaLabel?:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string);\n    ariaDetails?:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string);\n    submenu: MenuItemTemplate[];\n\n    hidden?:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean);\n    disabled?:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean);\n    checked?:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean);\n\n    /** Caller defined id string. Passed to the `onSelect()` hook. */\n    id?: string;\n\n    /** Caller defined data block. Passed to the `onSelect()` hook.*/\n    data?: any;\n};\n\n/**\n * An instance of `Menu` is a model of a collection of menu items, including\n * submenus.\n *\n *\n */\nexport class Menu implements MenuInterface {\n    parentMenu: MenuInterface;\n\n    protected _element: HTMLElement;\n    protected _menuItems: MenuItem[];\n    private _activeMenuItem: MenuItem;\n    isSubmenuOpen: boolean; // If true, _activeMenuItem.submenu_ is open\n\n    /**\n     * The Element from which menu items will be used as template (optional)\n     */\n    menuHost: Element;\n\n    hasCheckbox: boolean; // If true, has at least one checkbox menu item\n    hasRadio: boolean; // If true, has at least one radio menu item\n\n    /*\n     * The menu items template are preserved so that the actual menu items\n     * can be recalculated, for example if the keyboard modifiers change.\n     * (when isDynamic is true)\n     */\n    private _menuItemsTemplate: MenuItemTemplate[] | undefined;\n\n    /**\n     * Optional, an HTML element to be used as the container for this menu.\n     * Used when this maps to a custom element with a <ul> in its template.\n     */\n    protected _assignedContainer: HTMLElement;\n\n    /**\n     * - host: if the menu is inside an element, the host is this element.\n     * This is where a set of <ui-menu-item> elements will be read from.\n     * - assignedContainer: the element into which the menu items will be\n     * inserted. A <ul>. Could be in a custom element. If none is provided,\n     * a new <ul> is created.\n     * - wrapper: an element that wraps the container. This elements\n     * gets attached to the scrim for display. If none is provided,\n     * the container is used directly. Pass the custom element when\n     * a custom element wrapper is used (e.g. for <ui-submenu>)\n     */\n    constructor(\n        menuItems?: MenuItemTemplate[],\n        options?: {\n            parentMenu?: MenuInterface;\n            host?: Element;\n            assignedContainer?: HTMLElement;\n        }\n    ) {\n        this.parentMenu = options?.parentMenu ?? null;\n        this._assignedContainer = options?.assignedContainer;\n\n        this._menuItemsTemplate = menuItems;\n        this.isSubmenuOpen = false;\n\n        this.menuHost = options?.host;\n    }\n\n    handleEvent(event: Event): void {\n        if (event.type === 'wheel' && this._element) {\n            const ev = event as WheelEvent;\n            // Scroll wheel: adjust scroll position\n            this._element.scrollBy(0, ev.deltaY);\n\n            event.preventDefault();\n            event.stopPropagation();\n        }\n    }\n\n    get rootMenu(): RootMenuInterface {\n        return this.parentMenu?.rootMenu;\n    }\n\n    dispatchEvent(ev: Event): boolean {\n        return this.rootMenu.dispatchEvent(ev);\n    }\n\n    /**\n     * Update the 'model' of this menu (i.e. list of menu items) based\n     * on:\n     * - the state of the keyboard, for programmatically specified items\n     * - the content of the JSON and elements inside the host element\n     * (if there is one)\n     */\n    updateMenu(keyboardModifiers?: KeyboardModifiers): void {\n        // Save the current menu\n        const elem = this._element;\n        let saveCurrentItem: number;\n        let left: string;\n        let top: string;\n        let parent: Node;\n        if (elem) {\n            // If there is a cached element for this menu,\n            // remove it (but save its state)\n            saveCurrentItem = this._menuItems.indexOf(this.activeMenuItem);\n            parent = elem.parentNode;\n            left = elem.style.left;\n            top = elem.style.top;\n            parent?.removeChild(elem);\n            this._element = null;\n        }\n\n        this._menuItems = [];\n        this.hasCheckbox = false;\n        this.hasRadio = false;\n        if (this._menuItemsTemplate) {\n            this._menuItemsTemplate.forEach((x) =>\n                this.appendMenuItem(x, keyboardModifiers)\n            );\n        }\n\n        // Add menu-item-elements\n        if (this.menuHost?.shadowRoot) {\n            const itemElements = this.menuHost.shadowRoot\n                .querySelector<HTMLSlotElement>('slot')\n                .assignedElements()\n                .filter<UIMenuItemElement>(\n                    (x): x is UIMenuItemElement => x.tagName === 'UI-MENU-ITEM'\n                );\n            Array.from(itemElements).forEach((x) =>\n                this.appendMenuItem(x, keyboardModifiers)\n            );\n        }\n\n        this.hasCheckbox = this._menuItems.some((x) => x.type === 'checkbox');\n        this.hasRadio = this._menuItems.some((x) => x.type === 'radio');\n\n        if (elem) {\n            // If there was a previous version of the menu,\n            // restore it and its state\n            parent?.appendChild(this.element);\n\n            fitInViewport(this.element, {\n                location: [parseInt(left), parseInt(top)],\n                verticalPos: 'bottom',\n                horizontalPos: 'right',\n            });\n\n            this.activeMenuItem = this.menuItems[saveCurrentItem];\n            if (this.activeMenuItem?.submenu) {\n                this.activeMenuItem.openSubmenu(keyboardModifiers);\n            }\n        }\n    }\n\n    get menuItems(): MenuItem[] {\n        return this._menuItems;\n    }\n\n    set menuItemTemplates(value: MenuItemTemplate[]) {\n        this._menuItemsTemplate = value;\n        if (this._element) {\n            if (this.menuItems.filter((x) => !x.hidden).length === 0) {\n                this.hide();\n                return;\n            }\n            this.updateMenu();\n        }\n    }\n\n    /** First activable menu item */\n    get firstMenuItem(): MenuItem {\n        let result = 0;\n        let found = false;\n        const menuItems = this.menuItems;\n        while (!found && result <= menuItems.length - 1) {\n            const item = menuItems[result];\n            found = item.type !== 'separator' && !item.hidden && !item.disabled;\n            result += 1;\n        }\n\n        return !found ? null : menuItems[result - 1];\n    }\n    /** Last activable menu item */\n    get lastMenuItem(): MenuItem {\n        let result = this.menuItems.length - 1;\n        let found = false;\n        while (!found && result >= 0) {\n            const item = this.menuItems[result];\n            found = item.type !== 'separator' && !item.hidden && !item.disabled;\n            result -= 1;\n        }\n\n        return !found ? null : this.menuItems[result + 1];\n    }\n    /**\n     * The active menu is displayed on a colored background.\n     */\n    get activeMenuItem(): MenuItem {\n        return this._activeMenuItem;\n    }\n\n    /**\n     * Set to undefined to have no active item.\n     * Note that setting the active menu item doesn't automatically\n     * open the submenu (e.g. when keyboard navigating).\n     * Call `item.submenu.openSubmenu()` to open the submenu.\n     */\n    set activeMenuItem(value: MenuItem) {\n        this.parentMenu?.rootMenu.cancelDelayedOperation();\n        if (value !== this._activeMenuItem) {\n            // Remove previously active element\n            if (this.activeMenuItem) {\n                const item = this.activeMenuItem;\n                item.active = false;\n                // If there is a submenu, hide it\n                item.submenu?.hide();\n            }\n\n            if (value?.hidden) {\n                this._activeMenuItem = undefined;\n                return;\n            }\n\n            this._activeMenuItem = value;\n\n            // Make new element active\n            if (value) value.active = true;\n        }\n        if (value) {\n            value.element.focus();\n        } else {\n            this._element?.focus();\n        }\n\n        // Update secondary state of parent\n        this.parentMenu?.activeMenuItem?.element.classList.toggle(\n            'is-submenu-open',\n            !!value\n        );\n    }\n\n    nextMenuItem(dir: number): MenuItem {\n        if (!this._activeMenuItem && dir > 0) return this.firstMenuItem;\n        if (!this._activeMenuItem && dir < 0) return this.lastMenuItem;\n        const first = this._menuItems.indexOf(this.firstMenuItem);\n        const last = this._menuItems.indexOf(this.lastMenuItem);\n        let found = false;\n        let result = this._menuItems.indexOf(this._activeMenuItem) + dir;\n        while (!found && result >= first && result <= last) {\n            const item = this._menuItems[result];\n            found = item.type !== 'separator' && !item.hidden && !item.disabled;\n            result += dir;\n        }\n        return found\n            ? this._menuItems[result - dir]\n            : dir > 0\n            ? this.lastMenuItem\n            : this.firstMenuItem;\n    }\n\n    static _collator: Intl.Collator;\n\n    static get collator(): Intl.Collator {\n        if (Menu._collator) return Menu._collator;\n        Menu._collator = new Intl.Collator(undefined, {\n            usage: 'search',\n            sensitivity: 'base',\n        });\n        return Menu._collator;\n    }\n\n    findMenuItem(text: string): MenuItem {\n        const candidates = this._menuItems.filter(\n            (x) => x.type !== 'separator' && !x.hidden && !x.disabled\n        );\n        if (candidates.length === 0) return null;\n        const last =\n            Math.max(...candidates.map((x) => x.label.length)) - text.length;\n\n        if (last < 0) return null;\n\n        // Find a \"contain\" match\n        let result: MenuItem;\n        let i = 0;\n        while (i < last && !result) {\n            result = candidates.find(\n                (x) =>\n                    Menu.collator.compare(\n                        text,\n                        x.label.substr(i, text.length)\n                    ) === 0\n            );\n            i++;\n        }\n        return result;\n    }\n\n    makeElement(container?: HTMLElement): HTMLElement {\n        const ul = container ?? document.createElement('ul');\n        ul.classList.add('menu-container');\n        ul.setAttribute('part', 'menu-container');\n        ul.setAttribute('tabindex', '-1');\n        ul.setAttribute('role', 'menu');\n        ul.setAttribute('aria-orientation', 'vertical');\n        ul.addEventListener('wheel', this);\n\n        // Remove all items\n        ul.textContent = '';\n\n        // Add back all necessary items (after they've been updated if applicable)\n        this._menuItems.forEach((x) => {\n            const elem = x.element;\n            if (elem) ul.appendChild(elem);\n        });\n        ul.querySelector('li:first-of-type')?.setAttribute('tabindex', '0');\n\n        return ul;\n    }\n\n    /**\n     * Construct (or return a cached version) of an element representing\n     * the items in this menu (model -> view)\n     */\n    get element(): HTMLElement {\n        if (!this._element) {\n            this._element = this.makeElement(this._assignedContainer);\n        }\n\n        return this._element;\n    }\n\n    /**\n     * @param parent: where the menu should be attached\n     * @return false if no menu to show\n     */\n    show(options: {\n        parent: Node;\n        location?: [x: number, y: number];\n        alternateLocation?: [x: number, y: number];\n        keyboardModifiers?: KeyboardModifiers;\n    }): boolean {\n        this.updateMenu(options?.keyboardModifiers);\n        if (this.menuItems.filter((x) => !x.hidden).length === 0) return false;\n\n        options.parent.appendChild(this.element);\n\n        if (options.location) {\n            fitInViewport(this.element, {\n                location: options.location,\n                alternateLocation: options.alternateLocation,\n                verticalPos: 'bottom',\n                horizontalPos: 'right',\n            });\n        }\n\n        this.element.focus();\n\n        // Notify our parent we have opened\n        // (so the parent can close any other open submenu and/or\n        // change its state to display the active state correctly)\n        if (this.parentMenu) {\n            this.parentMenu.openSubmenu = this;\n        }\n\n        return true;\n    }\n\n    hide(): void {\n        // Hide any of our child submenus\n        this.openSubmenu = null;\n\n        this.activeMenuItem = undefined;\n\n        // Notify our parent\n        if (this.parentMenu) {\n            this.parentMenu.openSubmenu = null;\n        }\n\n        this._element?.parentNode?.removeChild(this._element);\n        this._element = null;\n    }\n\n    /**\n     * This method is called to record that one of our submenus has opened.\n     * To open a submenu call openSubmenu() on the item with the submenu\n     * or show() on the submenu.\n     */\n    set openSubmenu(submenu: MenuInterface) {\n        const expanded = submenu !== null;\n        // We're closing a submenu\n        if (this.activeMenuItem?.submenu) {\n            this.activeMenuItem.element?.setAttribute(\n                'aria-expanded',\n                expanded.toString()\n            );\n        }\n        this.isSubmenuOpen = expanded;\n    }\n\n    appendMenuItem(\n        menuItem: MenuItemTemplate | UIMenuItemElement,\n        keyboardModifiers?: KeyboardModifiers\n    ): void {\n        this.insertMenuItem(-1, menuItem, keyboardModifiers);\n    }\n\n    insertMenuItem(\n        pos: number,\n        menuItem: MenuItemTemplate | UIMenuItemElement,\n        keyboardModifiers?: KeyboardModifiers\n    ): void {\n        if (pos < 0) pos = Math.max(0, this._menuItems.length - 1);\n\n        let item: MenuItem;\n        if (menuItem instanceof UIMenuItemElement) {\n            item = new MenuItemFromElement(menuItem, this);\n        } else {\n            item = new MenuItemFromTemplate(menuItem, this, {\n                keyboardModifiers: keyboardModifiers,\n            });\n        }\n\n        this._menuItems.splice(pos + 1, 0, item);\n    }\n}\n\nexport function evalToBoolean(\n    item: MenuItemTemplate,\n    value:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean),\n    keyboardModifiers?: KeyboardModifiers\n): boolean {\n    if (typeof value === 'boolean') return value;\n    if (typeof value === 'function') {\n        return value(item, keyboardModifiers);\n    }\n    return undefined;\n}\n\nexport function evalToString(\n    item: MenuItemTemplate,\n    value:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string),\n    options: {\n        keyboardModifiers?: KeyboardModifiers;\n    }\n): string {\n    if (typeof value === 'string') {\n        return value;\n    } else if (typeof value === 'function') {\n        return value(item, options.keyboardModifiers);\n    }\n    return undefined;\n}\n\nconst CHEVRON_RIGHT_TEMPLATE = document.createElement('template');\nCHEVRON_RIGHT_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"right-chevron\"><svg focusable=\"false\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><path fill=\"currentColor\" d=\"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z\"></path></svg></span>`;\n\nconst CHECKMARK_TEMPLATE = document.createElement('template');\nCHECKMARK_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"checkmark\"><svg  xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M435.848 83.466L172.804 346.51l-96.652-96.652c-4.686-4.686-12.284-4.686-16.971 0l-28.284 28.284c-4.686 4.686-4.686 12.284 0 16.971l133.421 133.421c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-28.284-28.284c-4.686-4.686-12.284-4.686-16.97 0z\"></path></svg>\n</span>`;\n\nexport type MenuSelectEvent = {\n    keyboardModifiers?: KeyboardModifiers;\n    id?: string;\n    label?: string;\n    data?: any;\n    element?: HTMLElement;\n};\n\ndeclare global {\n    /**\n     * Map the custom event names to types\n     * @internal\n     */\n    export interface DocumentEventMap {\n        ['select']: CustomEvent<MenuSelectEvent>;\n    }\n}\n\nexport class MenuItemFromTemplate extends MenuItem {\n    _type: 'normal' | 'separator' | 'submenu' | 'checkbox' | 'radio';\n    _label?: string;\n    _disabled: boolean;\n    _hidden: boolean;\n\n    ariaLabel?: string;\n    ariaDetails?: string;\n    checked?: boolean;\n    onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n    submenu?: MenuInterface;\n    id?: string;\n    data?: any;\n\n    _element: HTMLElement;\n\n    constructor(\n        template: MenuItemTemplate,\n        parentMenu: MenuInterface,\n        options?: {\n            keyboardModifiers?: KeyboardModifiers;\n        }\n    ) {\n        super(parentMenu);\n        this.parentMenu = parentMenu;\n\n        this._hidden =\n            evalToBoolean(\n                template,\n                template.hidden,\n                options?.keyboardModifiers\n            ) ?? false;\n        this._disabled =\n            evalToBoolean(\n                template,\n                template.disabled,\n                options?.keyboardModifiers\n            ) ?? false;\n        this.checked =\n            evalToBoolean(\n                template,\n                template.checked,\n                options?.keyboardModifiers\n            ) ?? false;\n\n        this.id = template.id;\n        this._label = evalToString(template, template.label, options);\n        this.ariaLabel = evalToString(template, template.ariaLabel, options);\n        this.ariaDetails = evalToString(\n            template,\n            template.ariaDetails,\n            options\n        );\n        if (typeof template.onSelect) {\n            this.onSelect = template.onSelect;\n        }\n        this.data = template.data;\n\n        if (Array.isArray(template.submenu)) {\n            this._type = 'submenu';\n            this.submenu = new Menu(template.submenu, {\n                parentMenu,\n            });\n        } else {\n            if (\n                typeof template.type === 'undefined' &&\n                typeof template.checked !== 'undefined'\n            ) {\n                this._type = 'checkbox';\n            } else {\n                this._type = template.type ?? 'normal';\n            }\n        }\n    }\n\n    get type(): 'normal' | 'separator' | 'submenu' | 'checkbox' | 'radio' {\n        return this._type;\n    }\n    get label(): string {\n        return this._label ?? this.ariaLabel;\n    }\n    get hidden(): boolean {\n        return this._hidden;\n    }\n    get disabled(): boolean {\n        return this._disabled;\n    }\n\n    private render(): HTMLElement | null {\n        if (this.hidden) return null;\n\n        if (this.type === 'separator') {\n            const li = document.createElement('li');\n            li.setAttribute('part', 'menu-separator');\n            li.setAttribute('role', 'separator');\n            return li;\n        }\n\n        if (\n            this.type !== 'normal' &&\n            this.type !== 'submenu' &&\n            this.type !== 'radio' &&\n            this.type !== 'checkbox'\n        ) {\n            return null;\n        }\n        const li = document.createElement('li');\n        li.setAttribute('part', 'menu-item');\n        li.setAttribute('tabindex', '-1');\n        if (this.type === 'radio') {\n            li.setAttribute('role', 'menuitemradio');\n        } else if (this.type === 'checkbox') {\n            li.setAttribute('role', 'menuitemcheckbox');\n        } else {\n            li.setAttribute('role', 'menuitem');\n        }\n        if (this.checked) {\n            li.setAttribute('aria-checked', 'true');\n            li.appendChild(CHECKMARK_TEMPLATE.content.cloneNode(true));\n        }\n        if (this.submenu) {\n            li.setAttribute('aria-haspopup', 'true');\n            li.setAttribute('aria-expanded', 'false');\n        }\n        if (this.ariaLabel) li.setAttribute('aria-label', this.ariaLabel);\n        if (this.ariaDetails) li.setAttribute('aria-label', this.ariaDetails);\n\n        if (this.disabled) {\n            li.setAttribute('aria-disabled', 'true');\n        } else {\n            li.removeAttribute('aria-disabled');\n            li.addEventListener('pointerenter', this);\n            li.addEventListener('pointerleave', this);\n            li.addEventListener('pointerup', this);\n        }\n\n        const span = document.createElement('span');\n        span.innerHTML = this.label;\n        span.className =\n            this.parentMenu.hasCheckbox || this.parentMenu.hasRadio\n                ? 'label indent'\n                : 'label';\n        if (!this.disabled) {\n            span.addEventListener('click', (ev: MouseEvent) =>\n                this.select(keyboardModifiersFromEvent(ev))\n            );\n        }\n        li.appendChild(span);\n        if (this.submenu) {\n            li.appendChild(CHEVRON_RIGHT_TEMPLATE.content.cloneNode(true));\n        }\n        return li;\n    }\n\n    get active(): boolean {\n        return this.element.classList.contains('active');\n    }\n\n    set active(val: boolean) {\n        if (val) {\n            this.element.classList.add('active');\n        } else {\n            this.element.classList.remove('active');\n        }\n    }\n\n    get element(): HTMLElement {\n        if (this._element) return this._element;\n        this._element = this.render();\n        return this._element;\n    }\n\n    dispatchSelect(kbd?: KeyboardModifiers): void {\n        const ev = new CustomEvent<MenuSelectEvent>('select', {\n            detail: {\n                keyboardModifiers: kbd,\n                id: this.id,\n                label: this.label,\n                data: this.data,\n            },\n        });\n        if (typeof this.onSelect === 'function') {\n            this.onSelect(ev);\n        } else {\n            this.parentMenu.dispatchEvent(ev);\n        }\n    }\n}\n\nexport class MenuItemFromElement extends MenuItem {\n    // The <ui-menu-item> in the <slot> serves as the 'template' for this\n    // menu item\n    _sourceElement: UIElement;\n    // The source element is cloned and inserted in a <li>\n    _sourceElementClone: UIElement;\n    // The <li> is cached\n    _cachedElement: HTMLElement;\n\n    constructor(element: UIMenuItemElement, parentMenu: MenuInterface) {\n        super(parentMenu);\n        this.parentMenu = parentMenu;\n        this._sourceElement = element;\n        element.menuItem = this;\n\n        // Read a <ui-submenu> element if there is one\n        if (element.shadowRoot) {\n            const submenuElements = element.shadowRoot\n                .querySelector<HTMLSlotElement>('slot')\n                .assignedElements()\n                .filter<UISubmenuElement>(\n                    (x): x is UISubmenuElement => x.tagName === 'UI-SUBMENU'\n                );\n            console.assert(\n                submenuElements?.length <= 1,\n                'Expected no more than one submenu'\n            );\n            if (submenuElements && submenuElements.length >= 1) {\n                this.submenu = new Submenu({\n                    host: submenuElements[0],\n                    parentMenu: parentMenu,\n                });\n            }\n        }\n    }\n\n    get type(): 'normal' | 'separator' | 'submenu' | 'checkbox' | 'radio' {\n        if (this.separator) return 'separator';\n        if (this.submenu) return 'submenu';\n        // @todo:  radio, checkbox\n        return 'normal';\n    }\n    get label(): string {\n        return this._sourceElement.innerHTML;\n    }\n    get hidden(): boolean {\n        return this._sourceElement.hasAttribute('hidden');\n    }\n    set hidden(value: boolean) {\n        if (value) {\n            this._sourceElementClone?.setAttribute('hidden', '');\n        } else {\n            this._sourceElementClone.removeAttribute('hidden');\n        }\n    }\n    get disabled(): boolean {\n        return this._sourceElement.hasAttribute('disabled');\n    }\n    set disabled(value: boolean) {\n        if (value) {\n            this._sourceElementClone?.setAttribute('disabled', '');\n            addPart(this._cachedElement, 'disabled');\n        } else {\n            this._sourceElementClone?.removeAttribute('disabled');\n            removePart(this._cachedElement, 'disabled');\n        }\n    }\n    get checked(): boolean {\n        return this._sourceElement.hasAttribute('checked');\n    }\n    set checked(value: boolean) {\n        if (value) {\n            this._sourceElementClone?.setAttribute('checked', '');\n            addPart(this._cachedElement, 'checked');\n        } else {\n            this._sourceElementClone?.removeAttribute('checked');\n            removePart(this._cachedElement, 'checked');\n        }\n    }\n    get separator(): boolean {\n        return this._sourceElement.hasAttribute('separator');\n    }\n    set separator(value: boolean) {\n        if (value) {\n            this._sourceElementClone?.setAttribute('separator', '');\n        } else {\n            this._sourceElementClone?.removeAttribute('separator');\n        }\n    }\n    get active(): boolean {\n        return this._cachedElement?.classList.contains('active') ?? false;\n    }\n\n    set active(val: boolean) {\n        // For the active attribute, set the value on the sourced element\n        // (the <ui-menu-item>)\n        if (val) {\n            this._cachedElement?.classList.add('active');\n            addPart(this._cachedElement, 'active');\n            this._sourceElementClone?.setAttribute('active', '');\n        } else {\n            this._cachedElement?.classList.remove('active');\n            removePart(this._cachedElement, 'active');\n            this._sourceElementClone?.removeAttribute('active');\n        }\n    }\n\n    private render(): HTMLElement | null {\n        if (this.hidden) return null;\n\n        if (this.separator) {\n            const li = document.createElement('li');\n            li.setAttribute('part', 'menu-separator');\n            li.setAttribute('role', 'separator');\n            return li;\n        }\n\n        const li = document.createElement('li');\n        li.setAttribute('part', 'menu-item');\n        li.setAttribute('tabindex', '-1');\n        if (this.type === 'radio') {\n            li.setAttribute('role', 'menuitemradio');\n        } else if (this.type === 'checkbox') {\n            li.setAttribute('role', 'menuitemcheckbox');\n        } else {\n            li.setAttribute('role', 'menuitem');\n        }\n        if (this.checked) {\n            li.setAttribute('aria-checked', 'true');\n            li.appendChild(CHECKMARK_TEMPLATE.content.cloneNode(true));\n        }\n        if (this.submenu) {\n            li.setAttribute('aria-haspopup', 'true');\n            li.setAttribute('aria-expanded', 'false');\n        }\n\n        if (this.disabled) {\n            li.setAttribute('aria-disabled', 'true');\n        } else {\n            li.removeAttribute('aria-disabled');\n            li.addEventListener('pointerenter', this);\n            li.addEventListener('pointerleave', this);\n            li.addEventListener('pointerup', this);\n        }\n\n        if (!this.disabled) {\n            li.addEventListener('click', (ev: MouseEvent) =>\n                this.select(keyboardModifiersFromEvent(ev))\n            );\n        }\n        this._sourceElementClone = this._sourceElement.cloneNode(\n            true\n        ) as UIElement;\n        li.appendChild(this._sourceElementClone);\n        if (this.submenu) {\n            li.appendChild(CHEVRON_RIGHT_TEMPLATE.content.cloneNode(true));\n        }\n\n        return li;\n    }\n\n    get element(): HTMLElement {\n        if (this._cachedElement) return this._cachedElement;\n        this._cachedElement = this.render();\n        return this._cachedElement;\n    }\n\n    dispatchSelect(kbd?: KeyboardModifiers): void {\n        const ev = new CustomEvent<MenuSelectEvent>('select', {\n            detail: {\n                keyboardModifiers: kbd,\n                id: this._sourceElement.getAttribute('id'),\n                label: this.label,\n                element: this._sourceElement,\n            },\n        });\n        if (typeof this._sourceElement.onselect === 'function') {\n            this._sourceElement.onselect(ev);\n        } else {\n            this.parentMenu.dispatchEvent(ev);\n        }\n    }\n}\n\nexport class Submenu extends Menu {\n    source: UISubmenuElement;\n    constructor(options: {\n        host: UISubmenuElement;\n        parentMenu: MenuInterface;\n    }) {\n        super([], {\n            parentMenu: options.parentMenu,\n            host: options.host,\n        });\n        this.source = options.host;\n    }\n    get element(): HTMLElement {\n        if (this._element) return this._element;\n\n        const clone = this.source.cloneNode(true) as UISubmenuElement;\n        // clone.style.display = 'block';\n        clone.importStyle();\n        this.makeElement(clone.shadowRoot.querySelector('ul'));\n        this._element = clone;\n        return clone;\n    }\n    show(options?: {\n        location?: [x: number, y: number];\n        keyboardModifiers?: KeyboardModifiers;\n    }): boolean {\n        return super.show({\n            ...options,\n            parent: this.parentMenu.rootMenu.scrim,\n        });\n    }\n    /**\n     */\n    hide(): void {\n        super.hide();\n    }\n}\n","import {\n    equalKeyboardModifiers,\n    KeyboardModifiers,\n    keyboardModifiersFromEvent,\n    mightProducePrintableCharacter,\n} from '../common/events';\nimport { Scrim } from '../common/scrim';\nimport { Menu, MenuItemTemplate } from './menu-core';\nimport { MenuInterface, RootMenuInterface } from './menu-base';\n\nexport class RootMenu extends Menu implements RootMenuInterface {\n    lastMoveEvent: PointerEvent;\n\n    private typingBufferResetTimer: number;\n    private typingBuffer: string;\n    private _scrim: Scrim;\n    private _openTimestamp: number;\n    private currentKeyboardModifiers: KeyboardModifiers;\n    private hysteresisTimer: number;\n    /**\n     * - 'closed': the menu is not visible\n     * - 'open': the menu is visible as long as the mouse button is pressed\n     * - 'modal': the menu is visible until dismissed, even with the mouse button\n     * released\n     */\n    state: 'closed' | 'open' | 'modal';\n\n    /** If true, the state of some of the menu items in this menu are\n     * provide by a function and may need to be updated dynamically\n     */\n    isDynamic: boolean;\n\n    /**\n     * If an `options.assignedElement` is provided, the root menu is\n     * attached to that element (the element will be modified\n     * to display the menu). Use this when using a popup menu.\n     * In this mode, call `show()` and `hide()` to control the\n     * display of the menu.\n     *\n     */\n    constructor(\n        menuItems?: MenuItemTemplate[],\n        options?: {\n            host?: Element;\n            assignedElement?: HTMLElement;\n            keyboardModifiers?: KeyboardModifiers;\n        }\n    ) {\n        super(menuItems, {\n            host: options?.host,\n            assignedContainer: options?.assignedElement,\n        });\n        this.isDynamic = menuItems.some(isDynamic);\n        this.currentKeyboardModifiers = options?.keyboardModifiers;\n        this.typingBuffer = '';\n        this.state = 'closed';\n\n        this._scrim = new Scrim({\n            dismissOnClick: true,\n            onHide: () => this.hide(),\n        });\n    }\n\n    /**\n     * The currently active menu: could be the root menu or a submenu\n     */\n    get activeMenu(): MenuInterface {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let result: MenuInterface = this;\n        while (result.isSubmenuOpen) {\n            result = result.activeMenuItem.submenu;\n        }\n        return result;\n    }\n\n    handleKeyupEvent(ev: KeyboardEvent): void {\n        if (this.isDynamic) {\n            const newModifiers = keyboardModifiersFromEvent(ev);\n            if (\n                !equalKeyboardModifiers(\n                    this.currentKeyboardModifiers,\n                    newModifiers\n                )\n            ) {\n                this.updateMenu(newModifiers);\n                this.currentKeyboardModifiers = newModifiers;\n            }\n        }\n    }\n\n    handleKeydownEvent(ev: KeyboardEvent): void {\n        if (ev.key === 'Tab') {\n            // Close and bubble\n            this.rootMenu.hide();\n            return;\n        }\n\n        if (this.isDynamic) {\n            const newModifiers = keyboardModifiersFromEvent(ev);\n            if (\n                !equalKeyboardModifiers(\n                    this.currentKeyboardModifiers,\n                    newModifiers\n                )\n            ) {\n                this.updateMenu(newModifiers);\n                this.currentKeyboardModifiers = newModifiers;\n            }\n        }\n\n        let handled = true;\n        const menu = this.activeMenu;\n        const menuItem = menu.activeMenuItem;\n        switch (ev.key) {\n            case ' ':\n            case 'Space':\n            case 'Return':\n            case 'Enter':\n                menuItem?.select(keyboardModifiersFromEvent(ev));\n                break;\n            case 'ArrowRight':\n                if (menuItem?.submenu) {\n                    menuItem.select(keyboardModifiersFromEvent(ev));\n                    this.activeMenu.activeMenuItem = this.activeMenu.firstMenuItem;\n                } else if (!menuItem) {\n                    menu.activeMenuItem = menu.firstMenuItem;\n                }\n                break;\n            case 'ArrowLeft':\n                if (menu === this.rootMenu) {\n                    if (!menuItem) {\n                        menu.activeMenuItem = menu.firstMenuItem;\n                    }\n                } else {\n                    menu.hide();\n                    const el = menu.parentMenu.activeMenuItem.element;\n                    el.focus();\n                    el.classList.remove('is-submenu-open');\n                }\n                break;\n            case 'ArrowDown':\n                menu.activeMenuItem = menu.nextMenuItem(+1);\n                break;\n            case 'ArrowUp':\n                menu.activeMenuItem = menu.nextMenuItem(-1);\n                break;\n            case 'Home':\n            case 'PageUp':\n                menu.activeMenuItem = menu.firstMenuItem;\n                break;\n            case 'End':\n            case 'PageDown':\n                menu.activeMenuItem = menu.lastMenuItem;\n                break;\n            case 'Escape':\n                this.rootMenu.hide();\n                break;\n            case 'Backspace':\n                if (this.typingBuffer) {\n                    this.typingBuffer = this.typingBuffer.slice(0, -1);\n                    if (this.typingBuffer) {\n                        clearTimeout(this.typingBufferResetTimer);\n                        const newItem = menu.findMenuItem(this.typingBuffer);\n                        if (newItem) menu.activeMenuItem = newItem;\n\n                        this.typingBufferResetTimer = setTimeout(() => {\n                            this.typingBuffer = '';\n                        }, 500);\n                    }\n                }\n                break;\n            default:\n                if (mightProducePrintableCharacter(ev)) {\n                    if (isFinite(this.typingBufferResetTimer)) {\n                        clearTimeout(this.typingBufferResetTimer);\n                    }\n                    this.typingBuffer += ev.key;\n                    const newItem = menu.findMenuItem(this.typingBuffer);\n                    if (newItem) menu.activeMenuItem = newItem;\n\n                    this.typingBufferResetTimer = setTimeout(() => {\n                        this.typingBuffer = '';\n                    }, 500);\n                } else {\n                    handled = false;\n                }\n        }\n        if (handled) {\n            ev.preventDefault();\n            ev.stopPropagation();\n        }\n    }\n\n    handleEvent(event: Event): void {\n        if (event.type === 'keydown') {\n            this.handleKeydownEvent(event as KeyboardEvent);\n        } else if (event.type === 'keyup') {\n            this.handleKeyupEvent(event as KeyboardEvent);\n        } else if (event.type === 'pointermove') {\n            this.lastMoveEvent = event as PointerEvent;\n        } else if (event.type === 'pointerup' && event.target === this.scrim) {\n            if (\n                isFinite(this.rootMenu._openTimestamp) &&\n                Date.now() - this.rootMenu._openTimestamp < 120\n            ) {\n                // Hold mode...\n                this.state = 'modal';\n            } else {\n                // Cancel\n                this.hide();\n            }\n        } else if (event.type === 'contextmenu') {\n            event.preventDefault();\n            event.stopPropagation();\n            return;\n        }\n        super.handleEvent(event);\n    }\n\n    dispatchEvent(ev: Event): boolean {\n        return this.menuHost.dispatchEvent(ev);\n    }\n\n    get scrim(): Element {\n        return this._scrim.element;\n    }\n\n    private connectScrim(root: Node): void {\n        const scrim = this.scrim;\n        scrim.addEventListener('pointerup', this);\n\n        scrim.addEventListener('contextmenu', this);\n\n        scrim.addEventListener('keydown', this);\n        scrim.addEventListener('keyup', this);\n        scrim.addEventListener('pointermove', this);\n\n        this._scrim.show({ root });\n    }\n\n    private disconnectScrim(): void {\n        const scrim = this.scrim;\n        scrim.removeEventListener('pointerup', this);\n\n        scrim.removeEventListener('contextmenu', this);\n\n        scrim.removeEventListener('keydown', this);\n        scrim.removeEventListener('keyup', this);\n        scrim.removeEventListener('pointermove', this);\n        this._scrim.hide();\n    }\n\n    get rootMenu(): RootMenu {\n        // I AM THE ONE WHO KNOCKS\n        return this;\n    }\n\n    show(options?: {\n        location?: [x: number, y: number];\n        alternateLocation?: [x: number, y: number];\n        parent?: Node; // Where the menu should attach\n        keyboardModifiers?: KeyboardModifiers;\n    }): boolean {\n        // Connect the scrim now, so that the menu can be measured and placed\n        this.connectScrim(options?.parent);\n        if (!super.show({ ...options, parent: this.scrim })) {\n            // There was nothing to show: remove the scrim\n            this.disconnectScrim();\n            return false;\n        }\n        // Record the opening time.\n        // If we receive a mouseup within a small delta of the open time stamp\n        // hold the menu open until it is dismissed, otherwise close it.\n        this._openTimestamp = Date.now();\n        this.state = 'open';\n        return true;\n    }\n\n    hide(): void {\n        this.cancelDelayedOperation();\n        if (this.state !== 'closed') {\n            this.activeMenuItem = null;\n            super.hide();\n            this.state = 'closed';\n            this.disconnectScrim();\n        }\n    }\n\n    scheduleOperation(fn: () => void): void {\n        this.cancelDelayedOperation();\n\n        const delay = this.submenuHysteresis;\n        if (delay <= 0) {\n            fn();\n            return;\n        }\n        this.hysteresisTimer = setTimeout(() => {\n            this.hysteresisTimer = undefined;\n            fn();\n        }, delay);\n    }\n\n    cancelDelayedOperation(): void {\n        if (this.hysteresisTimer) {\n            clearTimeout(this.hysteresisTimer);\n            this.hysteresisTimer = undefined;\n        }\n    }\n\n    /**\n     * Delay (in milliseconds) before displaying a submenu.\n     * Prevents distracting \"flashing\" of submenus when moving through the\n     * options in a menu.\n     */\n    get submenuHysteresis(): number {\n        return 120;\n    }\n}\n\nfunction isDynamic(item: MenuItemTemplate): boolean {\n    const result =\n        typeof item.disabled === 'function' ||\n        typeof item.hidden === 'function' ||\n        typeof item.checked === 'function' ||\n        typeof item.label === 'function' ||\n        typeof item.ariaDetails === 'function' ||\n        typeof item.ariaLabel === 'function';\n\n    if (item.type === 'submenu' && item.submenu) {\n        return result || item.submenu.some(isDynamic);\n    }\n    return result;\n}\n","import {\n    eventLocation,\n    keyboardModifiersFromEvent,\n    KeyboardModifiers,\n    LongPressDetector,\n} from '../common/events';\nimport { UIElement } from '../common/ui-element';\nimport { MenuItemTemplate } from './menu-core';\nimport { MENU_TEMPLATE, MENU_STYLE } from './menu-templates';\nimport { RootMenu } from './root-menu';\n\n/**\n * This web component display a contextual menu when the user performs the\n * appropriate gesture (right-click, control+click, shift+F10, etc...),\n * handles the user interaction to navigate the items in the menu and submenus\n * and either invoke the `onSelect()` hook associated with the selected menu item\n * or dispatches a 'select' event when the user completes their selection.\n *\n * Place this element inside a container and the contextual menu will be\n * displayed when a right-click/control+click/long tap is performed in the\n * container or if the container is keyboard focused when shift+f10 is pressed.\n * In the former case, the menu is diplayed where the click/tap occured.\n * In the later case, the menu is displayed in the center of the parent container.\n *\n * This component is:\n * - screen-reader compatible\n * - keyboard navigable\n * - dark-theme aware\n * - responsive (the menu and submenus will attempt to avoid being displayed\n *   outside of the viewport boundary)\n *\n * Principles of Operation\n *\n * The content of a menu (menu items and submenus) is represented by a 'model',\n * an instance of the Menu class.\n * The model is created from:\n * - argument to the UIContextMenuElement constructor\n * - setting the `menuItems` property\n * - a `<script>` tag containing a JSON description of menu items\n * - a set of child `<ui-menu-item>` elements.\n *\n * A menu can also have a `<style>` tag, which is applied to style the menu\n * once it is open.\n *\n * The `<ui-context-menu>` and its child elements are kept hidden.\n *\n * When the menu is invoked (with `show()`) a scrim element is created\n * and added as a child of the `<ui-context-menu>`, and a new `<ul>` element\n * is created and attached as a child of the scrim.\n *\n * A set of `<li>` element is added as children of the `<ul>` element, one\n * for each visible menu item, whether this menu item was specified in\n * JSON or with a `<menu-item>` element. The `<li>` element are made of\n * the following components:\n * - a checkmark (optional)\n * - a text label (as a text node, if specified from JSON or as a cloned\n * `UIMenuItemElement` if specified from the `<ui-menu-item>`)\n * - a submenu indicator\n *\n */\nexport class UIContextMenuElement extends UIElement {\n    private rootMenu: RootMenu;\n    // The menu items specified via a constructor or setter\n    private templateMenuItems: MenuItemTemplate[];\n\n    private longPressDetector: LongPressDetector;\n\n    constructor(menuItems?: MenuItemTemplate[]) {\n        super({\n            template: MENU_TEMPLATE,\n            style: MENU_STYLE,\n        });\n        this.templateMenuItems = menuItems ?? [];\n    }\n\n    set menuItems(menuItems: MenuItemTemplate[]) {\n        this.templateMenuItems = menuItems;\n        if (this.rootMenu) {\n            this.rootMenu.menuItemTemplates = menuItems;\n        }\n    }\n    get menuItems(): MenuItemTemplate[] {\n        return this.templateMenuItems;\n    }\n\n    /**\n     * @internal\n     */\n    handleEvent(event: Event): void {\n        this.longPressDetector?.dispose();\n        this.longPressDetector = undefined;\n\n        if (event.type === 'contextmenu') {\n            const evt = event as MouseEvent;\n            this.show({\n                location: [Math.round(evt.clientX), Math.round(evt.clientY)],\n                keyboardModifiers: keyboardModifiersFromEvent(evt),\n            });\n            event.preventDefault();\n            event.stopPropagation();\n        } else if (event.type === 'keydown') {\n            const evt = event as KeyboardEvent;\n            if (\n                evt.code === 'ContextMenu' ||\n                (evt.code === 'F10' && evt.shiftKey)\n            ) {\n                // shift+F10 = contextual menu\n                // Get the center of the parent\n                const bounds = this.parentElement?.getBoundingClientRect();\n                if (bounds) {\n                    this.show({\n                        location: [\n                            Math.round(bounds.left + bounds.width / 2),\n                            Math.round(bounds.top + bounds.height / 2),\n                        ],\n                        keyboardModifiers: keyboardModifiersFromEvent(evt),\n                    });\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            }\n        } else if (event.type === 'pointerdown') {\n            if (event.target === this.shadowRoot.host.parentNode) {\n                const pt = eventLocation(event);\n                this.longPressDetector = new LongPressDetector(event, () => {\n                    this.show({\n                        location: pt,\n                        keyboardModifiers: keyboardModifiersFromEvent(event),\n                    });\n                });\n                event.preventDefault();\n                event.stopPropagation();\n            }\n        }\n    }\n    /**\n     * Custom elements lifecycle hooks\n     * @internal\n     */\n    connectedCallback(): void {\n        super.connectedCallback();\n        // Listen for contextual menu in the parent\n        const parent = this.parentNode;\n        parent.addEventListener('contextmenu', this);\n        parent.addEventListener('keydown', this);\n        parent.addEventListener('pointerdown', this);\n    }\n    /**\n     * Custom elements lifecycle hooks\n     * @internal\n     */\n    disconnectedCallback(): void {\n        super.disconnectedCallback();\n        const parent = this.parentNode;\n        if (parent) {\n            parent.removeEventListener('contextmenu', this);\n            parent.removeEventListener('keydown', this);\n            parent.removeEventListener('pointerdown', this);\n        }\n    }\n    /**\n     * @internal\n     */\n    focus(): void {\n        super.focus();\n        if (this.rootMenu?.state !== 'closed') {\n            if (this.rootMenu.activeMenuItem) {\n                this.rootMenu.activeMenuItem.element.focus();\n            } else {\n                this.rootMenu.element.focus();\n            }\n        }\n    }\n    /**\n     * Display the menu at the specified location.\n     * If provided, the `keyboardModifiers` option can change what commands\n     * are visible, enabled, or what their label is.\n     *\n     * The contextual menu is shown automatically when the appropriate UI gesture\n     * is performed by the user (right-click, shift+F10, etc...). This method\n     * only needs to be called to trigger the menu manually (for example to\n     * trigger it on click of an item).\n     */\n    show(options?: {\n        location?: [x: number, y: number];\n        keyboardModifiers?: KeyboardModifiers;\n    }): void {\n        if (!this.rootMenu) {\n            // Import inline (in the component) style sheet\n            this.importStyle();\n\n            // Inline menu items (as a JSON structure in a <script> tag\n            // in the markup)\n            let jsonMenuItems = this.json;\n            if (!Array.isArray(jsonMenuItems)) jsonMenuItems = [];\n            this.rootMenu = new RootMenu(\n                [...this.templateMenuItems, ...jsonMenuItems],\n                {\n                    host: this.shadowRoot.host,\n                    assignedElement: this.shadowRoot.querySelector<HTMLElement>(\n                        'ul'\n                    ),\n                }\n            );\n        }\n        this.style.display = 'block';\n        if (this.rootMenu.show({ ...options, parent: this.shadowRoot })) {\n            if (!this.hasAttribute('tabindex')) {\n                this.setAttribute('tabindex', '-1');\n            }\n            this.focus();\n        } else {\n            this.style.display = 'none';\n        }\n    }\n    /**\n     * Hide the menu.\n     *\n     * The visibility of the menu is typically controlled by the user\n     * interaction: the menu is automatically hidden if the user release the\n     * mouse button, or after having selected a command. This is a manual\n     * override that should be very rarely needed.\n     */\n    hide(): void {\n        this.rootMenu?.hide();\n        this.style.display = 'none';\n    }\n}\n\nexport default UIContextMenuElement;\n\ndeclare global {\n    /** @internal */\n    export interface Window {\n        UIContextMenuElement: typeof UIContextMenuElement;\n    }\n}\nif (!window.customElements.get('ui-context-menu')) {\n    window.UIContextMenuElement = UIContextMenuElement;\n    window.customElements.define('ui-context-menu', UIContextMenuElement);\n}\n","import { getEdge, getOppositeEdge, UIElement } from '../common/ui-element';\nimport {\n    keyboardModifiersFromEvent,\n    KeyboardModifiers,\n} from '../common/events';\nimport { MenuItemTemplate } from './menu-core';\nimport { RootMenu } from './root-menu';\nimport { MENU_TEMPLATE, MENU_STYLE } from './menu-templates';\n\nexport class UIPopupMenuElement extends UIElement {\n    private rootMenu: RootMenu;\n    private templateMenuItems: MenuItemTemplate[];\n    position: 'leading' | 'trailing' | 'left' | 'end';\n\n    constructor(menuItems?: MenuItemTemplate[]) {\n        super({\n            template: MENU_TEMPLATE,\n            style: MENU_STYLE,\n        });\n        this.templateMenuItems = menuItems ?? [];\n        this.reflectStringAttribute('position');\n    }\n\n    set menuItems(menuItems: MenuItemTemplate[]) {\n        this.templateMenuItems = menuItems;\n        if (this.rootMenu) {\n            this.rootMenu.menuItemTemplates = menuItems;\n        }\n    }\n    get menuItems(): MenuItemTemplate[] {\n        return this.templateMenuItems;\n    }\n\n    /**\n     * @internal\n     */\n    handleEvent(event: Event): void {\n        if (event.type === 'keydown' && event.target === this.parentElement) {\n            const evt = event as KeyboardEvent;\n            if (evt.code === 'Return' || evt.code === 'Enter') {\n                const bounds = this.parentElement?.getBoundingClientRect();\n                if (bounds) {\n                    this.show({\n                        keyboardModifiers: keyboardModifiersFromEvent(evt),\n                    });\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            }\n        } else if (event.type === 'pointerdown') {\n            console.assert(\n                this.shadowRoot.host.parentNode === this.parentElement\n            );\n            if (event.target === this.shadowRoot.host.parentNode) {\n                this.show({\n                    keyboardModifiers: keyboardModifiersFromEvent(event),\n                });\n                event.preventDefault();\n                event.stopPropagation();\n            }\n        }\n    }\n    /**\n     * Custom elements lifecycle hooks\n     * @internal\n     */\n    connectedCallback(): void {\n        super.connectedCallback();\n        // Listen for contextual menu in the parent\n        const parent = this.parentNode;\n        parent.addEventListener('keydown', this);\n        parent.addEventListener('pointerdown', this);\n    }\n    /**\n     * Custom elements lifecycle hooks\n     * @internal\n     */\n    disconnectedCallback(): void {\n        super.disconnectedCallback();\n        const parent = this.parentNode;\n        if (parent) {\n            parent.removeEventListener('keydown', this);\n            parent.removeEventListener('pointerdown', this);\n        }\n    }\n    /**\n     * @internal\n     */\n    focus(): void {\n        super.focus();\n        if (this.rootMenu?.state !== 'closed') {\n            if (this.rootMenu.activeMenuItem) {\n                this.rootMenu.activeMenuItem.element.focus();\n            } else {\n                this.rootMenu.element.focus();\n            }\n        }\n    }\n    /**\n     * Display the menu at the specified location.\n     * If provided, the `keyboardModifiers` option can change what commands\n     * are visible, enabled, or what their label is.\n     *\n     * The contextual menu is shown automatically when the appropriate UI gesture\n     * is performed by the user (right-click, shift+F10, etc...). This method\n     * only needs to be called to trigger the menu manually (for example to\n     * trigger it on click of an item).\n     */\n    show(options?: { keyboardModifiers?: KeyboardModifiers }): void {\n        if (!this.rootMenu) {\n            // Import inline (in the component) style sheet\n            this.importStyle();\n\n            // Inline menu items (as a JSON structure in a <script> tag\n            // in the markup)\n            let jsonMenuItems = this.json;\n            if (!Array.isArray(jsonMenuItems)) jsonMenuItems = [];\n            this.rootMenu = new RootMenu(\n                [...this.templateMenuItems, ...jsonMenuItems],\n                {\n                    host: this.shadowRoot.host,\n                    assignedElement: this.shadowRoot.querySelector<HTMLElement>(\n                        'ul'\n                    ),\n                }\n            );\n        }\n        this.style.display = 'inline-block';\n        const bounds = this.parentElement?.getBoundingClientRect();\n        if (\n            this.rootMenu.show({\n                ...options,\n                location: [\n                    getEdge(\n                        bounds,\n                        this.position ?? 'leading',\n                        this.computedDir\n                    ),\n                    bounds.bottom,\n                ],\n                alternateLocation: [\n                    getOppositeEdge(\n                        bounds,\n                        this.position ?? 'leading',\n                        this.computedDir\n                    ),\n                    bounds.bottom,\n                ],\n                parent: this.shadowRoot,\n            })\n        ) {\n            if (!this.hasAttribute('tabindex')) {\n                this.setAttribute('tabindex', '-1');\n            }\n            this.focus();\n        } else {\n            this.style.display = 'none';\n        }\n    }\n    /**\n     * Hide the menu.\n     *\n     * The visibility of the menu is typically controlled by the user\n     * interaction: the menu is automatically hidden if the user release the\n     * mouse button, or after having selected a command. This is a manual\n     * override that should be very rarely needed.\n     */\n    hide(): void {\n        this.rootMenu?.hide();\n        this.style.display = 'none';\n    }\n}\n\nexport default UIPopupMenuElement;\n\ndeclare global {\n    /** @internal */\n    export interface Window {\n        UIPopupMenuElement: typeof UIPopupMenuElement;\n    }\n}\n\nif (!window.customElements.get('ui-popup-menu')) {\n    window.UIPopupMenuElement = UIPopupMenuElement;\n    window.customElements.define('ui-popup-menu', UIPopupMenuElement);\n}\n","import { UIElement } from '../common/ui-element';\nimport { MENU_STYLE, MENU_TEMPLATE } from './menu-templates';\n\n/**\n * Use `<ui-submenu>` as a child of a `<ui-menuitem>`.\n *\n * This element is used as a \"template\" for a submenu when a\n * menu is displayed: it displays nothing by itself.\n *\n * It can include a `<style>` tag.\n */\nexport class UISubmenuElement extends UIElement {\n    constructor() {\n        super({\n            template: MENU_TEMPLATE,\n            style: MENU_STYLE,\n        });\n    }\n}\n\nexport default UISubmenuElement;\n\ndeclare global {\n    /** @internal */\n    export interface Window {\n        UISubmenuElement: typeof UISubmenuElement;\n    }\n}\nif (!window.customElements.get('ui-submenu')) {\n    window.UISubmenuElement = UISubmenuElement;\n    window.customElements.define('ui-submenu', UISubmenuElement);\n}\n"],"names":[],"mappings":"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"}