{"version":3,"file":"ui.js","sources":["../src/common/ui-element.ts","../src/menus/menu-item-element.ts","../src/menus/menu-core.ts","../src/menus/root-menu.ts","../src/menus/context-menu-element.ts"],"sourcesContent":["/**\n * @internal\n */\nexport class UIElement extends HTMLElement {\n    private _json: any;\n    private _style: string;\n\n    constructor(options?: {\n        template: string | HTMLTemplateElement;\n        style: string | HTMLTemplateElement;\n    }) {\n        super();\n\n        this.attachShadow({ mode: 'open' });\n\n        if (options?.template instanceof HTMLTemplateElement) {\n            this.shadowRoot.appendChild(\n                options.template.content.cloneNode(true)\n            );\n        } else if (typeof options?.template === 'string') {\n            this.shadowRoot.innerHTML = options.template;\n        }\n\n        if (options?.style instanceof HTMLTemplateElement) {\n            this.shadowRoot.appendChild(options.style.content.cloneNode(true));\n        } else if (typeof options?.style === 'string') {\n            const style = document.createElement('style');\n            style.textContent = options.style;\n            this.shadowRoot.append(style);\n        }\n\n        // If there is an embedded <style> tag in the slot\n        // \"import\" it in the shadow dom\n        if (this.importedStyle) {\n            const style = document.createElement('style');\n            style.textContent = this.importedStyle;\n            this.shadowRoot.append(style);\n        }\n    }\n\n    /**\n     * @internal\n     */\n    protected get json(): any {\n        if (typeof this._json === 'undefined') {\n            this._json = null;\n            const json = this.shadowRoot\n                .querySelector<HTMLSlotElement>('slot')\n                .assignedElements()\n                .filter(\n                    (x) =>\n                        x.tagName === 'SCRIPT' &&\n                        x['type'] === 'application/json'\n                )\n                .map((x) => x.textContent)\n                .join('');\n            if (json) {\n                try {\n                    this._json = JSON.parse(json);\n                } catch (e) {\n                    // There was an error parsing the JSON.\n                    // Display a helpful message.\n                    const msg = e.toString();\n                    const m = msg.match(/position ([0-9]+)/);\n                    if (m) {\n                        const index = parseInt(m[1]);\n                        const extract = json.substring(\n                            Math.max(index - 40, 0),\n                            index\n                        );\n                        throw new Error(msg + '\\n' + extract.trim());\n                    } else {\n                        throw e;\n                    }\n                }\n            }\n        }\n        return this._json;\n    }\n\n    /**\n     * @internal\n     */\n    protected get importedStyle(): any {\n        if (typeof this._style === 'undefined') {\n            this._style = this.shadowRoot\n                .querySelector<HTMLSlotElement>('slot')\n                .assignedElements()\n                .filter((x) => x.tagName === 'STYLE')\n                .map((x) => x.textContent)\n                .join('');\n        }\n        return this._style;\n    }\n}\n","const MENU_ITEM_TEMPLATE = document.createElement('template');\nMENU_ITEM_TEMPLATE.innerHTML = `<style>\n:host {\n    display: inline;\n    color-scheme: light dark;\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n    outline: none;\n    fill: currentColor;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    text-align: left;\n    color: var(--label-color);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    opacity:  .5;\n}\n:host[aria-disabled=true] {\n    opacity: .5;\n}\n:host(:focus), :host(:focus-within) {\n    outline: Highlight auto 1px;    /* For Firefox */\n    outline: -webkit-focus-ring-color auto 1px;\n}\n\n:host.indent {\n    margin-left: 12px;\n}\n\n:host[role=separator] {\n    border-bottom: 1px solid #c7c7c7;\n    border-radius: 0;\n    padding: 0;\n    margin-left: 15px;\n    margin-right: 15px;\n    padding-top: 5px;\n    margin-bottom: 5px;\n}\n\n:host([active]) {\n    background: var(--active-bg);\n    background: -apple-system-control-accent;\n    color: var(--active-label-color);\n}\n\n:host([active]).is-submenu-open {\n    background: var(--active-bg-dimmed);\n    color: inherit;\n}\n\n:host[aria-haspopup=true]>.label {\n     padding-right: 0;\n}\n\n:host[aria-haspopup=true].active::after {\n    color: white;\n}\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}\n</style>\n<slot></slot>`;\n\nexport class UIMenuItemElement extends HTMLElement {\n    static get observedAttributes(): string[] {\n        return ['disabled', 'checked', 'active', 'type'];\n    }\n\n    get checked(): boolean {\n        return this.hasAttribute('checked');\n    }\n\n    set checked(val: boolean) {\n        if (val) {\n            this.setAttribute('checked', '');\n        } else {\n            this.removeAttribute('checked');\n        }\n    }\n\n    get disabled(): boolean {\n        return this.hasAttribute('disabled');\n    }\n\n    set disabled(val: boolean) {\n        if (val) {\n            this.setAttribute('disabled', '');\n        } else {\n            this.removeAttribute('disabled');\n        }\n    }\n\n    get active(): boolean {\n        return this.hasAttribute('active');\n    }\n\n    set active(val: boolean) {\n        if (val) {\n            this.setAttribute('active', '');\n        } else {\n            this.removeAttribute('active');\n        }\n    }\n    get type(): string {\n        return this.hasAttribute('type') ? this.getAttribute('type') : 'normal';\n    }\n\n    set type(val: string) {\n        if (val) {\n            this.setAttribute('type', val);\n        } else {\n            this.removeAttribute('type');\n        }\n    }\n    constructor() {\n        super();\n\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.appendChild(MENU_ITEM_TEMPLATE.content.cloneNode(true));\n    }\n}\n\nexport default UIMenuItemElement;\n\ndeclare global {\n    /** @internal */\n    interface Window {\n        UIMenuItemElement: typeof UIMenuItemElement;\n    }\n}\n\nif (!window.customElements.get('ui-menu-item')) {\n    window.UIMenuItemElement = UIMenuItemElement;\n    window.customElements.define('ui-menu-item', UIMenuItemElement);\n}\n","import { UIMenuItemElement } from './menu-item-element';\nimport { RootMenu } from './root-menu';\n\nexport const MENU_TEMPLATE = document.createElement('template');\nMENU_TEMPLATE.innerHTML = `<ul></ul><slot></slot>`;\nexport const MENU_STYLE = document.createElement('template');\nMENU_STYLE.innerHTML = `<style>\n:host {\n    display: none;\n    color-scheme: light dark;\n    --active-label-color: #fff;\n    --label-color: #121212;\n    --menu-bg: #e2e2e2;\n    --active-bg: #5898ff;\n    --active-bg-dimmed: #c5c5c5;\n}\n:host([hidden]) {\n    display: none;\n}\n:host([disabled]) {\n    opacity:  .5;\n}\n:host(:focus), :host(:focus-within) {\n    outline: Highlight auto 1px;    /* For Firefox */\n    outline: -webkit-focus-ring-color auto 1px;\n}\n:host div.scrim {\n    position: fixed;\n    contain: content;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    outline: none;\n    background: transparent;\n}\n:host slot {\n    display: none;\n}\nul.menu-container {\n    position: absolute;\n    width: auto;\n    z-index: 10000;\n    border-radius: 8px;\n    background: var(--menu-bg);\n    box-shadow: 0 0 2px rgba(0, 0, 0, .5), 0 0 20px rgba(0, 0, 0, .2);\n\n    list-style: none;\n    padding: 6px 0 6px 0;\n    margin: 0;\n    cursor: initial;\n    user-select: none;\n\n    color: var(--label-color);\n    font-weight: normal;\n    font-style: normal;\n    text-shadow: none;\n    text-transform: none;\n    letter-spacing: 0;\n    outline: none;\n    opacity: 1;\n}\nul > li {\n    display: flex;\n    flex-flow: row;\n    align-items: center;\n    padding: 1px 7px 1px 7px;\n    margin-top: 0;\n    margin-left: 6px;\n    margin-right: 6px;\n    border-radius: 4px;\n    white-space: nowrap;\n    position: relative;\n    outline: none;\n    fill: currentColor;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    text-align: left;\n    color: inherit;\n\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: 0.007em;\n}\nul > li > .label {\n    appearance: none;\n    background: none;\n    outline: none;\n    width: 100%;\n    margin: 0;\n    padding: 1px 2px 1px 1px;\n    overflow: visible;\n    border: 1px solid transparent;\n    white-space: nowrap;\n}\nul > li > .label.indent {\n    margin-left: 12px;\n}\nul > li[role=separator] {\n    border-bottom: 1px solid #c7c7c7;\n    border-radius: 0;\n    padding: 0;\n    margin-left: 15px;\n    margin-right: 15px;\n    padding-top: 5px;\n    margin-bottom: 5px;\n}\nul > li[aria-disabled=true] {\n    opacity: .5;\n}\n\nul > li.active {\n    background: var(--active-bg);\n    background: -apple-system-control-accent;\n    color: var(--active-label-color);\n}\n\nul > li.active.is-submenu-open {\n    background: var(--active-bg-dimmed);\n    color: inherit;\n}\n\nul > li[aria-haspopup=true]>.label {\n     padding-right: 0;\n}\n\n.right-chevron {\n    margin-left: 24px;\n    width: 10px;\n    height: 10px;\n    padding-bottom: 4px;\n}\n.checkmark {\n    margin-right: -11px;\n    margin-left: -4px;\n    margin-top : 2px;\n    width: 16px;\n    height: 16px;\n}\n\nul > li[aria-haspopup=true].active::after {\n    color: white;\n}\n@media (prefers-color-scheme: dark) {\n    :host {\n        --label-color: #fff;\n        --active-label-color: #000;\n        --menu-bg: #525252;\n        --active-bg: #5898ff;\n        --active-bg-dimmed: #5c5c5;\n    }\n}\n</style>`;\n\nexport type KeyboardModifiers = {\n    alt: boolean;\n    control: boolean;\n    shift: boolean;\n    meta: boolean;\n};\n\nexport type MenuItemTemplate = {\n    onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n    type?: 'normal' | 'separator' | 'submenu' | 'checkbox' | 'radio';\n    className?: string;\n    label?:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string);\n    ariaLabel?:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string);\n    ariaDetails?:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string);\n    submenu: MenuItemTemplate[];\n\n    hidden?:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean);\n    disabled?:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean);\n    checked?:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean);\n\n    /** Caller defined id string. Passed to the `onSelect()` hook. */\n    id?: string;\n\n    /** Caller defined data block. Passed to the `onSelect()` hook.*/\n    data?: any;\n};\n\n/**\n * An instance of `Menu` is a collection of menu items, including submenus.\n */\nexport class Menu {\n    parentMenu: Menu;\n\n    protected _element: HTMLElement;\n    protected _menuItems: MenuItem[];\n    private _activeMenuItem: MenuItem;\n    isSubmenuOpen: boolean; // If true, _activeMenuItem.submenu_ is open\n\n    hasCheckbox: boolean; // If true, has at least one checkbox menu item\n    hasRadio: boolean; // If true, has at least one radio menu item\n\n    /*\n     * The menu items template are preserved so that the actual menu items\n     * can be recalculated, for example if the keyboard modifiers change.\n     * (when isDynamic is true)\n     */\n    private _menuItemsTemplate: MenuItemTemplate[] | undefined;\n\n    /**\n     * Optional, an HTML element to be used as the container for this menu.\n     * Used when this maps to a custom element with a <ul> in its template.\n     */\n    private _assignedContainer: HTMLElement;\n\n    constructor(\n        menuItems?: MenuItemTemplate[],\n        options?: {\n            parentMenu?: Menu;\n            assignedContainer?: HTMLElement;\n        }\n    ) {\n        this.parentMenu = options?.parentMenu ?? null;\n        this._assignedContainer = options?.assignedContainer;\n\n        this._menuItemsTemplate = menuItems;\n        this.isSubmenuOpen = false;\n    }\n\n    get rootMenu(): RootMenu {\n        return this.parentMenu?.rootMenu;\n    }\n\n    get host(): Element {\n        return this.rootMenu.host;\n    }\n\n    updateMenu(keyboardModifiers?: KeyboardModifiers): void {\n        // The state of the keyboard modifiers may have changed and the menu\n        // is dynamic: recalculate the menu\n\n        // Save the current menu\n        const elem = this._element;\n        let saveCurrentItem: number;\n        let clientX: string;\n        let clientY: string;\n        let parent: Node;\n        if (elem) {\n            // If there is a cached element for this menu,\n            // remove it (but save its state)\n            saveCurrentItem = this._menuItems.indexOf(this.activeMenuItem);\n            parent = elem.parentNode;\n            clientX = elem.style.left;\n            clientY = elem.style.top;\n            parent?.removeChild(elem);\n            this._element = null;\n        }\n\n        this._menuItems = [];\n        this.hasCheckbox = false;\n        this.hasRadio = false;\n        if (!this._menuItemsTemplate) return;\n        this._menuItemsTemplate.forEach((x) =>\n            this.appendMenuItem(x, keyboardModifiers)\n        );\n\n        // Add menu-item-elements\n        if (this.host?.shadowRoot) {\n            const itemElements = this.host.shadowRoot\n                .querySelector<HTMLSlotElement>('slot')\n                .assignedElements()\n                .filter<UIMenuItemElement>(\n                    (x): x is UIMenuItemElement => x.tagName === 'UI-MENU-ITEM'\n                );\n            Array.from(itemElements).forEach((x) =>\n                this.appendMenuItem(x, keyboardModifiers)\n            );\n        }\n\n        this.hasCheckbox = this._menuItems.some((x) => x.type === 'checkbox');\n        this.hasRadio = this._menuItems.some((x) => x.type === 'radio');\n\n        if (elem) {\n            // If there was a previous version of the menu,\n            // restore it and its state\n            parent?.appendChild(this.element);\n\n            this.element.style.position = 'absolute';\n            this.element.style.top = clientY;\n            this.element.style.left = clientX;\n\n            this.activeMenuItem = this.menuItems[saveCurrentItem];\n            if (this.activeMenuItem?.submenu) {\n                this.activeMenuItem.openSubmenu(keyboardModifiers);\n            }\n        }\n    }\n\n    get menuItems(): MenuItem[] {\n        return this._menuItems;\n    }\n\n    /** First activable menu item */\n    get firstMenuItem(): MenuItem {\n        let result = 0;\n        let found = false;\n        const menuItems = this.menuItems;\n        while (!found && result <= menuItems.length - 1) {\n            const item = menuItems[result];\n            found = item.type !== 'separator' && !item.hidden && !item.disabled;\n            result += 1;\n        }\n\n        return !found ? null : menuItems[result - 1];\n    }\n    /** Last activable menu item */\n    get lastMenuItem(): MenuItem {\n        let result = this.menuItems.length - 1;\n        let found = false;\n        while (!found && result >= 0) {\n            const item = this.menuItems[result];\n            found = item.type !== 'separator' && !item.hidden && !item.disabled;\n            result -= 1;\n        }\n\n        return !found ? null : this.menuItems[result + 1];\n    }\n    /**\n     * The active menu is displayed on a colored background.\n     */\n    get activeMenuItem(): MenuItem {\n        return this._activeMenuItem;\n    }\n\n    /**\n     * Set to undefined to have no active item.\n     * Note that setting the active menu item doesn't automatically\n     * open the submenu (e.g. when keyboard navigating).\n     * Call `item.submenu.openSubmenu()` to open the submenu.\n     */\n    set activeMenuItem(value: MenuItem) {\n        this.parentMenu?.rootMenu.cancelDelayedOperation();\n        if (value !== this._activeMenuItem) {\n            // Remove previously active element\n            if (this.activeMenuItem) {\n                const item = this.activeMenuItem;\n                item.active = false;\n                // If there is a submenu, hide it\n                item.submenu?.hide();\n            }\n\n            if (value?.hidden) {\n                this._activeMenuItem = undefined;\n                return;\n            }\n\n            this._activeMenuItem = value;\n\n            // Make new element active\n            if (value) value.active = true;\n        }\n        if (value) {\n            value.element.focus();\n        } else {\n            this._element?.focus();\n        }\n\n        // Update secondary state of parent\n        this.parentMenu?.activeMenuItem?.element.classList.toggle(\n            'is-submenu-open',\n            !!value\n        );\n    }\n\n    nextMenuItem(dir: number): MenuItem {\n        if (!this._activeMenuItem && dir > 0) return this.firstMenuItem;\n        if (!this._activeMenuItem && dir < 0) return this.lastMenuItem;\n        const first = this._menuItems.indexOf(this.firstMenuItem);\n        const last = this._menuItems.indexOf(this.lastMenuItem);\n        let found = false;\n        let result = this._menuItems.indexOf(this._activeMenuItem) + dir;\n        while (!found && result >= first && result <= last) {\n            const item = this._menuItems[result];\n            found = item.type !== 'separator' && !item.hidden && !item.disabled;\n            result += dir;\n        }\n        return found\n            ? this._menuItems[result - dir]\n            : dir > 0\n            ? this.lastMenuItem\n            : this.firstMenuItem;\n    }\n\n    static _collator: Intl.Collator;\n\n    static get collator(): Intl.Collator {\n        if (Menu._collator) return Menu._collator;\n        Menu._collator = new Intl.Collator(undefined, {\n            usage: 'search',\n            sensitivity: 'base',\n        });\n        return Menu._collator;\n    }\n    findMenuItem(text: string): MenuItem {\n        const candidates = this._menuItems.filter(\n            (x) => x.type !== 'separator' && !x.hidden && !x.disabled\n        );\n        if (candidates.length === 0) return null;\n        const last =\n            Math.max(...candidates.map((x) => x.label.length)) - text.length;\n\n        if (last < 0) return null;\n\n        // Find a \"contain\" match\n        let result: MenuItem;\n        let i = 0;\n        while (i < last && !result) {\n            result = candidates.find(\n                (x) =>\n                    Menu.collator.compare(\n                        text,\n                        x.label.substr(i, text.length)\n                    ) === 0\n            );\n            i++;\n        }\n        return result;\n    }\n\n    get element(): HTMLElement {\n        if (this._element) return this._element;\n\n        const ul = this._assignedContainer ?? document.createElement('ul');\n        ul.classList.add('menu-container');\n        ul.setAttribute('part', 'menu-container');\n        ul.setAttribute('tabindex', '-1');\n        ul.setAttribute('role', 'menu');\n        ul.setAttribute('aria-orientation', 'vertical');\n\n        // Remove all items\n        ul.textContent = '';\n\n        // Add back all necessary items (after they've been updated if applicable)\n        this._menuItems.forEach((x) => {\n            const elem = x.element;\n            if (elem) ul.appendChild(elem);\n        });\n        ul.querySelector('li:first-of-type')?.setAttribute('tabindex', '0');\n\n        this._element = ul;\n        return this._element;\n    }\n\n    /**\n     * @param parent: where the menu should be attached\n     * @return false if no menu to show\n     */\n    show(options?: {\n        parent: Node;\n        clientX?: number;\n        clientY?: number;\n        keyboardModifiers?: KeyboardModifiers;\n    }): boolean {\n        this.updateMenu(options?.keyboardModifiers);\n        if (this.menuItems.filter((x) => !x.hidden).length === 0) return false;\n\n        options?.parent?.appendChild(this.element);\n\n        if (isFinite(options?.clientY) && isFinite(options?.clientY)) {\n            this.element.style.position = 'absolute';\n            this.element.style.top = Number(options.clientY).toString() + 'px';\n            this.element.style.left = Number(options.clientX).toString() + 'px';\n        }\n\n        this.element.focus();\n\n        // Notify our parent we have opened\n        // (so the parent can close any other open submenu and/or\n        // change its state to display the active state correctly)\n        if (this.parentMenu) {\n            this.parentMenu.openSubmenu = this;\n        }\n\n        return true;\n    }\n\n    hide(): void {\n        // Hide any of our child submenus\n        this.openSubmenu = null;\n\n        this.activeMenuItem = undefined;\n\n        // Notify our parent\n        if (this.parentMenu) {\n            this.parentMenu.openSubmenu = null;\n        }\n\n        this._element?.parentNode?.removeChild(this._element);\n        this._element = null;\n    }\n\n    /**\n     * This method is called to record that one of our submenus has opened.\n     * To open a submenu call openSubmenu() on the item with the submenu\n     * or show() on the submenu.\n     */\n    set openSubmenu(submenu: Menu) {\n        const expanded = submenu !== null;\n        // We're closing a submenu\n        if (this.activeMenuItem?.type === 'submenu') {\n            this.activeMenuItem.element?.setAttribute(\n                'aria-expanded',\n                expanded.toString()\n            );\n        }\n        this.isSubmenuOpen = expanded;\n    }\n\n    appendMenuItem(\n        menuItem: MenuItemTemplate | UIMenuItemElement,\n        keyboardModifiers: KeyboardModifiers\n    ): void {\n        this.insertMenuItem(-1, menuItem, keyboardModifiers);\n    }\n\n    insertMenuItem(\n        pos: number,\n        menuItem: MenuItemTemplate | UIMenuItemElement,\n        keyboardModifiers: KeyboardModifiers\n    ): void {\n        if (pos < 0) pos = Math.max(0, this._menuItems.length - 1);\n\n        let item: MenuItem;\n        if (menuItem instanceof UIMenuItemElement) {\n            item = new MenuItemFromElement(menuItem, this);\n        } else {\n            item = new MenuItemFromTemplate(menuItem, this, {\n                keyboardModifiers: keyboardModifiers,\n            });\n        }\n\n        this._menuItems.splice(pos + 1, 0, item);\n    }\n}\n\n//\n//\n//\n\nconst PRINTABLE_KEYCODE = [\n    'Backquote', // Japanese keyboard: hankaku/zenkaku/kanji key, which is non-printable\n    'Digit0',\n    'Digit1',\n    'Digit2',\n    'Digit3',\n    'Digit4',\n    'Digit5',\n    'Digit6',\n    'Digit7',\n    'Digit8',\n    'Digit9',\n    'Minus',\n    'Equal',\n    'IntlYen', // Japanese Keyboard. Russian keyboard: \\/\n\n    'KeyQ', // AZERTY keyboard: labeled 'a'\n    'KeyW', // AZERTY keyboard: labeled 'z'\n    'KeyE',\n    'KeyR',\n    'KeyT',\n    'KeyY', // QWERTZ keyboard: labeled 'z'\n    'KeyU',\n    'KeyI',\n    'KeyO',\n    'KeyP',\n    'BracketLeft',\n    'BracketRight',\n    'Backslash', // May be labeled #~ on UK 102 keyboard\n    'KeyA', // AZERTY keyboard: labeled 'q'\n    'KeyS',\n    'KeyD',\n    'KeyF',\n    'KeyG',\n    'KeyH',\n    'KeyJ',\n    'KeyK',\n    'KeyL',\n    'Semicolon',\n    'Quote',\n    'IntlBackslash', // QWERTZ keyboard '><'\n    'KeyZ', // AZERTY: 'w', QWERTZ: 'y'\n    'KeyX',\n    'KeyC',\n    'KeyV',\n    'KeyB',\n    'KeyN',\n    'KeyM',\n    'Comma',\n    'Period',\n    'Slash',\n    'IntlRo', // Japanse keyboard '\\ã‚'\n\n    'Space',\n\n    'Numpad0',\n    'Numpad1',\n    'Numpad2',\n    'Numpad3',\n    'Numpad4',\n    'Numpad5',\n    'Numpad6',\n    'Numpad7',\n    'Numpad8',\n    'Numpad9',\n    'NumpadAdd',\n    'NumpadComma',\n    'NumpadDecimal',\n    'NumpadDivide',\n    'NumpadEqual',\n    'NumpadHash',\n    'NumpadMultiply',\n    'NumpadParenLeft',\n    'NumpadParenRight',\n    'NumpadStar',\n    'NumpadSubstract',\n];\n\nexport function keyboardModifiersFromEvent(\n    ev: MouseEvent | KeyboardEvent\n): KeyboardModifiers {\n    const result = {\n        alt: false,\n        control: false,\n        shift: false,\n        meta: false,\n    };\n    if (ev.altKey) result.alt = true;\n    if (ev.ctrlKey) result.control = true;\n    if (ev.metaKey) result.meta = true;\n    if (ev.shiftKey) result.shift = true;\n    return result;\n}\n\nexport function distance(dx: number, dy: number): number {\n    return Math.sqrt(dx * dx + dy * dy);\n}\n\nexport function evalToBoolean(\n    item: MenuItemTemplate,\n    value:\n        | boolean\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => boolean),\n    keyboardModifiers?: KeyboardModifiers\n): boolean {\n    if (typeof value === 'boolean') return value;\n    if (typeof value === 'function') {\n        return value(item, keyboardModifiers);\n    }\n    return undefined;\n}\n\nexport function evalToString(\n    item: MenuItemTemplate,\n    value:\n        | string\n        | ((\n              item: MenuItemTemplate,\n              keyboardModifiers?: KeyboardModifiers\n          ) => string),\n    options: {\n        keyboardModifiers?: KeyboardModifiers;\n    }\n): string {\n    if (typeof value === 'string') {\n        return value;\n    } else if (typeof value === 'function') {\n        return value(item, options.keyboardModifiers);\n    }\n    return undefined;\n}\n\nexport function equalKeyboardModifiers(\n    a: KeyboardModifiers,\n    b: KeyboardModifiers\n): boolean {\n    if ((!a && b) || (a && !b)) return false;\n    return (\n        a.alt === b.alt &&\n        a.control === b.control &&\n        a.shift === b.shift &&\n        a.meta === b.meta\n    );\n}\n\nexport function mightProducePrintableCharacter(evt: KeyboardEvent): boolean {\n    if (evt.ctrlKey || evt.metaKey) {\n        // ignore ctrl/cmd-combination but not shift/alt-combinations\n        return false;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\n    if (evt.key === 'Dead') return false;\n\n    // When issued via a composition, the `code` field is empty\n    if (evt.code === '') return true;\n\n    return PRINTABLE_KEYCODE.indexOf(evt.code) >= 0;\n}\n\nconst CHEVRON_RIGHT_TEMPLATE = document.createElement('template');\nCHEVRON_RIGHT_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"right-chevron\"><svg focusable=\"false\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><path fill=\"currentColor\" d=\"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z\"></path></svg></span>`;\n\nconst CHECKMARK_TEMPLATE = document.createElement('template');\nCHECKMARK_TEMPLATE.innerHTML = `<span aria-hidden=\"true\" class=\"checkmark\"><svg  xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M435.848 83.466L172.804 346.51l-96.652-96.652c-4.686-4.686-12.284-4.686-16.971 0l-28.284 28.284c-4.686 4.686-4.686 12.284 0 16.971l133.421 133.421c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-28.284-28.284c-4.686-4.686-12.284-4.686-16.97 0z\"></path></svg>\n</span>`;\n\nexport type MenuSelectEvent = {\n    keyboardModifiers?: KeyboardModifiers;\n    id?: string;\n    label?: string;\n    data?: any;\n    element?: HTMLElement;\n};\n\ndeclare global {\n    /**\n     * Map the custom event names to types\n     * @internal\n     */\n    interface DocumentEventMap {\n        ['select']: CustomEvent<MenuSelectEvent>;\n    }\n}\n\n/**\n * Base class to represent a menu item.\n * There are two subclasses:\n * - MenuItemFromTemplate for menu items created from a JSON template\n * - MenuItemFromElement for menu items created for a UIMenuItemElement\n */\nexport abstract class MenuItem {\n    parentMenu: Menu;\n    submenu?: Menu;\n\n    constructor(parentMenu: Menu) {\n        this.parentMenu = parentMenu;\n    }\n\n    handleEvent(event: Event): void {\n        if (event.type === 'mouseenter') {\n            const ev = event as MouseEvent;\n            this.parentMenu.rootMenu.cancelDelayedOperation();\n            // If there is a submenu open, and the mouse is moving in the\n            // triangle formed from the current mouse location and the two\n            // adjacent corners of the open menu, schedule setting the new\n            // active menuitem to later\n            if (\n                this.parentMenu.isSubmenuOpen &&\n                this.parentMenu.activeMenuItem?.movingTowardSubmenu(ev)\n            ) {\n                this.parentMenu.rootMenu.scheduleOperation(() => {\n                    this.parentMenu.activeMenuItem = this;\n                    if (this.submenu) {\n                        this.openSubmenu(keyboardModifiersFromEvent(ev));\n                    }\n                });\n            } else {\n                this.parentMenu.activeMenuItem = this;\n                if (this.submenu) {\n                    this.openSubmenu(keyboardModifiersFromEvent(ev), {\n                        withDelay: true,\n                    });\n                }\n            }\n        } else if (event.type === 'mouseleave') {\n            if (this.parentMenu.rootMenu.activeMenu === this.parentMenu) {\n                this.parentMenu.activeMenuItem = null;\n            }\n        } else if (event.type === 'mouseup') {\n            const ev = event as MouseEvent;\n            // when modal, the items are activated on click,\n            // so ignore mouseup\n            if (this.parentMenu.rootMenu.state !== 'modal') {\n                this.select(keyboardModifiersFromEvent(ev));\n            }\n            ev.stopPropagation();\n            ev.preventDefault();\n        }\n    }\n\n    abstract get type():\n        | 'normal'\n        | 'separator'\n        | 'submenu'\n        | 'checkbox'\n        | 'radio';\n\n    abstract get active(): boolean;\n    abstract get hidden(): boolean;\n    abstract get disabled(): boolean;\n    abstract get label(): string;\n    abstract set active(val: boolean);\n\n    // Notify the owner that a menu item has been selected\n    abstract dispatchSelect(kbd?: KeyboardModifiers): void;\n\n    abstract get element(): HTMLElement;\n\n    get host(): Element {\n        return this.parentMenu.host;\n    }\n\n    /**\n     * Called when a menu item is selected:\n     * - either dismiss the menu and execute the command\n     * - or display the submenu\n     */\n    select(kbd?: KeyboardModifiers): void {\n        this.parentMenu.rootMenu.cancelDelayedOperation();\n\n        if (this.submenu) {\n            this.openSubmenu(kbd);\n            return;\n        }\n\n        // Make the item blink, then execute the command\n        setTimeout(() => {\n            this.active = false;\n            setTimeout(() => {\n                this.active = true;\n                setTimeout(() => {\n                    this.parentMenu.rootMenu.hide();\n                    setTimeout(() => this.dispatchSelect(kbd), 120);\n                }, 120);\n            }, 120);\n        }, 120);\n    }\n\n    /**\n     * Open the submenu of this menu item, with a delay if options.delay\n     * This delay improves targeting of submenus with the mouse.\n     */\n    openSubmenu(\n        kbd: KeyboardModifiers,\n        options?: { withDelay: boolean }\n    ): void {\n        if (options?.withDelay ?? false) {\n            this.parentMenu.rootMenu.scheduleOperation(() =>\n                this.openSubmenu(kbd)\n            );\n            return;\n        }\n        const maxWidth = window.document.documentElement.clientWidth;\n        const maxHeight = window.document.documentElement.clientHeight;\n        const bounds = this.element.getBoundingClientRect();\n\n        // Update the items of the submenu so we can lay it out and measure it\n        this.submenu.updateMenu(kbd);\n        this.element.appendChild(this.submenu.element);\n        const submenuBounds = this.submenu.element.getBoundingClientRect();\n        this.element.removeChild(this.submenu.element);\n\n        let clientX = bounds.width;\n        let clientY = -4;\n        if (bounds.right + submenuBounds.width > maxWidth) {\n            // Need to adjust horizontally\n            clientX = -submenuBounds.width;\n        }\n        if (bounds.top - 4 + submenuBounds.height > maxHeight) {\n            // Need to adjust vertically\n            clientY = -4 - (submenuBounds.height - (maxHeight - bounds.top));\n        }\n        this.submenu.show({\n            clientX,\n            clientY,\n            parent: this.element,\n            keyboardModifiers: kbd,\n        });\n    }\n\n    movingTowardSubmenu(ev: MouseEvent): boolean {\n        const lastEv = this.parentMenu.rootMenu.lastMouseEvent;\n        if (!lastEv) return false;\n\n        const deltaT = ev.timeStamp - lastEv.timeStamp;\n        if (deltaT > 500) return false;\n\n        const deltaX = ev.clientX - lastEv.clientX;\n\n        // Moving too slow?\n        const s = speed(deltaX, lastEv.clientY - ev.clientY, deltaT);\n        if (s <= 0.2) return false;\n\n        // Moving horizontally towards the submenu?\n        let position: 'left' | 'right' = 'right';\n        if (this.submenu.element) {\n            const submenuBounds = this.submenu.element.getBoundingClientRect();\n\n            const bounds = this.element.getBoundingClientRect();\n            if (submenuBounds.left < bounds.left + bounds.width / 2) {\n                position = 'left';\n            }\n        }\n\n        return position === 'right' ? deltaX > 0 : deltaX < 0;\n    }\n}\n\nexport class MenuItemFromTemplate extends MenuItem {\n    _type: 'normal' | 'separator' | 'submenu' | 'checkbox' | 'radio';\n    _label?: string;\n    _disabled: boolean;\n    _hidden: boolean;\n\n    className?: string;\n    ariaLabel?: string;\n    ariaDetails?: string;\n    checked?: boolean;\n    onSelect?: (ev: CustomEvent<MenuSelectEvent>) => void;\n    submenu?: Menu;\n    id?: string;\n    data?: any;\n\n    _element: HTMLElement;\n\n    constructor(\n        template: MenuItemTemplate,\n        parentMenu: Menu,\n        options?: {\n            keyboardModifiers?: KeyboardModifiers;\n        }\n    ) {\n        super(parentMenu);\n        this.parentMenu = parentMenu;\n\n        this._hidden =\n            evalToBoolean(\n                template,\n                template.hidden,\n                options?.keyboardModifiers\n            ) ?? false;\n        this._disabled =\n            evalToBoolean(\n                template,\n                template.disabled,\n                options?.keyboardModifiers\n            ) ?? false;\n        this.checked =\n            evalToBoolean(\n                template,\n                template.checked,\n                options?.keyboardModifiers\n            ) ?? false;\n\n        this.id = template.id;\n        this.className = template.className;\n        this._label = evalToString(template, template.label, options);\n        this.ariaLabel = evalToString(template, template.ariaLabel, options);\n        this.ariaDetails = evalToString(\n            template,\n            template.ariaDetails,\n            options\n        );\n        if (typeof template.onSelect) {\n            this.onSelect = template.onSelect;\n        }\n        this.data = template.data;\n\n        if (Array.isArray(template.submenu)) {\n            this._type = 'submenu';\n            this.submenu = new Menu(template.submenu, {\n                parentMenu,\n            });\n        } else {\n            if (\n                typeof template.type === 'undefined' &&\n                typeof template.checked !== 'undefined'\n            ) {\n                this._type = 'checkbox';\n            } else {\n                this._type = template.type ?? 'normal';\n            }\n        }\n    }\n\n    get type() {\n        return this._type;\n    }\n    get label(): string {\n        return this._label ?? this.ariaLabel;\n    }\n    get hidden(): boolean {\n        return this._hidden;\n    }\n    get disabled(): boolean {\n        return this._disabled;\n    }\n\n    private render(): HTMLElement | null {\n        if (this.hidden) return null;\n\n        if (this.type === 'separator') {\n            const li = document.createElement('li');\n            li.setAttribute('part', 'menu-separator');\n            li.setAttribute('role', 'separator');\n            return li;\n        }\n\n        if (\n            this.type !== 'normal' &&\n            this.type !== 'submenu' &&\n            this.type !== 'radio' &&\n            this.type !== 'checkbox'\n        ) {\n            return null;\n        }\n        const li = document.createElement('li');\n        li.setAttribute('part', 'menu-item');\n        if (this.className) {\n            li.className = this.className;\n        }\n        li.setAttribute('tabindex', '-1');\n        if (this.type === 'radio') {\n            li.setAttribute('role', 'menuitemradio');\n        } else if (this.type === 'checkbox') {\n            li.setAttribute('role', 'menuitemcheckbox');\n        } else {\n            li.setAttribute('role', 'menuitem');\n        }\n        if (this.checked) {\n            li.setAttribute('aria-checked', 'true');\n            li.appendChild(CHECKMARK_TEMPLATE.content.cloneNode(true));\n        }\n        if (this.type === 'submenu') {\n            li.setAttribute('aria-haspopup', 'true');\n            li.setAttribute('aria-expanded', 'false');\n        }\n        if (this.ariaLabel) li.setAttribute('aria-label', this.ariaLabel);\n        if (this.ariaDetails) li.setAttribute('aria-label', this.ariaDetails);\n\n        if (this.disabled) {\n            li.setAttribute('aria-disabled', 'true');\n        } else {\n            li.removeAttribute('aria-disabled');\n            li.addEventListener('mouseenter', this);\n            li.addEventListener('mouseleave', this);\n            li.addEventListener('mouseup', this);\n        }\n\n        const span = document.createElement('span');\n        span.innerHTML = this.label;\n        span.className =\n            this.parentMenu.hasCheckbox || this.parentMenu.hasRadio\n                ? 'label indent'\n                : 'label';\n        if (!this.disabled) {\n            span.addEventListener('click', (ev: MouseEvent) =>\n                this.select(keyboardModifiersFromEvent(ev))\n            );\n        }\n        li.appendChild(span);\n        if (this.submenu) {\n            li.appendChild(CHEVRON_RIGHT_TEMPLATE.content.cloneNode(true));\n        }\n        return li;\n    }\n\n    get active(): boolean {\n        return this.element.classList.contains('active');\n    }\n\n    set active(val: boolean) {\n        if (val) {\n            this.element.classList.add('active');\n        } else {\n            this.element.classList.remove('active');\n        }\n    }\n\n    get element(): HTMLElement {\n        if (this._element) return this._element;\n        this._element = this.render();\n        return this._element;\n    }\n\n    dispatchSelect(kbd?: KeyboardModifiers): void {\n        const ev = new CustomEvent<MenuSelectEvent>('select', {\n            detail: {\n                keyboardModifiers: kbd,\n                id: this.id,\n                label: this.label,\n                data: this.data,\n            },\n        });\n        if (typeof this.onSelect === 'function') {\n            this.onSelect(ev);\n        } else {\n            this.host.dispatchEvent(ev);\n        }\n    }\n}\n\nexport class MenuItemFromElement extends MenuItem {\n    // The <ui-menu-item> in the <slot> serves as the 'template' for this\n    // menu item\n    _sourceElement: HTMLElement;\n    // The source element is cloned and inserted in a <li>\n    _sourceElementClone: HTMLElement;\n    // The <li> is cached\n    _cachedElement: HTMLElement;\n\n    constructor(element: HTMLElement, parentMenu: Menu) {\n        super(parentMenu);\n        this.parentMenu = parentMenu;\n        this._sourceElement = element;\n    }\n\n    get type(): 'normal' | 'separator' | 'submenu' | 'checkbox' | 'radio' {\n        if (this.separator) return 'separator';\n        // @todo: submenu, radio, checkbox\n        return 'normal';\n    }\n    get label(): string {\n        return this._sourceElement.innerHTML;\n    }\n    get hidden(): boolean {\n        return this._sourceElement.hasAttribute('hidden');\n    }\n    set hidden(value: boolean) {\n        if (value) {\n            this._sourceElement.setAttribute('hidden', '');\n        } else {\n            this._sourceElement.removeAttribute('hidden');\n        }\n    }\n    get disabled(): boolean {\n        return this._sourceElement.hasAttribute('disabled');\n    }\n    set disabled(value: boolean) {\n        if (value) {\n            this._sourceElement.setAttribute('disabled', '');\n        } else {\n            this._sourceElement.removeAttribute('disabled');\n        }\n    }\n    get checked(): boolean {\n        return this._sourceElement.hasAttribute('checked');\n    }\n    set checked(value: boolean) {\n        if (value) {\n            this._sourceElement.setAttribute('checked', '');\n        } else {\n            this._sourceElement.removeAttribute('checked');\n        }\n    }\n    get separator(): boolean {\n        return this._sourceElement.hasAttribute('separator');\n    }\n    set separator(value: boolean) {\n        if (value) {\n            this._sourceElement.setAttribute('separator', '');\n        } else {\n            this._sourceElement.removeAttribute('separator');\n        }\n    }\n    get active(): boolean {\n        return this._cachedElement?.classList.contains('active') ?? false;\n    }\n\n    set active(val: boolean) {\n        // For the active attribute, set the value on the sourced element\n        // (the <ui-menu-item>)\n        if (val) {\n            this._cachedElement?.classList.add('active');\n            this._sourceElementClone.setAttribute('active', '');\n        } else {\n            this._cachedElement?.classList.remove('active');\n            this._sourceElementClone.removeAttribute('active');\n        }\n    }\n\n    private render(): HTMLElement | null {\n        if (this.hidden) return null;\n\n        if (this.separator) {\n            const li = document.createElement('li');\n            li.setAttribute('part', 'menu-separator');\n            li.setAttribute('role', 'separator');\n            return li;\n        }\n\n        const li = document.createElement('li');\n        li.setAttribute('part', 'menu-item');\n        li.setAttribute('tabindex', '-1');\n        if (this.type === 'radio') {\n            li.setAttribute('role', 'menuitemradio');\n        } else if (this.type === 'checkbox') {\n            li.setAttribute('role', 'menuitemcheckbox');\n        } else {\n            li.setAttribute('role', 'menuitem');\n        }\n        if (this.checked) {\n            li.setAttribute('aria-checked', 'true');\n            li.appendChild(CHECKMARK_TEMPLATE.content.cloneNode(true));\n        }\n        if (this.type === 'submenu') {\n            li.setAttribute('aria-haspopup', 'true');\n            li.setAttribute('aria-expanded', 'false');\n        }\n\n        if (this.disabled) {\n            li.setAttribute('aria-disabled', 'true');\n        } else {\n            li.removeAttribute('aria-disabled');\n            li.addEventListener('mouseenter', this);\n            li.addEventListener('mouseleave', this);\n            li.addEventListener('mouseup', this);\n        }\n\n        if (!this.disabled) {\n            li.addEventListener('click', (ev: MouseEvent) =>\n                this.select(keyboardModifiersFromEvent(ev))\n            );\n        }\n        this._sourceElementClone = this._sourceElement.cloneNode(\n            true\n        ) as HTMLElement;\n        li.appendChild(this._sourceElementClone);\n\n        return li;\n    }\n\n    get element(): HTMLElement {\n        if (this._cachedElement) return this._cachedElement;\n        this._cachedElement = this.render();\n        return this._cachedElement;\n    }\n\n    dispatchSelect(kbd?: KeyboardModifiers): void {\n        const ev = new CustomEvent<MenuSelectEvent>('select', {\n            detail: {\n                keyboardModifiers: kbd,\n                id: this._sourceElement.getAttribute('id'),\n                label: this.label,\n                element: this._sourceElement,\n            },\n        });\n        if (typeof this._sourceElement.onselect === 'function') {\n            this._sourceElement.onselect(ev);\n        } else {\n            this.host.dispatchEvent(ev);\n        }\n    }\n}\n\nfunction speed(dx: number, dy: number, dt: number): number {\n    return Math.sqrt(dx * dx + dy * dy) / dt;\n}\n","import {\n    Menu,\n    MenuItemTemplate,\n    KeyboardModifiers,\n    equalKeyboardModifiers,\n    keyboardModifiersFromEvent,\n    mightProducePrintableCharacter,\n} from './menu-core';\n\nexport class RootMenu extends Menu {\n    lastMouseEvent: MouseEvent;\n\n    private typingBufferResetTimer: number;\n    private typingBuffer: string;\n    private _scrim: HTMLElement;\n    private _openTimestamp: number;\n    private previousActiveElement: HTMLOrSVGElement;\n    private currentKeyboardModifiers: KeyboardModifiers;\n    private hysteresisTimer: number;\n    /**\n     * The host is used to dispatch events from\n     */\n    private _host: Element;\n    /**\n     * - 'closed': the menu is not visible\n     * - 'open': the menu is visible as long as the mouse button is pressed\n     * - 'modal': the menu is visible until dismissed, even with the mouse button\n     * released\n     */\n    state: 'closed' | 'open' | 'modal';\n\n    /** If true, the state of some of the menu items in this menu are\n     * provide by a function and may need to be updated dynamically\n     */\n    isDynamic: boolean;\n\n    /**\n     * If an `options.element` is provided, the root menu is\n     * attached to that element (the element will be modified\n     * to display the menu). Use this when using a popup menu.\n     * In this mode, call `show()` and `hide()` to control the\n     * display of the menu.\n     *\n     * Otherwise, if `options.element` is undefined, use `.element` to get\n     * back an element representing the menu, and attach this element where\n     * appropriate. Use this when displaying the menu inline.\n     */\n    constructor(\n        menuItems?: MenuItemTemplate[],\n        options?: {\n            root?: Node;\n            host?: Element;\n            keyboardModifiers?: KeyboardModifiers;\n            assignedElement?: HTMLElement;\n        }\n    ) {\n        super(menuItems, { assignedContainer: options?.assignedElement });\n        this.isDynamic = menuItems.some(isDynamic);\n        this.currentKeyboardModifiers = options?.keyboardModifiers;\n        this.typingBuffer = '';\n        this.state = 'closed';\n\n        this._host = options?.host;\n    }\n\n    get host(): Element {\n        return this._host;\n    }\n\n    /**\n     * The currently active menu: could be the root menu or a submenu\n     */\n    get activeMenu(): Menu {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let result: Menu = this;\n        while (result.isSubmenuOpen) {\n            result = result.activeMenuItem.submenu;\n        }\n        return result;\n    }\n\n    handleKeyupEvent(ev: KeyboardEvent): void {\n        if (this.isDynamic) {\n            const newModifiers = keyboardModifiersFromEvent(ev);\n            if (\n                !equalKeyboardModifiers(\n                    this.currentKeyboardModifiers,\n                    newModifiers\n                )\n            ) {\n                this.updateMenu(newModifiers);\n                this.currentKeyboardModifiers = newModifiers;\n            }\n        }\n    }\n    handleKeydownEvent(ev: KeyboardEvent): void {\n        if (ev.key === 'Tab') {\n            // Close and bubble\n            this.rootMenu.hide();\n            return;\n        }\n\n        if (this.isDynamic) {\n            const newModifiers = keyboardModifiersFromEvent(ev);\n            if (\n                !equalKeyboardModifiers(\n                    this.currentKeyboardModifiers,\n                    newModifiers\n                )\n            ) {\n                this.updateMenu(newModifiers);\n                this.currentKeyboardModifiers = newModifiers;\n            }\n        }\n\n        let handled = true;\n        const menu = this.activeMenu;\n        const menuItem = menu.activeMenuItem;\n        switch (ev.key) {\n            case ' ':\n            case 'Space':\n            case 'Return':\n            case 'Enter':\n                menuItem?.select(keyboardModifiersFromEvent(ev));\n                break;\n            case 'ArrowRight':\n                if (menuItem?.submenu) {\n                    menuItem.select(keyboardModifiersFromEvent(ev));\n                    this.activeMenu.activeMenuItem = this.activeMenu.firstMenuItem;\n                } else if (!menuItem) {\n                    menu.activeMenuItem = menu.firstMenuItem;\n                }\n                break;\n            case 'ArrowLeft':\n                if (menu === this.rootMenu) {\n                    if (!menuItem) {\n                        menu.activeMenuItem = menu.firstMenuItem;\n                    }\n                } else {\n                    menu.hide();\n                    const el = menu.parentMenu.activeMenuItem.element;\n                    el.focus();\n                    el.classList.remove('is-submenu-open');\n                }\n                break;\n            case 'ArrowDown':\n                menu.activeMenuItem = menu.nextMenuItem(+1);\n                break;\n            case 'ArrowUp':\n                menu.activeMenuItem = menu.nextMenuItem(-1);\n                break;\n            case 'Home':\n            case 'PageUp':\n                menu.activeMenuItem = menu.firstMenuItem;\n                break;\n            case 'End':\n            case 'PageDown':\n                menu.activeMenuItem = menu.lastMenuItem;\n                break;\n            case 'Escape':\n                this.rootMenu.hide();\n                break;\n            case 'Backspace':\n                if (this.typingBuffer) {\n                    this.typingBuffer = this.typingBuffer.slice(0, -1);\n                    if (this.typingBuffer) {\n                        clearTimeout(this.typingBufferResetTimer);\n                        const newItem = menu.findMenuItem(this.typingBuffer);\n                        if (newItem) menu.activeMenuItem = newItem;\n\n                        this.typingBufferResetTimer = setTimeout(() => {\n                            this.typingBuffer = '';\n                        }, 500);\n                    }\n                }\n                break;\n            default:\n                if (mightProducePrintableCharacter(ev)) {\n                    if (isFinite(this.typingBufferResetTimer)) {\n                        clearTimeout(this.typingBufferResetTimer);\n                    }\n                    this.typingBuffer += ev.key;\n                    const newItem = menu.findMenuItem(this.typingBuffer);\n                    if (newItem) menu.activeMenuItem = newItem;\n\n                    this.typingBufferResetTimer = setTimeout(() => {\n                        this.typingBuffer = '';\n                    }, 500);\n                } else {\n                    handled = false;\n                }\n        }\n        if (handled) {\n            ev.preventDefault();\n            ev.stopPropagation();\n        }\n    }\n\n    handleMouseMoveEvent(event: MouseEvent): void {\n        this.lastMouseEvent = event;\n    }\n\n    handleEvent(event: Event): void {\n        if (event.type === 'keydown') {\n            this.handleKeydownEvent(event as KeyboardEvent);\n        } else if (event.type === 'keyup') {\n            this.handleKeyupEvent(event as KeyboardEvent);\n        } else if (event.type === 'mousemove') {\n            this.handleMouseMoveEvent(event as MouseEvent);\n        } else if (event.type === 'mouseup' && event.target === this._scrim) {\n            if (\n                isFinite(this.rootMenu._openTimestamp) &&\n                Date.now() - this.rootMenu._openTimestamp < 120\n            ) {\n                // Hold mode...\n                this.state = 'modal';\n            } else {\n                // Cancel\n                this.hide();\n            }\n        } else if (event.type === 'click' && event.target === this._scrim) {\n            this.hide();\n            event.preventDefault();\n            event.stopPropagation();\n        } else if (event.type === 'contextmenu') {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n    }\n\n    private get scrim(): HTMLElement {\n        if (this._scrim) return this._scrim;\n\n        this._scrim = document.createElement('div');\n        this._scrim.setAttribute('role', 'presentation');\n\n        this._scrim.className = 'scrim';\n\n        return this._scrim;\n    }\n\n    private connectScrim(el: Node): void {\n        const scrim = this.scrim;\n        el.appendChild(scrim);\n        scrim.addEventListener('click', this);\n        scrim.addEventListener('mouseup', this);\n\n        scrim.addEventListener('contextmenu', this);\n\n        scrim.addEventListener('keydown', this);\n        scrim.addEventListener('keyup', this);\n        scrim.addEventListener('mousemove', this);\n\n        // Prevent scrolling in the background\n        const scrollbarWidth =\n            window.innerWidth - document.documentElement.clientWidth;\n        document.body.style.overflow = 'hidden';\n        document.body.style.marginRight = `${scrollbarWidth}px`;\n    }\n\n    private disconnectScrim(): void {\n        const scrim = this.scrim;\n        scrim.removeEventListener('click', this);\n        scrim.removeEventListener('mouseup', this);\n\n        scrim.removeEventListener('contextmenu', this);\n\n        scrim.removeEventListener('keydown', this);\n        scrim.removeEventListener('keyup', this);\n        scrim.removeEventListener('mousemove', this);\n\n        scrim.parentNode.removeChild(scrim);\n\n        // Restore background scrolling\n        document.body.style.marginRight = '';\n        document.body.style.overflow = 'visible';\n    }\n\n    get rootMenu(): RootMenu {\n        // I AM THE ONE WHO KNOCKS\n        return this;\n    }\n\n    show(options?: {\n        clientX?: number;\n        clientY?: number;\n        parent?: Node; // Where the menu should attach\n        keyboardModifiers?: KeyboardModifiers;\n    }): boolean {\n        // Remember the previously focused element. We'll restore it when we close.\n        const activeElement = deepActiveElement();\n        if (super.show({ ...options, parent: this.scrim })) {\n            // Record the opening time.\n            // If we receive a mouseup within a small delta of the open time stamp\n            // hold the menu open until it is dismissed, otherwise close it.\n            this._openTimestamp = Date.now();\n            this.state = 'open';\n\n            this.previousActiveElement = activeElement;\n\n            this.connectScrim(options?.parent ?? document.body);\n            return true;\n        }\n        return false;\n    }\n\n    hide(): void {\n        this.cancelDelayedOperation();\n        if (this.state !== 'closed') {\n            this.activeMenuItem = null;\n            super.hide();\n            this.disconnectScrim();\n            this.state = 'closed';\n            // Restore the previously focused element\n            this.previousActiveElement?.focus?.();\n        }\n    }\n\n    scheduleOperation(fn: () => void): void {\n        this.cancelDelayedOperation();\n\n        const delay = this.submenuHysteresis;\n        if (delay <= 0) {\n            fn();\n            return;\n        }\n        this.hysteresisTimer = setTimeout(() => {\n            this.hysteresisTimer = undefined;\n            fn();\n        }, delay);\n    }\n\n    cancelDelayedOperation(): void {\n        if (this.hysteresisTimer) {\n            clearTimeout(this.hysteresisTimer);\n            this.hysteresisTimer = undefined;\n        }\n    }\n\n    get submenuHysteresis(): number {\n        return 120;\n    }\n}\n\nfunction isDynamic(item: MenuItemTemplate): boolean {\n    const result =\n        typeof item.disabled === 'function' ||\n        typeof item.hidden === 'function' ||\n        typeof item.checked === 'function' ||\n        typeof item.label === 'function' ||\n        typeof item.ariaDetails === 'function' ||\n        typeof item.ariaLabel === 'function';\n\n    if (item.type === 'submenu' && item.submenu) {\n        return result || item.submenu.some(isDynamic);\n    }\n    return result;\n}\n\nfunction deepActiveElement(): HTMLOrSVGElement | null {\n    let a = document.activeElement;\n    while (a?.shadowRoot?.activeElement) {\n        a = a.shadowRoot.activeElement;\n    }\n    return (a as unknown) as HTMLOrSVGElement;\n}\n","import { UIElement } from '../common/ui-element';\nimport {\n    KeyboardModifiers,\n    keyboardModifiersFromEvent,\n    MenuItemTemplate,\n    MENU_TEMPLATE,\n    MENU_STYLE,\n} from './menu-core';\nimport { RootMenu } from './root-menu';\n\n/**\n * This web component display a contextual menu when the user performs the\n * appropriate gesture (right-click, control+click, shift+F10, etc...),\n * handles the user interaction to navigate the items in the menu and submenus\n * and either invoke the `onSelect()` hook associated with the selected menu item\n * or dispatches a 'select' event when the user completes their selection.\n *\n * Place this element inside a container and the contextual menu will be\n * displayed when a right-click/control+click/long tap is performed in the\n * container or if the container is keyboard focused when shift+f10 is pressed.\n * In the former case, the menu is diplayed where the click/tap occured.\n * In the later case, the menu is displayed in the center of the parent container.\n *\n * This component is:\n * - screen-reader compatible\n * - keyboard navigable\n * - dark-theme aware\n * - responsive (the menu and submenus will attempt to avoid being displayed\n *   outside of the viewport boundary)\n *\n */\nexport class UIContextMenuElement extends UIElement {\n    private rootMenu: RootMenu;\n    constructor(inMenuItems?: MenuItemTemplate[]) {\n        super({\n            template: MENU_TEMPLATE,\n            style: MENU_STYLE,\n        });\n\n        // Inline menu items (as a JSON structure in a <script> tag\n        // in the markup)\n        let jsonMenuItems = this.json;\n        if (!Array.isArray(jsonMenuItems)) jsonMenuItems = [];\n\n        this.rootMenu = new RootMenu(\n            [...(inMenuItems ?? []), ...jsonMenuItems],\n            {\n                host: this.shadowRoot.host,\n                assignedElement: this.shadowRoot.querySelector<HTMLElement>(\n                    'ul'\n                ),\n            }\n        );\n    }\n\n    /**\n     * @internal\n     */\n    handleEvent(event: Event): void {\n        if (event.type === 'contextmenu') {\n            const evt = event as MouseEvent;\n            this.show({\n                clientX: evt.clientX,\n                clientY: evt.clientY,\n                keyboardModifiers: keyboardModifiersFromEvent(evt),\n            });\n            event.preventDefault();\n            event.stopPropagation();\n        } else if (event.type === 'keydown') {\n            const evt = event as KeyboardEvent;\n            if (\n                evt.code === 'ContextMenu' ||\n                (evt.code === 'F10' && evt.shiftKey)\n            ) {\n                // shift+F10 = contextual menu\n                // Get the middle of the parent\n                const bounds = this.parentElement?.getBoundingClientRect();\n                if (bounds) {\n                    this.show({\n                        clientX: bounds.left + bounds.width / 2,\n                        clientY: bounds.top + bounds.height / 2,\n                        keyboardModifiers: keyboardModifiersFromEvent(evt),\n                    });\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            }\n        } else {\n            // @todo press-and-hold\n        }\n    }\n    /**\n     * Custom elements lifecycle hooks\n     * @internal\n     */\n    connectedCallback(): void {\n        // Listen for contextual menu in the parent\n        const parent = this.parentNode;\n        parent.addEventListener('contextmenu', this);\n        parent.addEventListener('keydown', this);\n    }\n    /**\n     * Custom elements lifecycle hooks\n     * @internal\n     */\n    disconnectedCallback(): void {\n        const parent = this.parentNode;\n        if (parent) {\n            parent.removeEventListener('contextmenu', this);\n            parent.removeEventListener('keydown', this);\n        }\n    }\n    /**\n     * @internal\n     */\n    focus(): void {\n        super.focus();\n        if (this.rootMenu.state !== 'closed') {\n            if (this.rootMenu.activeMenuItem) {\n                this.rootMenu.activeMenuItem.element.focus();\n            } else {\n                this.rootMenu.element.focus();\n            }\n        }\n    }\n    /**\n     * Display the menu at the specified location.\n     * If provided, the `keyboardModifiers` option can change what commands\n     * are visible, enabled, or what their label is.\n     *\n     * The contextual menu is shown automatically when the appropriate UI gesture\n     * is performed by the user (right-click, shift+F10, etc...). This method\n     * only needs to be called to trigger the menu manually (for example to\n     * trigger it on click of an item).\n     */\n    show(options?: {\n        clientX?: number;\n        clientY?: number;\n        keyboardModifiers?: KeyboardModifiers;\n    }): void {\n        if (this.rootMenu.show({ ...options, parent: this.shadowRoot })) {\n            if (!this.hasAttribute('tabindex')) {\n                this.setAttribute('tabindex', '-1');\n            }\n            this.style.display = 'block';\n            this.focus();\n        }\n    }\n    /**\n     * Hide the menu.\n     *\n     * The visibility of the menu is typically controlled by the user\n     * interaction: the menu is automatically hidden if the user release the\n     * mouse button, or after having selected a command. This is a manual\n     * override that should be very rarely needed.\n     */\n    hide(): void {\n        this.rootMenu.hide();\n    }\n}\n\nexport default UIContextMenuElement;\n\ndeclare global {\n    /** @internal */\n    interface Window {\n        UIContextMenuElement: typeof UIContextMenuElement;\n    }\n}\nif (!window.customElements.get('ui-context-menu')) {\n    window.UIContextMenuElement = UIContextMenuElement;\n    window.customElements.define('ui-context-menu', UIContextMenuElement);\n}\n"],"names":[],"mappings":";;;;;;IAAA;;;UAGa,SAAU,SAAQ,WAAW;QAItC,YAAY,OAGX;YACG,KAAK,EAAE,CAAC;YAER,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YAEpC,IAAI,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,QAAQ,aAAY,mBAAmB,EAAE;gBAClD,IAAI,CAAC,UAAU,CAAC,WAAW,CACvB,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAC3C,CAAC;aACL;iBAAM,IAAI,QAAO,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,QAAQ,CAAA,KAAK,QAAQ,EAAE;gBAC9C,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,OAAO,CAAC,QAAQ,CAAC;aAChD;YAED,IAAI,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,aAAY,mBAAmB,EAAE;gBAC/C,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;aACtE;iBAAM,IAAI,QAAO,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,CAAA,KAAK,QAAQ,EAAE;gBAC3C,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;gBAC9C,KAAK,CAAC,WAAW,GAAG,OAAO,CAAC,KAAK,CAAC;gBAClC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aACjC;;;YAID,IAAI,IAAI,CAAC,aAAa,EAAE;gBACpB,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;gBAC9C,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC;gBACvC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aACjC;SACJ;;;;QAKD,IAAc,IAAI;YACd,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,WAAW,EAAE;gBACnC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;gBAClB,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU;qBACvB,aAAa,CAAkB,MAAM,CAAC;qBACtC,gBAAgB,EAAE;qBAClB,MAAM,CACH,CAAC,CAAC,KACE,CAAC,CAAC,OAAO,KAAK,QAAQ;oBACtB,CAAC,CAAC,MAAM,CAAC,KAAK,kBAAkB,CACvC;qBACA,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,WAAW,CAAC;qBACzB,IAAI,CAAC,EAAE,CAAC,CAAC;gBACd,IAAI,IAAI,EAAE;oBACN,IAAI;wBACA,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;qBACjC;oBAAC,OAAO,CAAC,EAAE;;;wBAGR,MAAM,GAAG,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC;wBACzB,MAAM,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;wBACzC,IAAI,CAAC,EAAE;4BACH,MAAM,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;4BAC7B,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAC1B,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,EAAE,EAAE,CAAC,CAAC,EACvB,KAAK,CACR,CAAC;4BACF,MAAM,IAAI,KAAK,CAAC,GAAG,GAAG,IAAI,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;yBAChD;6BAAM;4BACH,MAAM,CAAC,CAAC;yBACX;qBACJ;iBACJ;aACJ;YACD,OAAO,IAAI,CAAC,KAAK,CAAC;SACrB;;;;QAKD,IAAc,aAAa;YACvB,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW,EAAE;gBACpC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU;qBACxB,aAAa,CAAkB,MAAM,CAAC;qBACtC,gBAAgB,EAAE;qBAClB,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC;qBACpC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,WAAW,CAAC;qBACzB,IAAI,CAAC,EAAE,CAAC,CAAC;aACjB;YACD,OAAO,IAAI,CAAC,MAAM,CAAC;SACtB;;;IC7FL,MAAM,kBAAkB,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IAC9D,kBAAkB,CAAC,SAAS,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;cAqFjB,CAAC;UAEF,iBAAkB,SAAQ,WAAW;QAC9C,WAAW,kBAAkB;YACzB,OAAO,CAAC,UAAU,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;SACpD;QAED,IAAI,OAAO;YACP,OAAO,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;SACvC;QAED,IAAI,OAAO,CAAC,GAAY;YACpB,IAAI,GAAG,EAAE;gBACL,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;aACpC;iBAAM;gBACH,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;aACnC;SACJ;QAED,IAAI,QAAQ;YACR,OAAO,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;SACxC;QAED,IAAI,QAAQ,CAAC,GAAY;YACrB,IAAI,GAAG,EAAE;gBACL,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;aACrC;iBAAM;gBACH,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;aACpC;SACJ;QAED,IAAI,MAAM;YACN,OAAO,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;SACtC;QAED,IAAI,MAAM,CAAC,GAAY;YACnB,IAAI,GAAG,EAAE;gBACL,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;aACnC;iBAAM;gBACH,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;aAClC;SACJ;QACD,IAAI,IAAI;YACJ,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,QAAQ,CAAC;SAC3E;QAED,IAAI,IAAI,CAAC,GAAW;YAChB,IAAI,GAAG,EAAE;gBACL,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;aAClC;iBAAM;gBACH,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;aAChC;SACJ;QACD;YACI,KAAK,EAAE,CAAC;YAER,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YACpC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,kBAAkB,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;SAC3E;KACJ;IAWD,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE;QAC5C,MAAM,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;QAC7C,MAAM,CAAC,cAAc,CAAC,MAAM,CAAC,cAAc,EAAE,iBAAiB,CAAC,CAAC;;;IC3J7D,MAAM,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IAChE,aAAa,CAAC,SAAS,GAAG,wBAAwB,CAAC;IAC5C,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IAC7D,UAAU,CAAC,SAAS,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;SAqJd,CAAC;IA2DV;;;UAGa,IAAI;QAwBb,YACI,SAA8B,EAC9B,OAGC;;YAED,IAAI,CAAC,UAAU,SAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,UAAU,mCAAI,IAAI,CAAC;YAC9C,IAAI,CAAC,kBAAkB,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,iBAAiB,CAAC;YAErD,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;YACpC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;SAC9B;QAED,IAAI,QAAQ;;YACR,aAAO,IAAI,CAAC,UAAU,0CAAE,QAAQ,CAAC;SACpC;QAED,IAAI,IAAI;YACJ,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;SAC7B;QAED,UAAU,CAAC,iBAAqC;;;;;YAK5C,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC;YAC3B,IAAI,eAAuB,CAAC;YAC5B,IAAI,OAAe,CAAC;YACpB,IAAI,OAAe,CAAC;YACpB,IAAI,MAAY,CAAC;YACjB,IAAI,IAAI,EAAE;;;gBAGN,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;gBAC/D,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC;gBACzB,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;gBAC1B,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC;gBACzB,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,WAAW,CAAC,IAAI,EAAE;gBAC1B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;aACxB;YAED,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YACtB,IAAI,CAAC,IAAI,CAAC,kBAAkB;gBAAE,OAAO;YACrC,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,KAC9B,IAAI,CAAC,cAAc,CAAC,CAAC,EAAE,iBAAiB,CAAC,CAC5C,CAAC;;YAGF,UAAI,IAAI,CAAC,IAAI,0CAAE,UAAU,EAAE;gBACvB,MAAM,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU;qBACpC,aAAa,CAAkB,MAAM,CAAC;qBACtC,gBAAgB,EAAE;qBAClB,MAAM,CACH,CAAC,CAAC,KAA6B,CAAC,CAAC,OAAO,KAAK,cAAc,CAC9D,CAAC;gBACN,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,KAC/B,IAAI,CAAC,cAAc,CAAC,CAAC,EAAE,iBAAiB,CAAC,CAC5C,CAAC;aACL;YAED,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC;YACtE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;YAEhE,IAAI,IAAI,EAAE;;;gBAGN,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,WAAW,CAAC,IAAI,CAAC,OAAO,EAAE;gBAElC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;gBACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,OAAO,CAAC;gBACjC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,OAAO,CAAC;gBAElC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;gBACtD,UAAI,IAAI,CAAC,cAAc,0CAAE,OAAO,EAAE;oBAC9B,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;iBACtD;aACJ;SACJ;QAED,IAAI,SAAS;YACT,OAAO,IAAI,CAAC,UAAU,CAAC;SAC1B;;QAGD,IAAI,aAAa;YACb,IAAI,MAAM,GAAG,CAAC,CAAC;YACf,IAAI,KAAK,GAAG,KAAK,CAAC;YAClB,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;YACjC,OAAO,CAAC,KAAK,IAAI,MAAM,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC7C,MAAM,IAAI,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;gBAC/B,KAAK,GAAG,IAAI,CAAC,IAAI,KAAK,WAAW,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACpE,MAAM,IAAI,CAAC,CAAC;aACf;YAED,OAAO,CAAC,KAAK,GAAG,IAAI,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;SAChD;;QAED,IAAI,YAAY;YACZ,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;YACvC,IAAI,KAAK,GAAG,KAAK,CAAC;YAClB,OAAO,CAAC,KAAK,IAAI,MAAM,IAAI,CAAC,EAAE;gBAC1B,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBACpC,KAAK,GAAG,IAAI,CAAC,IAAI,KAAK,WAAW,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACpE,MAAM,IAAI,CAAC,CAAC;aACf;YAED,OAAO,CAAC,KAAK,GAAG,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;SACrD;;;;QAID,IAAI,cAAc;YACd,OAAO,IAAI,CAAC,eAAe,CAAC;SAC/B;;;;;;;QAQD,IAAI,cAAc,CAAC,KAAe;;YAC9B,MAAA,IAAI,CAAC,UAAU,0CAAE,QAAQ,CAAC,sBAAsB,GAAG;YACnD,IAAI,KAAK,KAAK,IAAI,CAAC,eAAe,EAAE;;gBAEhC,IAAI,IAAI,CAAC,cAAc,EAAE;oBACrB,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC;oBACjC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;;oBAEpB,MAAA,IAAI,CAAC,OAAO,0CAAE,IAAI,GAAG;iBACxB;gBAED,IAAI,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,MAAM,EAAE;oBACf,IAAI,CAAC,eAAe,GAAG,SAAS,CAAC;oBACjC,OAAO;iBACV;gBAED,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;;gBAG7B,IAAI,KAAK;oBAAE,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC;aAClC;YACD,IAAI,KAAK,EAAE;gBACP,KAAK,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;aACzB;iBAAM;gBACH,MAAA,IAAI,CAAC,QAAQ,0CAAE,KAAK,GAAG;aAC1B;;YAGD,YAAA,IAAI,CAAC,UAAU,0CAAE,cAAc,0CAAE,OAAO,CAAC,SAAS,CAAC,MAAM,CACrD,iBAAiB,EACjB,CAAC,CAAC,KAAK,EACT;SACL;QAED,YAAY,CAAC,GAAW;YACpB,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,GAAG,GAAG,CAAC;gBAAE,OAAO,IAAI,CAAC,aAAa,CAAC;YAChE,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,GAAG,GAAG,CAAC;gBAAE,OAAO,IAAI,CAAC,YAAY,CAAC;YAC/D,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC1D,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACxD,IAAI,KAAK,GAAG,KAAK,CAAC;YAClB,IAAI,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,GAAG,CAAC;YACjE,OAAO,CAAC,KAAK,IAAI,MAAM,IAAI,KAAK,IAAI,MAAM,IAAI,IAAI,EAAE;gBAChD,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;gBACrC,KAAK,GAAG,IAAI,CAAC,IAAI,KAAK,WAAW,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACpE,MAAM,IAAI,GAAG,CAAC;aACjB;YACD,OAAO,KAAK;kBACN,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,GAAG,CAAC;kBAC7B,GAAG,GAAG,CAAC;sBACP,IAAI,CAAC,YAAY;sBACjB,IAAI,CAAC,aAAa,CAAC;SAC5B;QAID,WAAW,QAAQ;YACf,IAAI,IAAI,CAAC,SAAS;gBAAE,OAAO,IAAI,CAAC,SAAS,CAAC;YAC1C,IAAI,CAAC,SAAS,GAAG,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE;gBAC1C,KAAK,EAAE,QAAQ;gBACf,WAAW,EAAE,MAAM;aACtB,CAAC,CAAC;YACH,OAAO,IAAI,CAAC,SAAS,CAAC;SACzB;QACD,YAAY,CAAC,IAAY;YACrB,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CACrC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,WAAW,IAAI,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,QAAQ,CAC5D,CAAC;YACF,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC;gBAAE,OAAO,IAAI,CAAC;YACzC,MAAM,IAAI,GACN,IAAI,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC;YAErE,IAAI,IAAI,GAAG,CAAC;gBAAE,OAAO,IAAI,CAAC;;YAG1B,IAAI,MAAgB,CAAC;YACrB,IAAI,CAAC,GAAG,CAAC,CAAC;YACV,OAAO,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,EAAE;gBACxB,MAAM,GAAG,UAAU,CAAC,IAAI,CACpB,CAAC,CAAC,KACE,IAAI,CAAC,QAAQ,CAAC,OAAO,CACjB,IAAI,EACJ,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CACjC,KAAK,CAAC,CACd,CAAC;gBACF,CAAC,EAAE,CAAC;aACP;YACD,OAAO,MAAM,CAAC;SACjB;QAED,IAAI,OAAO;;YACP,IAAI,IAAI,CAAC,QAAQ;gBAAE,OAAO,IAAI,CAAC,QAAQ,CAAC;YAExC,MAAM,EAAE,SAAG,IAAI,CAAC,kBAAkB,mCAAI,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YACnE,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;YACnC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;YAC1C,EAAE,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;YAClC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAChC,EAAE,CAAC,YAAY,CAAC,kBAAkB,EAAE,UAAU,CAAC,CAAC;;YAGhD,EAAE,CAAC,WAAW,GAAG,EAAE,CAAC;;YAGpB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;gBACtB,MAAM,IAAI,GAAG,CAAC,CAAC,OAAO,CAAC;gBACvB,IAAI,IAAI;oBAAE,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;aAClC,CAAC,CAAC;YACH,MAAA,EAAE,CAAC,aAAa,CAAC,kBAAkB,CAAC,0CAAE,YAAY,CAAC,UAAU,EAAE,GAAG,EAAE;YAEpE,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;YACnB,OAAO,IAAI,CAAC,QAAQ,CAAC;SACxB;;;;;QAMD,IAAI,CAAC,OAKJ;;YACG,IAAI,CAAC,UAAU,CAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,iBAAiB,CAAC,CAAC;YAC5C,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,KAAK,CAAC;gBAAE,OAAO,KAAK,CAAC;YAEvE,MAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,MAAM,0CAAE,WAAW,CAAC,IAAI,CAAC,OAAO,EAAE;YAE3C,IAAI,QAAQ,CAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAO,CAAC,IAAI,QAAQ,CAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAO,CAAC,EAAE;gBAC1D,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;gBACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC;gBACnE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC;aACvE;YAED,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;;;;YAKrB,IAAI,IAAI,CAAC,UAAU,EAAE;gBACjB,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,IAAI,CAAC;aACtC;YAED,OAAO,IAAI,CAAC;SACf;QAED,IAAI;;;YAEA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YAExB,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;;YAGhC,IAAI,IAAI,CAAC,UAAU,EAAE;gBACjB,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,IAAI,CAAC;aACtC;YAED,YAAA,IAAI,CAAC,QAAQ,0CAAE,UAAU,0CAAE,WAAW,CAAC,IAAI,CAAC,QAAQ,EAAE;YACtD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;SACxB;;;;;;QAOD,IAAI,WAAW,CAAC,OAAa;;YACzB,MAAM,QAAQ,GAAG,OAAO,KAAK,IAAI,CAAC;;YAElC,IAAI,OAAA,IAAI,CAAC,cAAc,0CAAE,IAAI,MAAK,SAAS,EAAE;gBACzC,MAAA,IAAI,CAAC,cAAc,CAAC,OAAO,0CAAE,YAAY,CACrC,eAAe,EACf,QAAQ,CAAC,QAAQ,EAAE,EACrB;aACL;YACD,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC;SACjC;QAED,cAAc,CACV,QAA8C,EAC9C,iBAAoC;YAEpC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,iBAAiB,CAAC,CAAC;SACxD;QAED,cAAc,CACV,GAAW,EACX,QAA8C,EAC9C,iBAAoC;YAEpC,IAAI,GAAG,GAAG,CAAC;gBAAE,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAE3D,IAAI,IAAc,CAAC;YACnB,IAAI,QAAQ,YAAY,iBAAiB,EAAE;gBACvC,IAAI,GAAG,IAAI,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;aAClD;iBAAM;gBACH,IAAI,GAAG,IAAI,oBAAoB,CAAC,QAAQ,EAAE,IAAI,EAAE;oBAC5C,iBAAiB,EAAE,iBAAiB;iBACvC,CAAC,CAAC;aACN;YAED,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;SAC5C;KACJ;IAED;IACA;IACA;IAEA,MAAM,iBAAiB,GAAG;QACtB,WAAW;QACX,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,OAAO;QACP,OAAO;QACP,SAAS;QAET,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,aAAa;QACb,cAAc;QACd,WAAW;QACX,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,WAAW;QACX,OAAO;QACP,eAAe;QACf,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,OAAO;QACP,QAAQ;QACR,OAAO;QACP,QAAQ;QAER,OAAO;QAEP,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,WAAW;QACX,aAAa;QACb,eAAe;QACf,cAAc;QACd,aAAa;QACb,YAAY;QACZ,gBAAgB;QAChB,iBAAiB;QACjB,kBAAkB;QAClB,YAAY;QACZ,iBAAiB;KACpB,CAAC;aAEc,0BAA0B,CACtC,EAA8B;QAE9B,MAAM,MAAM,GAAG;YACX,GAAG,EAAE,KAAK;YACV,OAAO,EAAE,KAAK;YACd,KAAK,EAAE,KAAK;YACZ,IAAI,EAAE,KAAK;SACd,CAAC;QACF,IAAI,EAAE,CAAC,MAAM;YAAE,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC;QACjC,IAAI,EAAE,CAAC,OAAO;YAAE,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;QACtC,IAAI,EAAE,CAAC,OAAO;YAAE,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;QACnC,IAAI,EAAE,CAAC,QAAQ;YAAE,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;QACrC,OAAO,MAAM,CAAC;IAClB,CAAC;aAMe,aAAa,CACzB,IAAsB,EACtB,KAKmB,EACnB,iBAAqC;QAErC,IAAI,OAAO,KAAK,KAAK,SAAS;YAAE,OAAO,KAAK,CAAC;QAC7C,IAAI,OAAO,KAAK,KAAK,UAAU,EAAE;YAC7B,OAAO,KAAK,CAAC,IAAI,EAAE,iBAAiB,CAAC,CAAC;SACzC;QACD,OAAO,SAAS,CAAC;IACrB,CAAC;aAEe,YAAY,CACxB,IAAsB,EACtB,KAKkB,EAClB,OAEC;QAED,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;YAC3B,OAAO,KAAK,CAAC;SAChB;aAAM,IAAI,OAAO,KAAK,KAAK,UAAU,EAAE;YACpC,OAAO,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC;SACjD;QACD,OAAO,SAAS,CAAC;IACrB,CAAC;aAEe,sBAAsB,CAClC,CAAoB,EACpB,CAAoB;QAEpB,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;YAAE,OAAO,KAAK,CAAC;QACzC,QACI,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,GAAG;YACf,CAAC,CAAC,OAAO,KAAK,CAAC,CAAC,OAAO;YACvB,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,KAAK;YACnB,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,IAAI,EACnB;IACN,CAAC;aAEe,8BAA8B,CAAC,GAAkB;QAC7D,IAAI,GAAG,CAAC,OAAO,IAAI,GAAG,CAAC,OAAO,EAAE;;YAE5B,OAAO,KAAK,CAAC;SAChB;;QAGD,IAAI,GAAG,CAAC,GAAG,KAAK,MAAM;YAAE,OAAO,KAAK,CAAC;;QAGrC,IAAI,GAAG,CAAC,IAAI,KAAK,EAAE;YAAE,OAAO,IAAI,CAAC;QAEjC,OAAO,iBAAiB,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACpD,CAAC;IAED,MAAM,sBAAsB,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IAClE,sBAAsB,CAAC,SAAS,GAAG,wdAAwd,CAAC;IAE5f,MAAM,kBAAkB,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IAC9D,kBAAkB,CAAC,SAAS,GAAG;QACvB,CAAC;IAoBT;;;;;;UAMsB,QAAQ;QAI1B,YAAY,UAAgB;YACxB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;SAChC;QAED,WAAW,CAAC,KAAY;;YACpB,IAAI,KAAK,CAAC,IAAI,KAAK,YAAY,EAAE;gBAC7B,MAAM,EAAE,GAAG,KAAmB,CAAC;gBAC/B,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,sBAAsB,EAAE,CAAC;;;;;gBAKlD,IACI,IAAI,CAAC,UAAU,CAAC,aAAa,WAC7B,IAAI,CAAC,UAAU,CAAC,cAAc,0CAAE,mBAAmB,CAAC,EAAE,EAAC,EACzD;oBACE,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,iBAAiB,CAAC;wBACvC,IAAI,CAAC,UAAU,CAAC,cAAc,GAAG,IAAI,CAAC;wBACtC,IAAI,IAAI,CAAC,OAAO,EAAE;4BACd,IAAI,CAAC,WAAW,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC,CAAC;yBACpD;qBACJ,CAAC,CAAC;iBACN;qBAAM;oBACH,IAAI,CAAC,UAAU,CAAC,cAAc,GAAG,IAAI,CAAC;oBACtC,IAAI,IAAI,CAAC,OAAO,EAAE;wBACd,IAAI,CAAC,WAAW,CAAC,0BAA0B,CAAC,EAAE,CAAC,EAAE;4BAC7C,SAAS,EAAE,IAAI;yBAClB,CAAC,CAAC;qBACN;iBACJ;aACJ;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,YAAY,EAAE;gBACpC,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,UAAU,KAAK,IAAI,CAAC,UAAU,EAAE;oBACzD,IAAI,CAAC,UAAU,CAAC,cAAc,GAAG,IAAI,CAAC;iBACzC;aACJ;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;gBACjC,MAAM,EAAE,GAAG,KAAmB,CAAC;;;gBAG/B,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,KAAK,KAAK,OAAO,EAAE;oBAC5C,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC,CAAC;iBAC/C;gBACD,EAAE,CAAC,eAAe,EAAE,CAAC;gBACrB,EAAE,CAAC,cAAc,EAAE,CAAC;aACvB;SACJ;QAoBD,IAAI,IAAI;YACJ,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;SAC/B;;;;;;QAOD,MAAM,CAAC,GAAuB;YAC1B,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,sBAAsB,EAAE,CAAC;YAElD,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;gBACtB,OAAO;aACV;;YAGD,UAAU,CAAC;gBACP,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;gBACpB,UAAU,CAAC;oBACP,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;oBACnB,UAAU,CAAC;wBACP,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;wBAChC,UAAU,CAAC,MAAM,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;qBACnD,EAAE,GAAG,CAAC,CAAC;iBACX,EAAE,GAAG,CAAC,CAAC;aACX,EAAE,GAAG,CAAC,CAAC;SACX;;;;;QAMD,WAAW,CACP,GAAsB,EACtB,OAAgC;;YAEhC,UAAI,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,SAAS,mCAAI,KAAK,EAAE;gBAC7B,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,iBAAiB,CAAC,MACvC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CACxB,CAAC;gBACF,OAAO;aACV;YACD,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,WAAW,CAAC;YAC7D,MAAM,SAAS,GAAG,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,YAAY,CAAC;YAC/D,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,qBAAqB,EAAE,CAAC;;YAGpD,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAC7B,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YAC/C,MAAM,aAAa,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,EAAE,CAAC;YACnE,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YAE/C,IAAI,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC;YAC3B,IAAI,OAAO,GAAG,CAAC,CAAC,CAAC;YACjB,IAAI,MAAM,CAAC,KAAK,GAAG,aAAa,CAAC,KAAK,GAAG,QAAQ,EAAE;;gBAE/C,OAAO,GAAG,CAAC,aAAa,CAAC,KAAK,CAAC;aAClC;YACD,IAAI,MAAM,CAAC,GAAG,GAAG,CAAC,GAAG,aAAa,CAAC,MAAM,GAAG,SAAS,EAAE;;gBAEnD,OAAO,GAAG,CAAC,CAAC,IAAI,aAAa,CAAC,MAAM,IAAI,SAAS,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;aACpE;YACD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;gBACd,OAAO;gBACP,OAAO;gBACP,MAAM,EAAE,IAAI,CAAC,OAAO;gBACpB,iBAAiB,EAAE,GAAG;aACzB,CAAC,CAAC;SACN;QAED,mBAAmB,CAAC,EAAc;YAC9B,MAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC;YACvD,IAAI,CAAC,MAAM;gBAAE,OAAO,KAAK,CAAC;YAE1B,MAAM,MAAM,GAAG,EAAE,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC;YAC/C,IAAI,MAAM,GAAG,GAAG;gBAAE,OAAO,KAAK,CAAC;YAE/B,MAAM,MAAM,GAAG,EAAE,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;;YAG3C,MAAM,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC,OAAO,GAAG,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;YAC7D,IAAI,CAAC,IAAI,GAAG;gBAAE,OAAO,KAAK,CAAC;;YAG3B,IAAI,QAAQ,GAAqB,OAAO,CAAC;YACzC,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE;gBACtB,MAAM,aAAa,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,EAAE,CAAC;gBAEnE,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,qBAAqB,EAAE,CAAC;gBACpD,IAAI,aAAa,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,GAAG,CAAC,EAAE;oBACrD,QAAQ,GAAG,MAAM,CAAC;iBACrB;aACJ;YAED,OAAO,QAAQ,KAAK,OAAO,GAAG,MAAM,GAAG,CAAC,GAAG,MAAM,GAAG,CAAC,CAAC;SACzD;KACJ;UAEY,oBAAqB,SAAQ,QAAQ;QAiB9C,YACI,QAA0B,EAC1B,UAAgB,EAChB,OAEC;;YAED,KAAK,CAAC,UAAU,CAAC,CAAC;YAClB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;YAE7B,IAAI,CAAC,OAAO,SACR,aAAa,CACT,QAAQ,EACR,QAAQ,CAAC,MAAM,EACf,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,iBAAiB,CAC7B,mCAAI,KAAK,CAAC;YACf,IAAI,CAAC,SAAS,SACV,aAAa,CACT,QAAQ,EACR,QAAQ,CAAC,QAAQ,EACjB,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,iBAAiB,CAC7B,mCAAI,KAAK,CAAC;YACf,IAAI,CAAC,OAAO,SACR,aAAa,CACT,QAAQ,EACR,QAAQ,CAAC,OAAO,EAChB,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,iBAAiB,CAC7B,mCAAI,KAAK,CAAC;YAEf,IAAI,CAAC,EAAE,GAAG,QAAQ,CAAC,EAAE,CAAC;YACtB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,SAAS,CAAC;YACpC,IAAI,CAAC,MAAM,GAAG,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;YAC9D,IAAI,CAAC,SAAS,GAAG,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YACrE,IAAI,CAAC,WAAW,GAAG,YAAY,CAC3B,QAAQ,EACR,QAAQ,CAAC,WAAW,EACpB,OAAO,CACV,CAAC;YACF,IAAI,OAAO,QAAQ,CAAC,QAAQ,EAAE;gBAC1B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;aACrC;YACD,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;YAE1B,IAAI,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;gBACjC,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;gBACvB,IAAI,CAAC,OAAO,GAAG,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE;oBACtC,UAAU;iBACb,CAAC,CAAC;aACN;iBAAM;gBACH,IACI,OAAO,QAAQ,CAAC,IAAI,KAAK,WAAW;oBACpC,OAAO,QAAQ,CAAC,OAAO,KAAK,WAAW,EACzC;oBACE,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC;iBAC3B;qBAAM;oBACH,IAAI,CAAC,KAAK,SAAG,QAAQ,CAAC,IAAI,mCAAI,QAAQ,CAAC;iBAC1C;aACJ;SACJ;QAED,IAAI,IAAI;YACJ,OAAO,IAAI,CAAC,KAAK,CAAC;SACrB;QACD,IAAI,KAAK;;YACL,aAAO,IAAI,CAAC,MAAM,mCAAI,IAAI,CAAC,SAAS,CAAC;SACxC;QACD,IAAI,MAAM;YACN,OAAO,IAAI,CAAC,OAAO,CAAC;SACvB;QACD,IAAI,QAAQ;YACR,OAAO,IAAI,CAAC,SAAS,CAAC;SACzB;QAEO,MAAM;YACV,IAAI,IAAI,CAAC,MAAM;gBAAE,OAAO,IAAI,CAAC;YAE7B,IAAI,IAAI,CAAC,IAAI,KAAK,WAAW,EAAE;gBAC3B,MAAM,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;gBACxC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;gBAC1C,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;gBACrC,OAAO,EAAE,CAAC;aACb;YAED,IACI,IAAI,CAAC,IAAI,KAAK,QAAQ;gBACtB,IAAI,CAAC,IAAI,KAAK,SAAS;gBACvB,IAAI,CAAC,IAAI,KAAK,OAAO;gBACrB,IAAI,CAAC,IAAI,KAAK,UAAU,EAC1B;gBACE,OAAO,IAAI,CAAC;aACf;YACD,MAAM,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YACxC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;YACrC,IAAI,IAAI,CAAC,SAAS,EAAE;gBAChB,EAAE,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;aACjC;YACD,EAAE,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;YAClC,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;gBACvB,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;aAC5C;iBAAM,IAAI,IAAI,CAAC,IAAI,KAAK,UAAU,EAAE;gBACjC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;aAC/C;iBAAM;gBACH,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;aACvC;YACD,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,EAAE,CAAC,YAAY,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;gBACxC,EAAE,CAAC,WAAW,CAAC,kBAAkB,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;aAC9D;YACD,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,EAAE;gBACzB,EAAE,CAAC,YAAY,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;gBACzC,EAAE,CAAC,YAAY,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;aAC7C;YACD,IAAI,IAAI,CAAC,SAAS;gBAAE,EAAE,CAAC,YAAY,CAAC,YAAY,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YAClE,IAAI,IAAI,CAAC,WAAW;gBAAE,EAAE,CAAC,YAAY,CAAC,YAAY,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;YAEtE,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACf,EAAE,CAAC,YAAY,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;aAC5C;iBAAM;gBACH,EAAE,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC;gBACpC,EAAE,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;gBACxC,EAAE,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;gBACxC,EAAE,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;aACxC;YAED,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;YAC5C,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC;YAC5B,IAAI,CAAC,SAAS;gBACV,IAAI,CAAC,UAAU,CAAC,WAAW,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ;sBACjD,cAAc;sBACd,OAAO,CAAC;YAClB,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;gBAChB,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,EAAc,KAC1C,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC,CAC9C,CAAC;aACL;YACD,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YACrB,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,EAAE,CAAC,WAAW,CAAC,sBAAsB,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;aAClE;YACD,OAAO,EAAE,CAAC;SACb;QAED,IAAI,MAAM;YACN,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;SACpD;QAED,IAAI,MAAM,CAAC,GAAY;YACnB,IAAI,GAAG,EAAE;gBACL,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;aACxC;iBAAM;gBACH,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;aAC3C;SACJ;QAED,IAAI,OAAO;YACP,IAAI,IAAI,CAAC,QAAQ;gBAAE,OAAO,IAAI,CAAC,QAAQ,CAAC;YACxC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;YAC9B,OAAO,IAAI,CAAC,QAAQ,CAAC;SACxB;QAED,cAAc,CAAC,GAAuB;YAClC,MAAM,EAAE,GAAG,IAAI,WAAW,CAAkB,QAAQ,EAAE;gBAClD,MAAM,EAAE;oBACJ,iBAAiB,EAAE,GAAG;oBACtB,EAAE,EAAE,IAAI,CAAC,EAAE;oBACX,KAAK,EAAE,IAAI,CAAC,KAAK;oBACjB,IAAI,EAAE,IAAI,CAAC,IAAI;iBAClB;aACJ,CAAC,CAAC;YACH,IAAI,OAAO,IAAI,CAAC,QAAQ,KAAK,UAAU,EAAE;gBACrC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;aACrB;iBAAM;gBACH,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;aAC/B;SACJ;KACJ;UAEY,mBAAoB,SAAQ,QAAQ;QAS7C,YAAY,OAAoB,EAAE,UAAgB;YAC9C,KAAK,CAAC,UAAU,CAAC,CAAC;YAClB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;YAC7B,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;SACjC;QAED,IAAI,IAAI;YACJ,IAAI,IAAI,CAAC,SAAS;gBAAE,OAAO,WAAW,CAAC;;YAEvC,OAAO,QAAQ,CAAC;SACnB;QACD,IAAI,KAAK;YACL,OAAO,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC;SACxC;QACD,IAAI,MAAM;YACN,OAAO,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;SACrD;QACD,IAAI,MAAM,CAAC,KAAc;YACrB,IAAI,KAAK,EAAE;gBACP,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;aAClD;iBAAM;gBACH,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;aACjD;SACJ;QACD,IAAI,QAAQ;YACR,OAAO,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;SACvD;QACD,IAAI,QAAQ,CAAC,KAAc;YACvB,IAAI,KAAK,EAAE;gBACP,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;aACpD;iBAAM;gBACH,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;aACnD;SACJ;QACD,IAAI,OAAO;YACP,OAAO,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;SACtD;QACD,IAAI,OAAO,CAAC,KAAc;YACtB,IAAI,KAAK,EAAE;gBACP,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;aACnD;iBAAM;gBACH,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;aAClD;SACJ;QACD,IAAI,SAAS;YACT,OAAO,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;SACxD;QACD,IAAI,SAAS,CAAC,KAAc;YACxB,IAAI,KAAK,EAAE;gBACP,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;aACrD;iBAAM;gBACH,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC;aACpD;SACJ;QACD,IAAI,MAAM;;YACN,mBAAO,IAAI,CAAC,cAAc,0CAAE,SAAS,CAAC,QAAQ,CAAC,QAAQ,oCAAK,KAAK,CAAC;SACrE;QAED,IAAI,MAAM,CAAC,GAAY;;;;YAGnB,IAAI,GAAG,EAAE;gBACL,MAAA,IAAI,CAAC,cAAc,0CAAE,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE;gBAC7C,IAAI,CAAC,mBAAmB,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;aACvD;iBAAM;gBACH,MAAA,IAAI,CAAC,cAAc,0CAAE,SAAS,CAAC,MAAM,CAAC,QAAQ,EAAE;gBAChD,IAAI,CAAC,mBAAmB,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;aACtD;SACJ;QAEO,MAAM;YACV,IAAI,IAAI,CAAC,MAAM;gBAAE,OAAO,IAAI,CAAC;YAE7B,IAAI,IAAI,CAAC,SAAS,EAAE;gBAChB,MAAM,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;gBACxC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;gBAC1C,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;gBACrC,OAAO,EAAE,CAAC;aACb;YAED,MAAM,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YACxC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;YACrC,EAAE,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;YAClC,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;gBACvB,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;aAC5C;iBAAM,IAAI,IAAI,CAAC,IAAI,KAAK,UAAU,EAAE;gBACjC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;aAC/C;iBAAM;gBACH,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;aACvC;YACD,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,EAAE,CAAC,YAAY,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;gBACxC,EAAE,CAAC,WAAW,CAAC,kBAAkB,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;aAC9D;YACD,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,EAAE;gBACzB,EAAE,CAAC,YAAY,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;gBACzC,EAAE,CAAC,YAAY,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;aAC7C;YAED,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACf,EAAE,CAAC,YAAY,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;aAC5C;iBAAM;gBACH,EAAE,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC;gBACpC,EAAE,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;gBACxC,EAAE,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;gBACxC,EAAE,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;aACxC;YAED,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;gBAChB,EAAE,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,EAAc,KACxC,IAAI,CAAC,MAAM,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC,CAC9C,CAAC;aACL;YACD,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,CACpD,IAAI,CACQ,CAAC;YACjB,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAEzC,OAAO,EAAE,CAAC;SACb;QAED,IAAI,OAAO;YACP,IAAI,IAAI,CAAC,cAAc;gBAAE,OAAO,IAAI,CAAC,cAAc,CAAC;YACpD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;YACpC,OAAO,IAAI,CAAC,cAAc,CAAC;SAC9B;QAED,cAAc,CAAC,GAAuB;YAClC,MAAM,EAAE,GAAG,IAAI,WAAW,CAAkB,QAAQ,EAAE;gBAClD,MAAM,EAAE;oBACJ,iBAAiB,EAAE,GAAG;oBACtB,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,IAAI,CAAC;oBAC1C,KAAK,EAAE,IAAI,CAAC,KAAK;oBACjB,OAAO,EAAE,IAAI,CAAC,cAAc;iBAC/B;aACJ,CAAC,CAAC;YACH,IAAI,OAAO,IAAI,CAAC,cAAc,CAAC,QAAQ,KAAK,UAAU,EAAE;gBACpD,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;aACpC;iBAAM;gBACH,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;aAC/B;SACJ;KACJ;IAED,SAAS,KAAK,CAAC,EAAU,EAAE,EAAU,EAAE,EAAU;QAC7C,OAAO,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC;IAC7C;;UC7vCa,QAAS,SAAQ,IAAI;;;;;;;;;;;;QAsC9B,YACI,SAA8B,EAC9B,OAKC;YAED,KAAK,CAAC,SAAS,EAAE,EAAE,iBAAiB,EAAE,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,eAAe,EAAE,CAAC,CAAC;YAClE,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAC3C,IAAI,CAAC,wBAAwB,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,iBAAiB,CAAC;YAC3D,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YACvB,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;YAEtB,IAAI,CAAC,KAAK,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,IAAI,CAAC;SAC9B;QAED,IAAI,IAAI;YACJ,OAAO,IAAI,CAAC,KAAK,CAAC;SACrB;;;;QAKD,IAAI,UAAU;;YAEV,IAAI,MAAM,GAAS,IAAI,CAAC;YACxB,OAAO,MAAM,CAAC,aAAa,EAAE;gBACzB,MAAM,GAAG,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC;aAC1C;YACD,OAAO,MAAM,CAAC;SACjB;QAED,gBAAgB,CAAC,EAAiB;YAC9B,IAAI,IAAI,CAAC,SAAS,EAAE;gBAChB,MAAM,YAAY,GAAG,0BAA0B,CAAC,EAAE,CAAC,CAAC;gBACpD,IACI,CAAC,sBAAsB,CACnB,IAAI,CAAC,wBAAwB,EAC7B,YAAY,CACf,EACH;oBACE,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;oBAC9B,IAAI,CAAC,wBAAwB,GAAG,YAAY,CAAC;iBAChD;aACJ;SACJ;QACD,kBAAkB,CAAC,EAAiB;YAChC,IAAI,EAAE,CAAC,GAAG,KAAK,KAAK,EAAE;;gBAElB,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACrB,OAAO;aACV;YAED,IAAI,IAAI,CAAC,SAAS,EAAE;gBAChB,MAAM,YAAY,GAAG,0BAA0B,CAAC,EAAE,CAAC,CAAC;gBACpD,IACI,CAAC,sBAAsB,CACnB,IAAI,CAAC,wBAAwB,EAC7B,YAAY,CACf,EACH;oBACE,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;oBAC9B,IAAI,CAAC,wBAAwB,GAAG,YAAY,CAAC;iBAChD;aACJ;YAED,IAAI,OAAO,GAAG,IAAI,CAAC;YACnB,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC;YAC7B,MAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC;YACrC,QAAQ,EAAE,CAAC,GAAG;gBACV,KAAK,GAAG,CAAC;gBACT,KAAK,OAAO,CAAC;gBACb,KAAK,QAAQ,CAAC;gBACd,KAAK,OAAO;oBACR,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,MAAM,CAAC,0BAA0B,CAAC,EAAE,CAAC,EAAE;oBACjD,MAAM;gBACV,KAAK,YAAY;oBACb,IAAI,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,OAAO,EAAE;wBACnB,QAAQ,CAAC,MAAM,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC,CAAC;wBAChD,IAAI,CAAC,UAAU,CAAC,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;qBAClE;yBAAM,IAAI,CAAC,QAAQ,EAAE;wBAClB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC;qBAC5C;oBACD,MAAM;gBACV,KAAK,WAAW;oBACZ,IAAI,IAAI,KAAK,IAAI,CAAC,QAAQ,EAAE;wBACxB,IAAI,CAAC,QAAQ,EAAE;4BACX,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC;yBAC5C;qBACJ;yBAAM;wBACH,IAAI,CAAC,IAAI,EAAE,CAAC;wBACZ,MAAM,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,OAAO,CAAC;wBAClD,EAAE,CAAC,KAAK,EAAE,CAAC;wBACX,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;qBAC1C;oBACD,MAAM;gBACV,KAAK,WAAW;oBACZ,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC5C,MAAM;gBACV,KAAK,SAAS;oBACV,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC5C,MAAM;gBACV,KAAK,MAAM,CAAC;gBACZ,KAAK,QAAQ;oBACT,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC;oBACzC,MAAM;gBACV,KAAK,KAAK,CAAC;gBACX,KAAK,UAAU;oBACX,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,YAAY,CAAC;oBACxC,MAAM;gBACV,KAAK,QAAQ;oBACT,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;oBACrB,MAAM;gBACV,KAAK,WAAW;oBACZ,IAAI,IAAI,CAAC,YAAY,EAAE;wBACnB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;wBACnD,IAAI,IAAI,CAAC,YAAY,EAAE;4BACnB,YAAY,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;4BAC1C,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;4BACrD,IAAI,OAAO;gCAAE,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;4BAE3C,IAAI,CAAC,sBAAsB,GAAG,UAAU,CAAC;gCACrC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;6BAC1B,EAAE,GAAG,CAAC,CAAC;yBACX;qBACJ;oBACD,MAAM;gBACV;oBACI,IAAI,8BAA8B,CAAC,EAAE,CAAC,EAAE;wBACpC,IAAI,QAAQ,CAAC,IAAI,CAAC,sBAAsB,CAAC,EAAE;4BACvC,YAAY,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;yBAC7C;wBACD,IAAI,CAAC,YAAY,IAAI,EAAE,CAAC,GAAG,CAAC;wBAC5B,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;wBACrD,IAAI,OAAO;4BAAE,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;wBAE3C,IAAI,CAAC,sBAAsB,GAAG,UAAU,CAAC;4BACrC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;yBAC1B,EAAE,GAAG,CAAC,CAAC;qBACX;yBAAM;wBACH,OAAO,GAAG,KAAK,CAAC;qBACnB;aACR;YACD,IAAI,OAAO,EAAE;gBACT,EAAE,CAAC,cAAc,EAAE,CAAC;gBACpB,EAAE,CAAC,eAAe,EAAE,CAAC;aACxB;SACJ;QAED,oBAAoB,CAAC,KAAiB;YAClC,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;SAC/B;QAED,WAAW,CAAC,KAAY;YACpB,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;gBAC1B,IAAI,CAAC,kBAAkB,CAAC,KAAsB,CAAC,CAAC;aACnD;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;gBAC/B,IAAI,CAAC,gBAAgB,CAAC,KAAsB,CAAC,CAAC;aACjD;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,WAAW,EAAE;gBACnC,IAAI,CAAC,oBAAoB,CAAC,KAAmB,CAAC,CAAC;aAClD;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,IAAI,KAAK,CAAC,MAAM,KAAK,IAAI,CAAC,MAAM,EAAE;gBACjE,IACI,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC;oBACtC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,GAAG,EACjD;;oBAEE,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC;iBACxB;qBAAM;;oBAEH,IAAI,CAAC,IAAI,EAAE,CAAC;iBACf;aACJ;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,MAAM,KAAK,IAAI,CAAC,MAAM,EAAE;gBAC/D,IAAI,CAAC,IAAI,EAAE,CAAC;gBACZ,KAAK,CAAC,cAAc,EAAE,CAAC;gBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;aAC3B;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,aAAa,EAAE;gBACrC,KAAK,CAAC,cAAc,EAAE,CAAC;gBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;aAC3B;SACJ;QAED,IAAY,KAAK;YACb,IAAI,IAAI,CAAC,MAAM;gBAAE,OAAO,IAAI,CAAC,MAAM,CAAC;YAEpC,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAC5C,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC;YAEjD,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,OAAO,CAAC;YAEhC,OAAO,IAAI,CAAC,MAAM,CAAC;SACtB;QAEO,YAAY,CAAC,EAAQ;YACzB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YACzB,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YACtB,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YACtC,KAAK,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YAExC,KAAK,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;YAE5C,KAAK,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YACxC,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YACtC,KAAK,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;;YAG1C,MAAM,cAAc,GAChB,MAAM,CAAC,UAAU,GAAG,QAAQ,CAAC,eAAe,CAAC,WAAW,CAAC;YAC7D,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACxC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,GAAG,GAAG,cAAc,IAAI,CAAC;SAC3D;QAEO,eAAe;YACnB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YACzB,KAAK,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YACzC,KAAK,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YAE3C,KAAK,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;YAE/C,KAAK,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YAC3C,KAAK,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YACzC,KAAK,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;YAE7C,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;;YAGpC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,GAAG,EAAE,CAAC;YACrC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,SAAS,CAAC;SAC5C;QAED,IAAI,QAAQ;;YAER,OAAO,IAAI,CAAC;SACf;QAED,IAAI,CAAC,OAKJ;;;YAEG,MAAM,aAAa,GAAG,iBAAiB,EAAE,CAAC;YAC1C,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,OAAO,EAAE,MAAM,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE;;;;gBAIhD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;gBACjC,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;gBAEpB,IAAI,CAAC,qBAAqB,GAAG,aAAa,CAAC;gBAE3C,IAAI,CAAC,YAAY,OAAC,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,MAAM,mCAAI,QAAQ,CAAC,IAAI,CAAC,CAAC;gBACpD,OAAO,IAAI,CAAC;aACf;YACD,OAAO,KAAK,CAAC;SAChB;QAED,IAAI;;YACA,IAAI,CAAC,sBAAsB,EAAE,CAAC;YAC9B,IAAI,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE;gBACzB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;gBAC3B,KAAK,CAAC,IAAI,EAAE,CAAC;gBACb,IAAI,CAAC,eAAe,EAAE,CAAC;gBACvB,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;;gBAEtB,YAAA,IAAI,CAAC,qBAAqB,0CAAE,KAAK,mDAAK;aACzC;SACJ;QAED,iBAAiB,CAAC,EAAc;YAC5B,IAAI,CAAC,sBAAsB,EAAE,CAAC;YAE9B,MAAM,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC;YACrC,IAAI,KAAK,IAAI,CAAC,EAAE;gBACZ,EAAE,EAAE,CAAC;gBACL,OAAO;aACV;YACD,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC;gBAC9B,IAAI,CAAC,eAAe,GAAG,SAAS,CAAC;gBACjC,EAAE,EAAE,CAAC;aACR,EAAE,KAAK,CAAC,CAAC;SACb;QAED,sBAAsB;YAClB,IAAI,IAAI,CAAC,eAAe,EAAE;gBACtB,YAAY,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;gBACnC,IAAI,CAAC,eAAe,GAAG,SAAS,CAAC;aACpC;SACJ;QAED,IAAI,iBAAiB;YACjB,OAAO,GAAG,CAAC;SACd;KACJ;IAED,SAAS,SAAS,CAAC,IAAsB;QACrC,MAAM,MAAM,GACR,OAAO,IAAI,CAAC,QAAQ,KAAK,UAAU;YACnC,OAAO,IAAI,CAAC,MAAM,KAAK,UAAU;YACjC,OAAO,IAAI,CAAC,OAAO,KAAK,UAAU;YAClC,OAAO,IAAI,CAAC,KAAK,KAAK,UAAU;YAChC,OAAO,IAAI,CAAC,WAAW,KAAK,UAAU;YACtC,OAAO,IAAI,CAAC,SAAS,KAAK,UAAU,CAAC;QAEzC,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,IAAI,IAAI,CAAC,OAAO,EAAE;YACzC,OAAO,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SACjD;QACD,OAAO,MAAM,CAAC;IAClB,CAAC;IAED,SAAS,iBAAiB;;QACtB,IAAI,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC;QAC/B,aAAO,CAAC,aAAD,CAAC,uBAAD,CAAC,CAAE,UAAU,0CAAE,aAAa,EAAE;YACjC,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC,aAAa,CAAC;SAClC;QACD,OAAQ,CAAiC,CAAC;IAC9C;;ICnWA;;;;;;;;;;;;;;;;;;;;;UAqBa,oBAAqB,SAAQ,SAAS;QAE/C,YAAY,WAAgC;YACxC,KAAK,CAAC;gBACF,QAAQ,EAAE,aAAa;gBACvB,KAAK,EAAE,UAAU;aACpB,CAAC,CAAC;;;YAIH,IAAI,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC;YAC9B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC;gBAAE,aAAa,GAAG,EAAE,CAAC;YAEtD,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,CACxB,CAAC,IAAI,WAAW,aAAX,WAAW,cAAX,WAAW,GAAI,EAAE,CAAC,EAAE,GAAG,aAAa,CAAC,EAC1C;gBACI,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI;gBAC1B,eAAe,EAAE,IAAI,CAAC,UAAU,CAAC,aAAa,CAC1C,IAAI,CACP;aACJ,CACJ,CAAC;SACL;;;;QAKD,WAAW,CAAC,KAAY;;YACpB,IAAI,KAAK,CAAC,IAAI,KAAK,aAAa,EAAE;gBAC9B,MAAM,GAAG,GAAG,KAAmB,CAAC;gBAChC,IAAI,CAAC,IAAI,CAAC;oBACN,OAAO,EAAE,GAAG,CAAC,OAAO;oBACpB,OAAO,EAAE,GAAG,CAAC,OAAO;oBACpB,iBAAiB,EAAE,0BAA0B,CAAC,GAAG,CAAC;iBACrD,CAAC,CAAC;gBACH,KAAK,CAAC,cAAc,EAAE,CAAC;gBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;aAC3B;iBAAM,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;gBACjC,MAAM,GAAG,GAAG,KAAsB,CAAC;gBACnC,IACI,GAAG,CAAC,IAAI,KAAK,aAAa;qBACzB,GAAG,CAAC,IAAI,KAAK,KAAK,IAAI,GAAG,CAAC,QAAQ,CAAC,EACtC;;;oBAGE,MAAM,MAAM,SAAG,IAAI,CAAC,aAAa,0CAAE,qBAAqB,EAAE,CAAC;oBAC3D,IAAI,MAAM,EAAE;wBACR,IAAI,CAAC,IAAI,CAAC;4BACN,OAAO,EAAE,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,GAAG,CAAC;4BACvC,OAAO,EAAE,MAAM,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC;4BACvC,iBAAiB,EAAE,0BAA0B,CAAC,GAAG,CAAC;yBACrD,CAAC,CAAC;wBACH,KAAK,CAAC,cAAc,EAAE,CAAC;wBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;qBAC3B;iBACJ;aACJ;iBAAM,CAEN;SACJ;;;;;QAKD,iBAAiB;;YAEb,MAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC;YAC/B,MAAM,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;YAC7C,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;SAC5C;;;;;QAKD,oBAAoB;YAChB,MAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC;YAC/B,IAAI,MAAM,EAAE;gBACR,MAAM,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;gBAChD,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;aAC/C;SACJ;;;;QAID,KAAK;YACD,KAAK,CAAC,KAAK,EAAE,CAAC;YACd,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,QAAQ,EAAE;gBAClC,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE;oBAC9B,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;iBAChD;qBAAM;oBACH,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;iBACjC;aACJ;SACJ;;;;;;;;;;;QAWD,IAAI,CAAC,OAIJ;YACG,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,GAAG,OAAO,EAAE,MAAM,EAAE,IAAI,CAAC,UAAU,EAAE,CAAC,EAAE;gBAC7D,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,EAAE;oBAChC,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;iBACvC;gBACD,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;gBAC7B,IAAI,CAAC,KAAK,EAAE,CAAC;aAChB;SACJ;;;;;;;;;QASD,IAAI;YACA,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;SACxB;KACJ;IAUD,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,iBAAiB,CAAC,EAAE;QAC/C,MAAM,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;QACnD,MAAM,CAAC,cAAc,CAAC,MAAM,CAAC,iBAAiB,EAAE,oBAAoB,CAAC,CAAC;;;;;;;;;;;"}